\documentclass[UKenglish]{lipics-v2016}

\usepackage{amsmath,amssymb,amsthm}
\usepackage{latexsym}
\usepackage{microtype}
\usepackage{proof}
\usepackage{stmaryrd}
\usepackage{xargs}

\usepackage{graphicx}

\usepackage{tikz}
\usetikzlibrary{arrows}

\usepackage{willemtools}
\usepackage{proofnet}

\bibliographystyle{plainurl}

% ============================== FOR COMMENTS

\newcommand{\lutz}[1]{{\color{blue}     \noindent[\![\![{\bf Lutz: }#1]\!]\!]}}
\newcommand{\todo}[1]{{\color{red}     \noindent[\![\![{\bf TODO: }#1]\!]\!]}}
\newcommand{\willem}[1]{{\color{green!50!black}     \noindent[\![\![{\bf Willem: }#1]\!]\!]}}

% ============================== MACROS

\makeatletter

\theoremstyle{plain}
\newtheorem{proposition}[theorem]{Proposition}


% ===== Definitions

\newcommand\defn[1]{\textit{\textbf{#1}}}

% ===== General maths

\newcommand\zeroleft[1]{\makebox[0pt][r]{$#1$}}
\newcommand\zeroright[1]{\makebox[0pt][l]{$#1$}}

\newcommand\floor[1]{\lfloor#1\rfloor}

% ===== Sets

\newcommand\var{\textsc{var}}
\newcommand\varA{\textsc{var}^\forall}
\newcommand\varE{\textsc{var}^\exists}
\newcommand\terms{\textsc{term}}
\newcommand\termsA{\textsc{term}^\forall}
\newcommand\atom{\textsc{atom}}
\newcommand\form{\textsc{form}}
\newcommand\proofs{\textsc{proof}}
\newcommand\all{\textsc{all}}

\newcommand\ex[2][{}]{\textsc{ev}_{#1}(#2)}

\newcommand\subs[1]{\textsc{sub}(#1)}
\newcommand\poss[1]{\textsc{pos}(#1)}
\newcommand\dom[1]{\textsc{dom}(#1)}

% ===== Formulas

\newcommand\+{+}
\renewcommand\*{\times}
\newcommand\dual[1]{\overline{#1}}

\newcommand\sub{\leq}
\newcommand\dep{\preccurlyeq}

\newcommand\seq[2]{{\vdash}#1,#2}
\newcommand\fv{\textsc{fv}}

% ===== Proofs

\newcommand\prf[3]{#1\vdash\!#2,#3}

\newcommand\Seq{\vphantom(\seq}
\newcommand\Prf[3]{\deduce{\Seq{#2}{#3}}{\vphantom(#1}}

% ===== Nets

\newcommand\net[3]{#1\triangleright #2,#3}

\newcommand\deseq[4][\sigma]{[#2]_{#1}^{#3,#4}}
\newcommand\Deseq[4][\sigma]{\left[\vcenter{#2}\right]_{#1}^{#3\,,\,#4}}

\newcommand\comp{\mathbin;}

% ===== Witness maps

\newcommand\mgu{\textsc{mgu}}

\newcommand\gen{\leq}
\newcommand\coh{\smallfrown}
\newcommand\join{\vee}
\newcommand\minus{\mathop{\!/\mathchoice{\kern-3pt}{\kern-3pt}{\kern-2.5pt}{\kern-2pt}/\!}}


\newcommand\res[1]{|_{#1}}
\newcommand\fix[2][2pt]{\overrightharpoon[#1]{#2}}
\newcommand\dcom{\mathbin\cdot}

\newcommand\init[2]{\mgu(#1,#2)}

\newcommand\subdual[1]{_{\smash{\,\dual{\!#1}}}}

% ===== Slices


% ===== Coalescence

\newcommand\link[3][\sigma]{(#2,#3)_{#1}}

\newcommand\scoal{\rightarrow} %{\leadsto}
\newcommand\ucoal{\rightsquigarrow}

\newcommand\Qrr{\!\!\scriptstyle\qrr}

\newcommand\qrr[1]{
  \ifx#1+\expandafter\@qrr\else
  \ifx#1*\*\mathrm R\else
  \ifx#1!\forall\mathrm R\else
  \ifx#1?\expandafter\@@qrr\else
  \ifx#11\mathrm{ax}\else
  \ifx#1.\mathrm{cut}\else
  #1\mathrm R
  \fi\fi\fi\fi\fi\fi
}
\newcommand\@qrr[1]{+\mathrm R,#1}
\newcommand\@@qrr[1]{\exists\mathrm R,#1}

\newcommand\srr[1]{
  \ifx#1+\expandafter\@srr\else
  \ifx#1*\*\mathrm S\else
  \ifx#1!\forall\mathrm S\else
  \ifx#1?\exists\mathrm S\else 
  \ifx#11\mathrm{axS}\else
  #1\mathrm S  \fi\fi\fi\fi\fi
}
\newcommand\@srr[1]{+\mathrm S,{#1}}

\newcommand\urr[1]{
  \ifx#1+\expandafter\@urr\else
  \ifx#1*\*\mathrm U\else
  \ifx#1!\forall\mathrm U\else
  \ifx#1?\exists\mathrm U\else 
  \ifx#11\mathrm{axU}\else
  #1\mathrm U
  \fi\fi\fi\fi\fi
}
\newcommand\@urr[1]{+\mathrm U,{#1}}

% ===== Derivations

\newcommand\sdown{\mathrel{\rotatebox[origin=c]{-90}{$\scoal$}\kern1pt}}
\newcommand\udown{\mathrel{\rotatebox[origin=c]{-90}{$\ucoal$}\kern1pt}}

\newcommandx\sdn[4][2=\sigma]{#1\sdown\link[#2]{#3}{#4}}	%{#2\sdown_{#1}{#3}\mathbin,{#4}}
\newcommandx\udn[4][2=\sigma]{#1\udown\link[#2]{#3}{#4}}	%{#2\udown_{#1}{#3}\mathbin,{#4}}

% ===== (De-)Sequentialization

\newcommand\QU{\Leftrightarrow}

% ===== Overset extensible harpoon

\DeclareFontFamily{U}{MnSymbolA}{}
\DeclareFontShape{U}{MnSymbolA}{m}{n}{
    <-6>  MnSymbolA5
   <6-7>  MnSymbolA6
   <7-8>  MnSymbolA7
   <8-9>  MnSymbolA8
   <9-10> MnSymbolA9
  <10-12> MnSymbolA10
  <12->   MnSymbolA12}{}
\DeclareFontShape{U}{MnSymbolA}{b}{n}{
    <-6>  MnSymbolA-Bold5
   <6-7>  MnSymbolA-Bold6
   <7-8>  MnSymbolA-Bold7
   <8-9>  MnSymbolA-Bold8
   <9-10> MnSymbolA-Bold9
  <10-12> MnSymbolA-Bold10
  <12->   MnSymbolA-Bold12}{}
\DeclareSymbolFont{MnSyA}{U}{MnSymbolA}{m}{n}
\SetSymbolFont{MnSyA}{bold}{U}{MnSymbolA}{b}{n}

\DeclareRobustCommand{\overleftharpoon}{\mathpalette{\overarrow@\leftharpoonfill@}}
\DeclareRobustCommand{\overrightharpoon}{\mathpalette{\overarrow@\rightharpoonfill@}}
\def\leftharpoonfill@{\arrowfill@\leftharpoondown\mn@relbar\mn@relbar}
\def\rightharpoonfill@{\arrowfill@\mn@relbar\mn@relbar\rightharpoonup}

\DeclareMathSymbol{\leftharpoondown}{\mathrel}{MnSyA}{'112}
\DeclareMathSymbol{\rightharpoonup}{\mathrel}{MnSyA}{'100}
\DeclareMathSymbol{\mn@relbar}{\mathrel}{MnSyA}{'320}

\renewcommand\overrightharpoon[2][2pt]{
\begin{tikzpicture}[baseline=0]
	\node[inner sep=0pt,outer sep=0pt,anchor=base] (x) at (0,0) {$#2$};
	\draw[-left to] ($(x.north west) + (0pt,#1)$) -- ($(x.north east) + (0pt,#1)$);
\end{tikzpicture}}

% ===== Permutations

\newcommand\downperm{\sim\rule[-8pt]{0pt}{22pt}}

\newcommand\permAB{
 \infer[\Qrr!]{\Seq{\forall x.A}{\forall y.B}}{
  \infer[\Qrr!]{\Seq A{\forall y.B}}{
   \Seq AB
}}}
\newcommand\permBA{
 \infer[\Qrr!]{\Seq{\forall x.A}{\forall y.B}}{
  \infer[\Qrr!]{\Seq{\forall x.A}B}{
   \Seq AB
}}}
\newcommand\permAE{
 \infer[\Qrr!]{\Seq{\forall x.A}{\exists y.B}}{
  \infer[\Qrr?t]{\Seq A{\exists y.B}}{
   \Seq A{B[t/y]}
}}}
\newcommand\permEA{
 \infer[\Qrr?t]{\Seq{\forall x.A}{\forall y.B}}{
  \infer[\Qrr!]{\Seq{\forall x.A}{B[t/y]}}{
   \Seq A{B[t/y]}
}}}
\newcommand\permEF{
 \infer[\Qrr?s]{\Seq{\exists x.A}{\exists y.B}}{
  \infer[\Qrr?t]{\Seq{A[s/x]}{\exists y.B}}{
   \Seq{A[s/x]}{B[t/y]}
}}}
\newcommand\permFE{
 \infer[\Qrr?t]{\Seq{\exists x.A}{\exists y.B}}{
  \infer[\Qrr?s]{\Seq{\exists x.A}B[t/y]}{
   \Seq{A[s/x]}{B[t/y]}
}}}
\newcommand\permAP{
 \infer[\Qrr!]{\Seq{\forall x.A}{B_1\+B_2}}{
  \infer[\Qrr+i]{\Seq A{B_1\+B_2}}{
   \Seq A{B_i}
}}}
\newcommand\permPA{
 \infer[\Qrr+i]{\Seq{\forall x.A}{B_1\+B_2}}{
  \infer[\Qrr!]{\Seq{\forall x.A}{B_i}}{
   \Seq A{B_i}
}}}
\newcommand\permEP{
 \infer[\Qrr?t]{\Seq{\exists x.A}{B_1\+B_2}}{
  \infer[\Qrr+i]{\Seq{A[t/x]}{B_1\+B_2}}{
   \Seq{A[t/x]}{B_i}
}}}
\newcommand\permPE{
 \infer[\Qrr+i]{\Seq{\exists x.A}{B_1\+B_2}}{
  \infer[\Qrr?t]{\Seq{\exists x.A}{B_i}}{
   \Seq{A[t/x]}{B_i}
}}}
\newcommand\permPQ{
 \infer[\Qrr+i]{\Seq{A_1\+A_2}{B_1\+B_2}}{
  \infer[\Qrr+j]{\Seq{A_i}{B_1\+B_2}}{
   \Seq{A_i}{B_j}
}}}
\newcommand\permQP{
 \infer[\Qrr+j]{\Seq{A_1\+A_2}{B_1\+B_2}}{
  \infer[\Qrr+i]{\Seq{A_1\+A_2}{B_j}}{
   \Seq{A_i}{B_j}
}}}
\newcommand\permAX{
 \infer[\Qrr!]{\Seq{\forall x.A}{B\*C}}{
  \infer[\Qrr*]{\Seq A{B\*C}}{
   \Seq AB & \Seq AC
}}}
\newcommand\permXA{
 \infer[\Qrr*]{\Seq{\forall x.A}{B\*C}}{
  \infer[\Qrr!]{\Seq{\forall x.A}B}{
   \Seq AB 
  }& 
  \infer[\Qrr!]{\Seq{\forall x.A}C}{
   \Seq AC
}}}
\newcommand\permEX{
 \infer[\Qrr?t]{\Seq{\exists x.A}{B\*C}}{
  \infer[\Qrr*]{\Seq{A[t/x]}{B\*C}}{
   \Seq{A[t/x]}B & \Seq{A[t/x]}C
}}}
\newcommand\permXE{
 \infer[\Qrr*]{\Seq{\exists x.A}{B\*C}}{
  \infer[\Qrr?t]{\Seq{\exists x.A}B}{
   \Seq{A[t/x]}B 
  }& 
  \infer[\Qrr?t]{\Seq{\exists x.A}C}{
   \Seq{A[t/x]}C
}}}
\newcommand\permPX{
 \infer[\Qrr+i]{\Seq{A_1\+A_2}{B\*C}}{
  \infer[\Qrr*]{\Seq{A_i}{B\*C}}{
   \Seq{A_i}B & \Seq{A_i}C
}}}
\newcommand\permXP{
 \infer[\Qrr*]{\Seq{A_1\+A_2}{B\*C}}{
  \infer[\Qrr+i]{\Seq{A_1\+A_2}B}{
   \Seq{A_i}B 
  }& 
  \infer[\Qrr+i]{\Seq{A_1\+A_2}C}{
   \Seq{A_i}C
}}}
\newcommand\permXY{
 \infer[\Qrr*]{\Seq{A\*B}{C\*D}}{
  \infer[\Qrr*]{\Seq A{C\*D}}{
   \Seq AC & \Seq AD
  }&
  \infer[\Qrr*]{\Seq B{C\*D}}{
   \Seq BC & \Seq BD
}}}
\newcommand\permYX{
 \infer[\Qrr*]{\Seq{A\*B}{C\*D}}{
  \infer[\Qrr*]{\Seq{A\*B}C}{
   \Seq AC & \Seq BC
  }&
  \infer[\Qrr*]{\Seq{A\*B}D}{
   \Seq AD & \Seq BD
}}}

% ===== Cut-permutations

\newcommand\permAC{
 \infer[\Qrr.]{\Seq{\forall x.A}C}{
  \infer[\Qrr!]{\Seq{\forall x.A}B}{
   \Seq AB 
  }& 
  \Seq{\dual B}C
}}
\newcommand\permCA{
 \infer[\Qrr!]{\Seq{\forall x.A}C}{
  \infer[\Qrr.]{\Seq AC}{
   \Seq AB & \Seq{\dual B}C
}}}
\newcommand\permEC{
 \infer[\Qrr.]{\Seq{\exists x.A}C}{
  \infer[\Qrr?t]{\Seq{\exists x.A}B}{
   \Seq{A[t/x]}B 
  }& 
  \Seq{\dual B}C
}}
\newcommand\permCE{
 \infer[\Qrr?t]{\Seq{\exists x.A}C}{
  \infer[\Qrr.]{\Seq{A[t/x]}C}{
   \Seq{A[t/x]}B & \Seq{\dual B}C
}}}
\newcommand\permPC{
 \infer[\Qrr.]{\Seq{{A_1\+A_2}}C}{
  \infer[\Qrr+i]{\Seq{{A_1\+A_2}}B}{
   \Seq {A_i}B 
  }& 
  \Seq{\dual B}C
}}
\newcommand\permCP{
 \infer[\Qrr+i]{\Seq{{A_1\+A_2}}C}{
  \infer[\Qrr.]{\Seq {A_i}C}{
   \Seq {A_i}B & \Seq{\dual B}C
}}}
\newcommand\permXC{
 \infer[\Qrr.]{\Seq{{A_1\*A_2}}C}{
  \infer[\Qrr*]{\Seq{{A_1\*A_2}}B}{
   \Seq {A_1}B & \Seq{A_2}B
  }& 
  \Seq{\dual B}C
}}
\newcommand\permCX{
 \infer[\Qrr*]{\Seq{{A_1\*A_2}}C}{
  \infer[\Qrr.]{\Seq {A_i}C}{
   \Seq {A_1}B & \Seq{\dual B}C
  }&
  \infer[\Qrr.]{\Seq {A_i}C}{
   \Seq {A_2}B & \Seq{\dual B}C
}}}
\newcommand\permCD{
 \infer[\Qrr.]{\Seq AD}{
  \infer[\Qrr.]{\Seq AC}{
   \Seq AB & \Seq{\dual B}C
  }& 
  \Seq{\dual C}D
}}
\newcommand\permDC{
 \infer[\Qrr.]{\Seq{{A_1\*A_2}}C}{
  \Seq A{\dual B}
  &
  \infer[\Qrr.]{\Seq BD}{
   \Seq B{\dual C} & \Seq CD
}}}

\makeatother

% ============================== TITLE & AUTHORS

\title{Proof nets for first-order additive linear logic}
%\titlerunning{Proof nets for ALL1}

\author[1]{Willem B.\ Heijltjes}
\author[2]{Dominic J.D.\ Hughes}
\author[3]{Lutz Stra\ss burger}
\affil[1]{University of Bath, United Kingdom\\
  \texttt{w.b.heijltjes@bath.ac.uk}}
\affil[2]{
  \texttt{}}
\affil[3]{INRIA \&\ \'Ecole Polytechnique, Palaiseau, France\\
  \texttt{lutz.strassburger@inria.fr}}
\authorrunning{W.B.\ Heijltjes, D.J.D.\ Hughes, and L.\ Stra\ss burger}

\Copyright{Willem B.\ Heijltjes, Dominic J.D.\ Hughes, and Lutz Stra\ss burger}

\subjclass{F.4.1 [Mathematical logic and formal languages]: Mathematical logic--Proof theory}
\keywords{Linear logic, First-order logic, Proof nets}



% ============================== CONTENT


\begin{document}

\maketitle

\begin{abstract}
We extend proof nets for additive linear logic with first-order quantification. 

We present two versions of our proof nets. One, called witness nets, retains explicit witnessing information to existential quantification. For the other, called unification nets, this information is absent but can be reconstructed through unification. Unification nets embody a main contribution of the paper: the observation that first-order witnessing information can be left implicit, and reconstructed effectively. 

Witness nets are canonical for first-order additive sequent calculus. Unification nets in addition factor out any inessential choice for existential witnesses. 
Both notions of proof net are defined through coalescence (the additive version of multiplicative contractibility), and for witness nets a geometric correctness criterion is provided. Both feature a global, one-shot composition operation.
\end{abstract}


% ==================================================

\section{Introduction}

%Proof nets aim to be canonical representations of proofs. As graphs, they abstract away from the rule commutations of the sequent calculus. 
%
%In the study of \emph{proof nets} \cite{Girard-1987}, canonical graphical representations of proofs, the additive fragment of linear logic provides several interesting challenges. At the propositional level, the challenge is to capture the merging of the contexts $\Gamma$ in the additive product rule:
%\[
%	\vc{\infer[\Qrr*]{\seq\Gamma{A\*B}}{\seq\Gamma A & \seq\Gamma B}}~.
%\]
%One approach, perfect for the multiplicative fragment, is to create proof nets from sequent proofs by separating rules from their context: each sequent rule becomes a node in the graph, connected only to the primary formulas of the rule, in this case $A$, $B$, and $A\*B$. The benefit is a direct interpretation from sequent calculus; 


Additive linear logic is the logic of product $(\*)$ and sum $(\+)$. Proofs, over a sequent $A\vdash B$ or, here, $\seq{\dual A}B$, are built from the canonical morphisms: projections, injections, and diagonals. These are captured naturally in \emph{proof nets}, which consist of a set of \emph{links} between subformulas in $\dual A$ and in $B$, satisfying a simple geometric correctness condition.
\[
\begin{array}{c@{\qquad}c@{\qquad}c@{\qquad}c}
	\begin{tikzpicture}[net]
		\formula[y=1.2]{{\dual a}}
		\formula[y=0]{a\*a}
		\Vlink[red]{[-2]1,1}
		\Vlink[red]{[2]1,3}
	\end{tikzpicture}
&
	\begin{tikzpicture}[net]
		\formula[y=1.2]{{\dual a}}
		\formula[y=0]{a\+b}
		\Vlink[red]{1,1}
	\end{tikzpicture}
&
	\begin{tikzpicture}[net]
		\formula[y=1.2]{{\dual a}\+{\dual b}}
		\formula[y=0]{b\*a}
		\Vlink[red]{1,3}
		\Vlink[red]{3,1}
	\end{tikzpicture}
&
	\begin{tikzpicture}[net]
		\formula[y=1.2]{*{\phantom(}{\dual a}*{\phantom)}
		 {{\+}}*({\dual b}*{\phantom)}
		 {{\+}}*{\phantom(}{\dual c}*)}
		\formula[y=0]{*(a*{\phantom)}
		{{\*}}*{\phantom(}b*)
		{{\*}}*{\phantom(}c*{\phantom)}}
		\Vlink[red]{1,1}
		\Vlink[red]{3,3}
		\Vlink[red]{5,5}
	\end{tikzpicture}
\\
	\text{\small diagonal}
&	\text{\small injection}
&	\text{\small symmetry}
&	\text{\small associativity}
\end{array}
\]

The logic is combinatorially rich, yet well-behaved and tractable: proof search \cite{} and proof net correctness \cite{} are linear in $|A|\times|B|$ (where $|A|$ is the size of the syntax tree of $A$); proof nets remain canonical and equally tractable when extended with the two units \cite{,}; and the first-order case is merely NP-complete \cite{}.

At the same time, the ubiquity of its main operations, product and sum, mean the ideas and results it garners are widely applicable. It serves as a microcosmos for important ideas and observations: it fostered the \emph{connections method} of proof search \cite{}; it demonstrated the \emph{Blass problem} \cite{Abramsky} of game semantics, that sequential strategies do not in general have associative composition; and it is at the root of the study of fixed points in linear logic \cite{Santocanale}. 

The logic is of course part of MALL (multiplicative-additive linear logic), and its lessons are clearly visible in the second author's canonical proof nets \cite{Hughes-vanGlabbeek} for that fragment, as well as the first and second author's locally canonical \emph{conflict nets} \cite{Hughes-Heijltjes-2016}. But its proof nets also appear as the \emph{skew fibrations} in the second author's \emph{combinatorial proofs} for classical logic \cite{Hughes-}, and in the third authors study of the \emph{medial rule} for classical logic~\cite{str:RTA07}. To prepare the ground for the extension of \emph{combinatorial proofs} to first-order classical logic is one motivation for the current presentation.

The main content of first-order proof, and the central challenge for first-order additive proof nets, is the \emph{witness assignment} to existential quantifiers. There are two, related obstacles in particular. First, the standard approach to evaluate a formula $\exists x.A$ is by a substitution $A[t/x]$, which destroys the subformula $A$.%
%
\footnote{Given $A[t/x]$ and $t$, it is not possible to unambiguously recover $A$, which may contain other occurrences of $t$ not originating in the substitution $[t/x]$.}
%
But the current, successful formulation of proof nets, as a set of links over a two-formula sequent, requires subformulas to remain intact.

Second, the same existential quantification $\exists x.A$ may occur in different \emph{slices} (branches of a proof above a product), with different witnesses, as in the below proof. But the formulas--plus--links design has exactly one instance of $\exists x.A$.
\[
\vc{
	\infer[\Qrr*]{\Seq{\exists x.A}{B\*C}}{
	 \infer[\Qrr?s]{\Seq{\exists x.A}B}{\Seq{A[s/x]}B}
	 &
	 \infer[\Qrr?t]{\Seq{\exists x.A}C}{\Seq{A[t/x]}C}
   }}
~.
\]

We advance two solutions, both simple and radical. \defn{Witness nets} replace the \emph{implicit} substitutions of sequent proofs with \emph{explicit} substitutions, recorded at each link. An example is given below left. Second, \defn{unification nets} omit existential witnesses altogether, and reconstruct them by unification.

* EXAMPLE *

\subsection{Expansion trees}

We observe that the presented solution is not the only one possible. In fact, a reasonable alternative could be the approach of \emph{expansion tree proofs} for higher-order classical logic \cite{Miller}. In this formulation, a formula $\exists x.A$ is interpreted, effectively, as the sum over all its instantiations $A[t/x]$ in the proof; e.g.\ $A[s/x]\+A[t/x]$ for the above proof fragment.

We will use this approach implicitly to define a geometric correctness condition, in Section~\ref{sec:correctness}. The idea is as follows: for an existential formula $\exists x.A$ we collect all witnesses $t$ to $x$ present in the links of the proof, and then interpret $\exists x.A$ as the sum of all $A[t/x]$ to generate the \emph{slices} on which the criterion is based.

The idea is closely related to Herbrand's Theorem \cite{Herbrand} and the \emph{compactness theorem}: semantically, $\exists x.A$ is equivalent to the infinite sum over all $A[t/x]$ for all terms $t$ in the language, or all elements $t$ of a model; for any individual proof, a finite set of terms (or finitely generated set of elements) suffices.

For the definition of proof nets, we did not pursue this direction, and consider the present choice preferable for the following reasons. They retain the original structure of links between formulas, without requiring expansion trees. More importantly, as in the propositional case, they enable direct (non-inductive) composition by a relational composition of links.






\[
\begin{tikzpicture}[net]
\formula[y=1.2]{\exists x.\forall y.~{\dual P}(x,y)}
\formula[y=0]{\exists z.~P(s,z)\*P(t,z)}
\Vlink[red,label={$\scriptstyle{[y/z,s/x]}~~$},l]{[-2]8,5}
\Vlink[red,label={$~\scriptstyle{[y/z,t/x]}$}]{[2]8,12}
\end{tikzpicture}
\]

\[
\begin{tikzpicture}[net]
\formula[y=1]{\exists x.\forall y.~{\dual P}(x,y)}
\formula[y=0]{\exists z.~P(s,z)\*P(t,z)}
\Vlink[red,label={$~\scriptstyle{[y/z,s/x]\mgu(s,t)}$}]{8,11}
\end{tikzpicture}
\]

\[
\begin{tikzpicture}[net]
\formula[y=1]{\exists x.\forall y.~{\dual P}(x,y)}
\formula[y=0]{\exists z.~P(s,z)\*P(t,z)}
\Vlink[red,label={$\quad\scriptstyle{[s/x]\mgu(s,t)}$}]{8,1}
\end{tikzpicture}
\]

\[
\begin{tikzpicture}[net]
\formula[y=1]{\exists x.\forall y.~{\dual P}(x,y)}
\formula[y=0]{\exists z.~P(s,z)\*P(t,z)}
\Vlink[red,label={$~~\scriptstyle{[s/x]\mgu(s,t)}$}]{4,1}
\end{tikzpicture}
\]

\[
\begin{tikzpicture}[net]
\formula[y=1]{\exists x.\forall y.~{\dual P}(x,y)}
\formula[y=0]{\exists z.~P(s,z)\*P(t,z)}
\Vlink[red,label={$~\scriptstyle{\mgu(s,t)}$}]{1,1}
\end{tikzpicture}
\]




Correctness and sequentialization for \all1 proof nets will be through \defn{coalescence}. This is a simple graph rewriting relation that gives top-down sequentialization, from the axioms to the conclusion of a proof. It is the additive counterpart to Danos \defn{contractibility} for multiplicative linear logic. 

We will define two coalescence relations, one \defn{strict} $(\scoal)$, for witness nets, and one \defn{unifying} $(\ucoal)$, for unification nets, in a later section. In the former, to join two slices the witness assignment must be the same; in the latter, witness assignments must be compatible, so that a common, more general witness map exists. 




% --------------------------------------------------

\subsection{Proof identity}

At the heart of a theory of proof nets is the question of proof identity, of when two proofs should be considered equivalent, and should thus map onto the same proof net. 
%
%It can be approached semantically, by asking whether two proofs are identified in every model; 
%
The introduction of quantifiers creates an interesting issue: if two proofs differ by an immaterial choice of existential witness, should they be equivalent? For example, to prove the sequent $\seq{\exists x.P(x)}{\exists y.\dual P(y)}$ both quantifiers must receive \emph{the same} witness, as in the following two proofs, but any witness will do.
\[
	\vc{\infer={\seq{\exists x.P(x)}{\exists y.\dual P(y)}}{\infer{\seq{P(s)}{\dual P(s)}}{}}}
	\quad
	\stackrel?\equiv
	\quad
	\vc{\infer={\seq{\exists x.P(x)}{\exists y.\dual P(y)}}{\infer{\seq{P(t)}{\dual P(t)}}{}}}
\]
The issue is more pronounced where quantifiers are \emph{vacuous}, $\exists x.A$ where $x$ is not free in $A$. The proofs below left can only be distinguished even syntactically because the $\exists R$-rule makes the instantiating witness explicit.
%
Below right is an interesting intermediate variant: the witness $s$ or $t$ can be observed without explicit annotation in the $\exists R$-rule, but the choice is equally immaterial to the content of the proof as when the quantifier were vacuous.
\[
	\vc{\infer[\!\!\scriptstyle{\qrr?s}]{\seq{\exists x.P}{\dual P}}{\infer{\seq P{\dual P}}{}}}
	\quad
	\stackrel?\equiv
	\quad	
	\vc{\infer[\!\!\scriptstyle{\qrr?t}]{\seq{\exists x.P}{\dual P}}{\infer{\seq P{\dual P}}{}}}\qquad
	\vc{
	 \infer[\!\!\scriptstyle{\qrr?s}]{\seq{\exists x.P\+Q(x)}{\dual P}}{
	  \infer[\!\!\scriptstyle{\qrr+1}]{\seq{P\+Q(s)}{\dual P}}{\infer{\seq P{\dual P}}{}}
	}}
	\quad
	\stackrel?\equiv
	\quad	
	\vc{
	 \infer[\!\!\scriptstyle{\qrr?t}]{\seq{\exists x.P\+Q(x)}{\dual P}}{
	  \infer[\!\!\scriptstyle{\qrr+1}]{\seq{P\+Q(t)}{\dual P}}{\infer{\seq P{\dual P}}{}}
	}}
\]
In this paper we will not attempt to decisively settle the question of proof identity. Rather, we will present two natural and coherent notions of proof net, that represent two extremes. One, \defn{witness nets}, takes the choice of existential witnesses to be essential proof content, and rejects all three equivalences above. The other, \defn{unification nets}, removes any redundancy by rejecting explicit witnessing information altogether; instead, a most general witness for every quantifier is reconstructed by unification.


%$\seq{\,\exists x.P(x,x,s)\,}{\,\exists y.\dual P(t,y,y)}$ 

% --------------------------------------------------

\subsection{Background and related work}


\cite{Whitman-1941}
\cite{Girard-1987}
\cite{Galmiche-Marion-1995} % ALL proof search
\cite{Girard-1996}
\cite{Hu-1999}
\cite{Galmiche-2000} % ALL connection net (Def 6.11.)
\cite{Cockett-Seely-2001}
\cite{Hughes-VanGlabbeek-2005}
%\cite{Cockett-Santocanale-2009}
\cite{Heijltjes-2011, Heijltjes-2012}
\cite{Heijltjes-Hughes-2015}

\cite{Danos-1990}
\cite{Guerrini-Masini-2001}
\cite{Guerrini-2011}

\cite{Herbrand-1930}
\cite{Heijltjes-2010}

% ==================================================

\section{Proof nets for first-order additive linear logic}

% ..................................................

\begin{figure}
\[
	\infer[\Qrr1]{\vphantom B\seq a{\dual a}}{}
\quad
	\infer[\Qrr+i]{\seq A{B_1\+B_2}}{\seq A{B_i}}
\quad
	\infer[\Qrr*]{\seq A{B\*C}}{\seq AB & \seq AC}
\quad
	\infer[\Qrr?t]{\seq A{\exists x.B}}{\seq A{B[t/x]}}
\quad
	\infer[\Qrr!~(x\,\notin\,\textsc{fv}(A))]{\seq A{\forall x.B}}{\seq AB}
\]
\caption{A sequent calculus for $\all1$}
\label{fig:sequent calculus}
\end{figure}

% ..................................................

% --------------------------------------------------

\subsection{First-order additive linear logic}

First-order terms and the formulas of first-order $\all$ are generated by the following grammars.
%
\setMidspace{5pt}
\[
\begin{array}{@{}l@{}l}
	t &\Coloneqq x \Mid f(t_1,\dots,t_n)
\\[10pt]
	a &\Coloneqq P(t_1,\dots,t_n) \Mid \dual P(t_1,\dots,t_n)
\\[10pt]
	A &\Coloneqq a \Mid A\+A \Mid A\*A \Mid \exists x.A \Mid \forall x.A
\end{array}
\]
%
Negation $(\dual{\,\cdot\,})$ is applied to predicate symbols, $\dual P$, as a matter of convenience. The \defn{dual} $\dual A$ of an arbitrary formula $A$ is given by DeMorgan. We use the following notational conventions.
%
\[
\begin{tabular}{@{}lll@{}} 
	$x,y,z$ & $\in \var$		& first-order variables\\
	$f,g,h$ & $\in \Sigma_f$	& $n$-ary $(n\geq 0)$ function symbols from a fixed alphabet $\Sigma_f$\\
	$P,Q,R$ & $\in \Sigma_p$	& $n$-ary $(n\geq 0)$ predicate symbols from a fixed alphabet $\Sigma_p$ \\
	$s,t,u$ & $\in \terms$ 		& first-order terms over $\var$ and $\Sigma_f$ \\
	$a,b,c$ & $\in \atom$		& atomic propositions \\
	$A,B,C$ & $\in \form$		& \all1 formulas \\
\end{tabular}
\]
%
A \defn{sequent} $\seq AB$ is a pair of formulas $A$ and $B$. A sequent calculus for \all1 is given in Figure~\ref{fig:sequent calculus}, where each rule has a symmetric counterpart that applies to the first formula in the sequent. We write $\prf\pi AB$ for a proof $\pi$ with conclusion sequent $\seq AB$. Two proofs are \defn{equivalent} $\pi\sim\pi'$ if one is obtained from the other by rule permutations (Appendix, Figure~\ref{fig:permutations}.

By a \defn{subformula} we will mean a subformula \defn{occurrence}. For instance, a formula $A\*A$ has two subformulas $A$, one on the left and one on the right. The \defn{subformulas} $\subs A$ of a formula are defined as follows; we write $B\sub A$ if $B$ is a subformula of $A$, i.e.\ if $B\in\subs A$.
\[
	\subs A = \{A\} \cup
	\left\{\begin{array}{ll}
		\subs B\uplus\subs C	& \text{if $A=B\+C$ or $A=B\*C$} \\[5pt]
		\subs B					& \text{if $A=\exists x.B$ or $A=\forall x.B$}
	\end{array}\right.
\]

A \defn{link} $(C,D)$ on a sequent $\seq AB$ is a pair of subformulas $C\leq A$ and $D\leq B$. 
A \defn{linking} $\lambda$ on the sequent $\seq AB$ is a set of links on it.

% ..................................................

\begin{definition}
A \defn{pre-net} $\net\lambda AB$ is a sequent $\seq AB$ with a linking $\lambda$ on it.
\end{definition}

% --------------------------------------------------

\subsection{Witness maps}

A \defn{witness map} $\sigma\colon\var\rightharpoonup\terms$ is a substitution map which assigns terms to variables, given as a (finite) partial function. We define it as $\sigma=[t_1/x_1,\dots,t_n/x_n]$, where its \defn{domain} $\dom\sigma$ is $\{x_1,\dots,x_n\}$. We abbreviate by $y\in\sigma$ that a variable $y$ occurs free in the range of~$\sigma$, i.e., $y\in\fv(t_i)$ for some $i\leq n$. The map $\sigma\minus x$ is undefined on $x$ and otherwise as $\sigma$, we write $\sigma\res V$ for the restriction of $\sigma$ to a set of variables $V$, and $\varnothing$ for the \defn{empty} witness map.
%
We write $A\sigma$ for the application of the substitutions in $\sigma$ to the formula $A$, and $\pi\sigma$ for its application to the proof $\pi$, where it is applied to each formula in the proof, and to each existential witness $t$ recorded with a rule $\qrr?t$. The \defn{composition} of two maps is written $\sigma\tau$, where $A(\sigma\tau)=(A\sigma)\tau$.

%\[
%\begin{tabular}{@{}ll@{}} 
%	$\varnothing$ & is the empty witness map \\
%	$\sigma\minus x$ & is the witness map that is undefined on $x$ and otherwise as $\sigma$ \\
%	$\sigma\res V$ & is the restriction of $\sigma$ to a set of variables $V$\\
%	$y\in\sigma$ & abbreviates $y\in\fv(\sigma(x))$ for some $x$ ($y$ occurs in the range of $\sigma$) \\
%	$A\sigma$ & is the application of $\sigma$ as a substitution map to a formula $A$ \\
%	$\pi\sigma$ & is the application of $\sigma$ to a proof $\pi$ (applied to all its formulas) \\
%\end{tabular}
%\]

A \defn{witness linking} $\lambda_\Sigma$ is a linking $\lambda$ with a \defn{witness labelling} $\Sigma\colon\lambda\to\var\rightharpoonup\terms$ that assigns each link $(C,D)$ a witness map. We may use and define $\lambda_\Sigma$ as a set of \defn{witness links} $\link CD$, where $(C,D)\in\lambda$ and $\Sigma(C,D)=\sigma$.

% ..................................................

\begin{definition}
A \defn{witness pre-net} $\net{\lambda_\Sigma}AB$ is a sequent $\seq AB$ with a witness linking $\lambda_\Sigma$.
\end{definition}

% ..................................................

We will assume the following variable naming conventions.
%
\begin{description}
	\item
[Barendregt's convention] All quantifiers in a sequent $\seq AB$ have a distinct binding variable, and no bound variable shares a name with a free one.

	\item[Eigenvariables not free]
For a link $\link CD$ over $\seq AB$, if a variable $x$ in the range of $\sigma$ is universally quantified as $\forall x.X$ in $\seq AB$ (an \emph{eigenvariable}), then $C\leq X$ or $D\leq X$.

	\item[Freshness]
For a link $\link CD$ over $\seq AB$, other variables in the range of $\sigma$ are \emph{fresh}: distinct from any existentially quantified variable in $\seq AB$.
\end{description}

% ..................................................

\begin{definition}
The \defn{de-sequentialization} $[\pi]$ of a sequent proof $\prf\pi AB$ is the witness pre-net $\net{\deseq[\varnothing]\pi AB}AB$ where the function $\deseq-AB$ is defined inductively as follows.
%
\newcommand\XDeseq[4][\sigma]{
 \left[\vcenter{#2}\right]%
 _{\makebox[0pt][l]{$\scriptstyle{#1}$}}%
 ^{\makebox[0pt][l]{$\scriptstyle{#3\,,\,#4}$}}%
 \rule{35pt}{0pt}
}
%
\begin{align*}
	\XDeseq{\,\infer[\Qrr1]{\seq a{\dual a}}{}}bc &\quad=\quad \{\link bc\}
\\ \\[-5pt]
	\XDeseq{\infer[\Qrr+i]{\seq A {B_1\+B_2}}{\Prf \pi A{B_i}}} {A'} {B_1'\+B'_2} 
	& \quad=\quad 
	\Deseq{\Prf\pi A{B_i}} {A'} {B_i'}
\\ \\[-5pt]
	\XDeseq{\infer[\Qrr*]{\seq A{B\*C}}{
	 \Prf\pi AB && \Prf{\pi'}AC 
	}}{A'}{B'\*C'}
	& \quad=\quad 
	  \Deseq{\Prf\pi AB}{A'}{B'}
	  \cup
	  \Deseq{\Prf{\pi'}AC}{A'}{C'}
\\ \\[-5pt]
	\XDeseq{\infer[\Qrr?t]{\seq A{\exists x.B}}{\Prf\pi A{B[t/x]}}}{A'}{\exists x.B'}
	& \quad=\quad 
	 \Deseq[{\sigma[t/x]}]{\Prf\pi A{B[t/x]}} {A'} {B'}
\\ \\[-5pt]
	\XDeseq{\infer[\Qrr!]
	  {\seq A{\forall x.B}}{\Prf\pi AB}} {A'} {\forall x.B'}
	& \quad=\quad 
	  \Deseq{\Prf\pi AB}{A'}{B'}
\end{align*}
\end{definition}

% ..................................................

A function call $\deseq{\prf\pi AB}{A'}{B'}$ expects that $A=A'\sigma$ and $B=B'\sigma$: the translation separates a sequent $\seq AB$ into subformulas $A'$, $B'$ of the ultimate conclusion of the proof, and the accumulated existential witnesses $\sigma$.
%While a sequent proof instantiates existential witnesses immedately into the premise of the existential quantifier rule, for proof nets we delay the substitutions $\sigma$. Hence we need to maintain the separation of the conclusion $\seq AB$ into the substitutions $\sigma$ and the subformulas $A'$ and $B'$ of the conclusion of the proof net.
\lutz{every referee will ask for an example here.}

We will conclude this section by discussing two further essential notions. First, a witness link $\link ab$ on two atomic formulas $a$ and $b$ is an \defn{axiom} link if $a\sigma=\dual b\sigma$. A witness \defn{axiom} linking is one where every link is an axiom link. Observe that the de-sequentialization $[\pi]$ is a witness pre-net with axiom linking $\deseq[\varnothing]\pi AB$.

Second, given a link $\link CD$ in a pre-net $\net\lambda AB$, we expect the domain of $\sigma$ to be exactly the existentially quantified variables in $A$ and $B$ in whose scope $C$ and $D$ occur. 
%That is, any variable $x$ such that there is a subformula $\exists x.X$ in $A$ that in turn has $C$ as a subformula, and likewise for $B$ and $D$. We will now make this precise. 
For a subformula $C$ of $A$, let the \defn{existential variables} $\ex[A]C$ of $C$ in $A$ be the set
\[
	\ex[A]C = \{\,x \mid C < \exists x.X \sub A\,\}~.
\]

% ..................................................

\begin{definition}
A witness pre-net $\net{\lambda_\Sigma}AB$ has \defn{exact coverage} if for every link $\link CD$ in $\lambda_\Sigma$ the domain of $\sigma$ is exactly the existential variables of $C$ and $D$:
\[
	\dom\sigma = \ex[A]C\cup\ex[B]D~.
\]
\end{definition}
%
% ..................................................
%
The witness map $\sigma$ of a link $\link CD$ then has two natural components, $\sigma\res{\ex[A]C}$ and $\sigma\res{\ex[B]D}$, which we will abbreviate by $\sigma_C$ and $\sigma_D$ respectively.

Finally, note that a de-sequentialization $[\pi]$ has exact coverage.

%Note that the property is carefully formulated, using the \emph{exisential cover} rather than simply the free existential variables in a formula, to account for vacuous quantifiers.
% ($\exists x.C$ where $x$ is not free in $C$). The issue becomes even more pertinent for a link $\link CD$ where $C$ occurs in $\exists x.C{\+}C'$ and $x$ is free in $C'$ but not $C$, where we still would like an explicit witness for $x$ in $\sigma$. 


% --------------------------------------------------

\subsection{Correctness and sequentialization}

For sequentialization, the links in a pre-net will be labelled with a sequent proof. An axiom link will carry an axiom, and each coalescence step introduces one proof rule. Formalizing this, a \defn{proof linking} $\lambda_\Sigma^\Pi$ is a witness linking $\lambda_\Sigma$ with a \defn{proof labelling} $\Pi\colon \lambda\to\proofs$ assigning a sequent proof to each link. We will use and define $\lambda_\Sigma^\Pi$ as a set of \defn{proof links} $\link CD^\pi$, where we require that $\prf\pi{C\sigma}{D\sigma}$, i.e.\ that $\pi$ proves the conclusion $\seq{C\sigma}{D\sigma}$. A \defn{labelled pre-net} $\net{\lambda_\Sigma^\Pi}AB$ is a witness pre-net $\net{\lambda_\Sigma}AB$ with a proof labelling $\Pi$ on $\lambda_\Sigma$. If $\lambda_\Sigma$ is an axiom linking, we assign an \defn{initial proof labelling} $\lambda_\Sigma^\star$ as follows.
\[
	\lambda_\Sigma^\star = \{~\link ab^\pi~\mid~\link ab\in\lambda_\Sigma~,~\pi=~\infer{\seq{a\sigma}{b\sigma}}{}~\}
\]
For correctness we may coalesce a pre-net directly, without constructing a proof. 
%
Then to recap, we have accumulated the following further notational conventions.
%
\[
\begin{tabular}{@{}lcll@{}}
	$\pi,\phi,\psi$		& $\in$ & $\proofs$ & \all1 sequent proofs\\
	$\kappa,\lambda$ 	& $\subset$ & $\form\times\form$ 	& linkings (sets of pairs of formulas)\\
	$\rho,\sigma,\tau$	& $\colon$  & $\var\rightharpoonup\terms$ & witness maps\\
	$\Sigma,\Theta$		& $\colon$  & $\lambda\to\var\rightharpoonup\terms$		& witness labellings on a linking $\lambda$ \\
	$\Pi,\Phi,\Psi$		& $\colon$  & $\lambda\to\proofs$		& proof labellings on a linking $\lambda$
\end{tabular}
\]

% ..................................................

\begin{figure}
\[
\begin{array}{ccc@{\hspace{50pt}}ccc}
    \vc{\begin{tikzpicture}[net]
    	\formula[y=2]{C}
    	\formula[y=1]{D*{_1}{{\+}}D*{_2}}
    	\Vlink[red,label={$\scriptstyle\sigma~$},l]{1,1}
    \end{tikzpicture}}
&\scoal& 
    \vc{\begin{tikzpicture}[net]
    	\formula[y=2]{C}
    	\formula[y=1]{D*{_1}{{\+}}D*{_2}}
    	\Vlink[red,label={~$\scriptstyle\sigma$}]{1,2}
    \end{tikzpicture}}
&
    \vc{\begin{tikzpicture}[net]
    	\formula[y=2]{C}
    	\formula[y=1]{\exists x.D}
    	\Vlink[red,label={~$\scriptstyle\sigma$}]{1,4}
    \end{tikzpicture}}
&\stackrel{x\,\in\,\dom\sigma}\scoal&
    \vc{\begin{tikzpicture}[net]
    	\formula[y=2]{C}
    	\formula[y=1]{\exists x.D}
    	\Vlink[red,label={~$\scriptstyle{\sigma\minus x}$}]{1,1}
    \end{tikzpicture}}   
\\ \\   
    \vc{\begin{tikzpicture}[net]
    	\formula[y=2]{C}
    	\formula[y=1]{D*{_1}{{\*}}D*{_2}}
    	\Vlink[red,label={$\scriptstyle\sigma~$},l]{[-1]1,1}
    	\Vlink[red,label={~$\scriptstyle\sigma$}]{[1]1,3}
    \end{tikzpicture}}
&\scoal&
	\vc{\begin{tikzpicture}[net]
    	\formula[y=2]{C}
    	\formula[y=1]{D*{_1}{{\*}}D*{_2}}
    	\Vlink[red,label={~$\scriptstyle\sigma$}]{1,2}
    \end{tikzpicture}}   
&
    \vc{\begin{tikzpicture}[net]
    	\formula[y=2]{C}
    	\formula[y=1]{\forall x.D}
    	\Vlink[red,label={~$\scriptstyle\sigma$}]{1,4}
    \end{tikzpicture}}
&\stackrel{x\,\notin\,\sigma}\scoal&
    \vc{\begin{tikzpicture}[net]
    	\formula[y=2]{C}
    	\formula[y=1]{\forall x.D}
    	\Vlink[red,label={~$\scriptstyle\sigma$}]{1,1}
    \end{tikzpicture}}
\end{array}
\]
\caption{Coalescence rules}
\label{fig:coalescence}
\end{figure}

% ..................................................

\begin{definition}
%
\renewcommand{\+}{{+}}
\renewcommand{\*}{{\times}}
%
\defn{Strict sequentialization} ($\scoal$) is the rewrite relation on labelled pre-nets generated by the following rules, that replace one or two links by another in a pre-net $\net{\lambda_\Sigma^\Pi}AB$ (where $B$ has a subformula $D_1\+D_2$, $D_1\*D_2$, $\exists x.D$, and $\forall x.D$ respectively).
%
\begin{align*}
\tag{$\srr+i$}
	\link C{D_i}^\pi
	& \scoal
	\link C{D_1\+D_2}^\psi
	&& 
 	\psi=~\vc{\infer[\Qrr+i]{\seq{C\sigma}{D_1\sigma\,\+\,D_2\sigma}}  {\Prf \pi {C\sigma} {D_i\sigma}}}
\\ \\[-8pt]
\tag{$\srr*$}
	%\{\link C{D_1}^\pi\,,\,\link C{D_2}^\phi\}
	\left.\begin{array}{@{}l@{\,}}\link C{D_1}^\pi \\ \link C{D_2}^\phi\end{array}\right\}
	& \scoal
	\link C{D_1\*D_2}^\psi
	&&
	\psi=~\vc{\infer[\Qrr*]{\seq{C\sigma}{D_1\sigma\,\*\,D_2\sigma}}  {
      \Prf \pi {C\sigma} {D_1\sigma} & \Prf \phi {C\sigma} {D_2\sigma}    
	}}
\\ \\[-8pt]
\tag{$\srr?$}
	\link CD^\pi
	& \scoal
	\link[\sigma\minus x]C{\exists x.D}^\psi
	\quad{\scriptstyle(x\,\in\,\dom\sigma)}
	&&
	\psi=~\vc{\infer[\Qrr?{\sigma(x)}]{\seq{C(\sigma\minus x)}{\exists x.D(\sigma\minus x)}} {\Prf \pi {C\sigma} {D\sigma} }}	
\\ \\[-8pt]
\tag{$\srr!$}
	\link CD^\pi
	& \scoal
	\link C{\forall x.D}^\psi
	\quad{\scriptstyle\phantom{\minus x}(x\,\notin\,\sigma)}
	&&
	\psi=~\vc{\infer[\Qrr!]{\seq{C\sigma}{\forall x.D\sigma}} {\Prf \pi {C\sigma} {D\sigma}}}
\end{align*}
%
\defn{Strict coalescence} is the same relation on witness pre-nets, ignoring proof labels, illustrated in Figure~\ref{fig:coalescence}. A witness pre-net $\net{\lambda_\Sigma}AB$ \defn{strict-coalesces} if it reduces to $\net{\{\link[\varnothing]AB\}}AB$. It \defn{strongly} strict-coalesces if any coalescence path terminates at $\net{\{\link[\varnothing]AB\}}AB$.
\end{definition}

% ..................................................

\lutz{I guess there should be an example here.}

\begin{definition}
An \all1 \defn{witness proof net} or \defn{witness net} is a witness pre-net $\net{\lambda_\Sigma}AB$ with $\lambda_\Sigma$ an axiom linking, that strict-coalesces. It \defn{sequentializes} to a proof $\pi$ if its initial labelling $\net{\lambda_\Sigma^\star}AB$ reduces in $(\scoal)$ to $\net{\{\link[\varnothing]AB^\pi\}}AB$.
\end{definition}

% ..................................................

\begin{theorem}
\label{thm:proof->net->proof}
For any \all1 proof $\pi$, the witness net $[\pi]$ sequentializes to $\pi$. 
\end{theorem}

\begin{proof}
It follows by induction on $\pi$ that if $\lambda_\Sigma=\deseq{\prf\pi AB}{A'}{B'}$ where $A'\sigma=A$ and $B'\sigma=B$, then $\net{\lambda^\star_\Sigma}AB$ reduces in $(\scoal)$ to $\net{\{\link{A'}{B'}^\pi\}}AB$. The statement is the case $\sigma=\varnothing$.
\end{proof}

% ..................................................

\begin{theorem}
\label{thm:net->proof->net}
If $\net{\lambda_\Sigma}AB$ sequentializes to $\pi$, then $[\pi]$ is $\net{\lambda_\Sigma}AB$. 
\end{theorem}

\begin{proof}
By induction on the sequentialization path 
$\net{\lambda_\Sigma^\star}AB\scoal^*\net{\{\link[\varnothing]AB^\pi\}}AB$
it follows that in every pre-net $\net{\kappa_\Theta^\Phi}AB$ on this path, $\lambda_\Sigma$ is equal to the union over the de-sequentialization of all proof labels $\phi$ in $\Phi$:
\[
	\lambda_\Sigma=\bigcup~\{\,\deseq\phi CD \mid \link CD^\phi \in \kappa_\Theta^\Phi\,\}~.
\]
The statement is then the case $\kappa_\Theta^\Phi=\{\link[\varnothing]AB^\pi\}$.
\end{proof}

% --------------------------------------------------

\section{Geometric correctness}

A \defn{slice} is the fraction of a proof that depends on a given choice of one branch (or projection) on each product formula $A\*B$. Important to additive proof theory is that many operations can be performed on a per-slice basis, such as normalization, or proof net correctness. We will here use slices for the latter purpose.

As in the propositional case, we define a slice of a sequent $\seq AB$ as a set of potential links, of which exactly one must be realized in a proof net $\net{\lambda_\Sigma}AB$. For a witness linking $\lambda_\Sigma$ and variable $x$, write $\Sigma(x)\subseteq\terms$ for the \defn{witness set} of $x$, which collects the terms assigned to $x$ by the witness maps in $\Sigma$ for every link in $\lambda$:
\[
	\Sigma(x) = \{~\sigma(x)~\mid~\link CD\in\lambda_\Sigma~\}~.
\]

% ..................................................

\begin{definition}[Slice]
Given a witness linking $\lambda_\Sigma$, a \defn{slice} $S$ of a formula $A$ and a witness map $\sigma$ is a set of pairs $(A',\sigma')$, where $A'\leq A$ and $\sigma'\supseteq\sigma$, given by $S=\{(A,\sigma)\}\cup S'$ where:
%
\begin{itemize}
	\item
\makebox[65pt][l]{If $A = a$}			then $S'=\varnothing$.
	\item
\makebox[65pt][l]{If $A = B\+C$} 		then $S'=S_B\uplus S_C$ with $S_B$ a slice of $B$ and $\sigma$, and $S_C$ one of $C$ and $\sigma$.
	\item
\makebox[65pt][l]{If $A = B\*C$}		then $S'$ is a slice of $B$ and $\sigma$ or a slice of $C$ and $\sigma$.
	\item
\makebox[65pt][l]{If $A = \exists x.B$}	then $S'=\uplus_{t\,\in\,\Sigma(x)}S_t$ where each $S_t$ is a slice of $B$ and $\sigma[t/x]$.
	\item
\makebox[65pt][l]{If $A = \forall x.B$}	then $S'$ is a slice of $B$ and $\sigma$.
\end{itemize}
%
\noindent
A \defn{slice} of a sequent $\seq AB$ is a set of links
\[
	\{~\link[\sigma\cup\tau]CD~\mid~(C,\sigma)\in S_A~,~(D,\tau)\in S_B~\}
\]
where $S_A$ is a slice of $A$ and $\varnothing$, and $S_B$ a slice of $B$ and $\varnothing$.  A \defn{slice} of a witness pre-net $\net{\lambda_\Sigma} AB$ is the intersection $\lambda_\Sigma\cap S$ of $\lambda_\Sigma$ with a slice $S$ of $\seq AB$.
\end{definition}

% ..................................................

As in the propositional case, for correctness we will require that each slice is a singleton. In addition, within each slice we need to ensure that the order in which quantifiers are instantiated is sound. That is, we need to have an analogue of the \emph{eigenvariable condition} on the $\qrr!$-rule of sequent calculus, that the quantified variable $x$ of the formula $\forall x.A$ does not occur free in the context. We will define a \defn{dependency} condition to this effect. For simplicity we will define the dependency condition on individual links rather than on slices.
% (since each slice will be a singleton). 

In a pre-net $\net{\lambda_\Sigma}AB$, let the \defn{column} of a link $\link CD$ be the set of pairs 
\[
	\{~(X,\sigma\res{\ex[A]X})~\mid~C\sub X\sub A~\}\cup\{~(Y,\sigma\res{\ex[B]Y})~\mid~D\sub Y\sub B~\}~,
\]
with an order $(\dep)$ given by: $(X,\rho)\dep(Y,\tau)$ if $X\leq Y$ or $Y$ occurs as $\forall x.Y$ and $x\in\rho$.

%It is expected that for a more involved logic that includes multiplicative connectives, a dependency condition such as the below one needs to be applied to a slice instead.
%

% ..................................................

\begin{definition}
A witness pre-net is \defn{correct} if
\begin{itemize}
\item it has exact coverage,
\item it is \defn{slice-correct}: every slice is a singleton, and
\item it is \defn{dependency-correct}: every column is a partial order (i.e.\ is acyclic/antisymmetric).
\end{itemize}
\end{definition}

% ..................................................

\newcounter{lemcorrect}
\setcounter{lemcorrect}{\thetheorem}
\begin{lemma}
\label{lem:correct}
Strict coalescence preserves and reflects correctness.
\end{lemma}

\begin{proof}
See appendix.
\end{proof}

% ..................................................

\newcounter{lemcoalescenceapplies}
\setcounter{lemcoalescenceapplies}{\thetheorem}
\begin{lemma}
\label{lem:coalescence applies}
To a correct witness pre-net $\net{\lambda_\Sigma}AB$ a coalescence step applies, unless it is fully coalesced already, $\lambda_\Sigma=\{\link[\varnothing]AB\}$.
\end{lemma}

\begin{proof}
See appendix.
\end{proof}

% ..................................................

\begin{theorem}
\label{thm:correctness}
A witness pre-net is correct if and only if it strict-coalesces. 
\end{theorem}

\begin{proof}
From right to left, we proceed by induction on the coalescence path from $\net{\lambda_\Sigma}AB$ to $\net{\{\link[\varnothing]AB\}}AB$, with the end result as the base case. It is slice-correct: every slice of $\seq AB$ contains $\link[\varnothing]AB$, so every slice of $\net{\{\link[\varnothing]AB\}}AB$ is the singleton $\{\link[\varnothing]AB\}$. It is also dependency-correct: the column of $\link[\varnothing]AB$ is the set $\{(A,\varnothing),(B,\varnothing)\}$, where $A$ and $B$ are unrelated in $(\dep)$. For the inductive step, by Lemma~\ref{lem:correct} coalescence reflects correctness, so that any pre-net along the coalescence path is correct, in particular $\net{\lambda_\Sigma}AB$.

From left to right, let $\net{\lambda_\Sigma}AB$ be correct. By Lemma~\ref{lem:coalescence applies} either the net has coalesced, or a coalescence step applies. By Lemma~\ref{lem:correct} the result of this coalescence step is again correct. It follows that the pre-net $\net{\lambda_\Sigma}AB$ strict-coalesces.
\end{proof}

% ..................................................

\begin{corollary}
A correct witness pre-net with axiom linking is a witness proof net.
\end{corollary}

% ..................................................

\begin{corollary}
\label{cor:strong coalescence}
A correct witness pre-net strongly strict-coalesces.
\end{corollary}

\begin{proof}
By Theorem~\ref{thm:correctness} a correct pre-net coalesces, and by Lemma~\ref{lem:correct} any coalescence step preserves correctness.
\end{proof}

% ..................................................

\begin{theorem}
Proof nets are canonical: $[\pi]=[\phi]$ if and only if $\pi\sim\phi$.
\end{theorem}

\begin{proof}
From left to right is by inspection of the critical pairs of sequentialization ($\scoal$). From right to left is by inspection of the rule permutations in Figure~\ref{fig:permutations} in the Appendix.
\end{proof}

% --------------------------------------------------

\section{Composition}

% ..................................................
\begin{figure}
\[
\begin{array}{ccc}
	\vc{
	\infer[\!\!\scriptstyle{\mathrm{cut}}]{\Seq AC}{
	 \infer[\!\!\scriptstyle{\qrr*}]{\Seq A{B_1\*B_2}\vphantom{\dual B}}{\Prf{\pi_1}A{B_1} & \Prf{\pi_2}A{B_2}}
	 &&
	 \infer[\!\!\scriptstyle{\qrr+i}]{\Seq {\dual B_1\+\dual B_2}C}{\Prf\phi{B_i}C}
	}}
	&\Rightarrow&
	\vc{\infer[\!\!\scriptstyle{\mathrm{cut}}]{\Seq AC}{\Prf{\pi_i}A{B_i} && \Prf\phi{\dual B_i}C}}
\\ \\
	\vc{
	\infer[\!\!\scriptstyle{\mathrm{cut}}]{\Seq AC}{
	 \infer[\!\!\scriptstyle{\qrr?t}]{\Seq A{\exists x.B}}{\Prf\pi A{B[t/x]}}
	 &&
	 \infer[\!\!\scriptstyle{\qrr!}]{\Seq {\forall x.\dual B}C}{\Prf\phi{\dual B}C}
	}}
	&\Rightarrow&
	\vc{\infer[\!\!\scriptstyle{\mathrm{cut}}]{\Seq AC}{\Prf\pi A{B[t/x]} && \Prf{\phi[t/x]}{\dual B[t/x]}C}}
\end{array}
\]
\caption{\all1 cut-elimination steps}
\label{fig:cut-elim}
\end{figure}
% ..................................................

The \defn{domain-preserving composition} of two witness maps $\sigma\dcom\tau$ is the map $(\sigma\tau)\res{\dom\sigma}$.

The \defn{least fixed point} $\fix\sigma$ of a witness map $\sigma$ is the least map $\rho$ satisfying $\rho = \rho\sigma$. It is the shortest sequence $\fix\sigma=\sigma\sigma\dots\sigma$ such that no variable is both in the domain and range of $\fix\sigma$. Where it is used, in the composition of the witness maps of two links, we will need to demonstrate that it is well defined.

% ..................................................
\begin{definition}
The \defn{composition} $\link AB^\pi\comp\link[\tau]{\dual B}C^\phi$ of two proof links is $\link[\rho]AC^\psi$ where
\[
	\rho = \sigma_A\tau_C\dcom\fix{\sigma_B\tau\subdual B}
\qquad\text{and}\qquad
	\psi = ~\vcenter{
	\infer[\!\!\scriptstyle{\mathrm{cut}}]{\seq {A\rho}{B\rho}}{
	 \left(\vcenter{\deduce{\seq{A\sigma}{B\sigma}\vphantom{\dual B}}{\vphantom\phi\pi}}\right)\fix{\sigma_B\tau\subdual B}
	&\left(\vcenter{\deduce{\seq{\dual B\tau}{C\tau}}{\phi}}\right)\fix{\sigma_B\tau\subdual B}
	}}~.
\]
The \defn{composition} $\lambda_\Sigma^\Pi\comp\kappa_\Theta^\Phi$ of two linkings is the linking
\[
	\{~\link XY^\pi\comp\link[\tau]{\dual Y}Z^\phi
		~\mid~
		\link XY^\pi\in{\lambda_\Sigma^\Pi}
		~,~
		\link[\tau]{\dual Y}Z^\phi\in\kappa_\Theta^\Phi~\}
\]
The \defn{composition} $(\net{\lambda_\Sigma^\Pi}AB)\comp(\net{\kappa_\Theta^\Phi}{\dual B}C)$ of two pre-nets is the pre-net $\net{(\lambda_\Sigma^\Pi\comp\kappa_\Theta^\Phi)}AC$.
\end{definition}
% ..................................................

These compositions may omit proof annotations and witness annotations.

The composition of two links is strongly related to composition of strategies in game semantics. There, two strategies on $\seq AB$ and $\seq{\dual B}C$ are composed by \emph{interaction} on the interface of $B$ and $\dual B$, and subsequently \emph{hiding} that interaction. 

%	\net{\{~\link[\rho]XZ~\mid~\link XY\in{\lambda_\Sigma}~,~\link[\tau]{\dual Y}Z\in\kappa_\Theta~,~\rho = (\sigma\cyc\tau)\res{\ex AX\,\cup\,\ex CZ}~\}~}AC
%~\rho=\sigma_A\tau_{\smash{\,\dual{\!B}}\vphantom B}\cup\tau_C\sigma_B~
%(\sigma\res{\ex AX})(\tau\res{\ex{\dual B}{\dual Y}})\cup(\tau\res{\ex CZ})(\sigma\res{\ex BY})


\cite{Mimram-2011}

\lutz{why the fixpoint?}

\todo{example: $\forall x.\exists y.\forall z.P$ with $[f(x)/y]$ cut against $\exists x.\forall y.\exists z.\dual P$ with $[a/x,g(y)/z]$.}


In the following we will demonstrate that composition gives the desired result: if a net $L$ sequentializes to $\pi$ and $R$ to $\phi$, then $L\comp R$ sequentializes to a normal form of the composition of $\pi$ and $\phi$ with a cut. To this end we will explore how composition and sequentialization interact. We will consider the critical pairs of sequentialization with composition, and demonstrate how they are resolved.

\lutz{some itemizing environment?}

The first critical pair of composition (downward as $\Rightarrow$) and sequentialization is the following. We consider the composition of pre-nets on $\seq AB$ and $\seq{\dual B}C$ where $B=B_1\*B_2$, with a synchronized sequentialization step on both pre-nets.
\[
\begin{array}{ccc}
    \vc{
    \begin{tikzpicture}[net]
        \formula[y=3]{A}
        \formula[y=1.8]{B*{_1}\*B*{_2}}
        \Vlink[red,label={$\scriptstyle{\pi,\sigma\vphantom)~}$},l]{[-2]1,1}
        \Vlink[red,label={$\scriptstyle{~\pi'\!,\sigma\vphantom)}$},r]{[2]1,3}
        \formula[y=1.2]{{\dual B}*{_1}\+{\dual B}*{_2}}
        \formula[y=0]{C}
        \Vlink[red,label={$\scriptstyle{\phi,\tau\vphantom)~}$},l]{1,1}
    \end{tikzpicture}}
    & 
    \begin{array}{c}\scoal\\[40pt]\scoal\end{array}
    &
    \vc{
    \begin{tikzpicture}[net]
        \formula[y=3]{A}
        \formula[y=1.8]{B*{_1}\*B*{_2}}
        \Vlink[red,label={$\scriptstyle{\pi''\!\!,\sigma\vphantom)~}$},l]{1,2}
        \formula[y=1.2]{{\dual B}*{_1}\+{\dual B}*{_2}}
        \formula[y=0]{C}
        \Vlink[red,label={$\scriptstyle{\phi'\!,\tau\vphantom)~}$},l]{2,1}
    \end{tikzpicture}}
\\\\[-5pt] \Downarrow && \Downarrow \\\\[-5pt]
    \vc{
    \begin{tikzpicture}[net]
        \formula[y=1.2]{A}
        \formula[y=0]{C}
        \Vlink[red,label={\makebox[0pt][r]{$\scriptstyle{\psi,\rho\vphantom)~}$}},l]{1,1}
    \end{tikzpicture}}
    &&
    \vc{
    \begin{tikzpicture}[net]
        \formula[y=1.2]{A}
        \formula[y=0]{C}
        \Vlink[red,label={\makebox[0pt][r]{$\scriptstyle{\psi',\rho'\vphantom)~}$}},l]{1,1}
    \end{tikzpicture}}
\end{array}
\qquad
\begin{array}{l@{\,}l}
	\rho  &=~ \sigma_A\tau_C\dcom\fix{\sigma_B\tau\subdual B} 
\\ \\
	\rho' &=~ \sigma_A\tau_C\dcom\fix{\sigma_{B_1}\tau\subdual{B_1}}
\\ \\
	\psi &=~\vc{
	\infer[\!\!\scriptstyle{\mathrm{cut}}]{\seq{A\rho}{C\rho}}{
	 \left(\vc{
	  \deduce{\seq{A\sigma}{B_1\sigma}\vphantom{\dual B_1}}{\pi\vphantom)}
	 }\right)\fix{\sigma_{B_1}\tau\subdual{B_1}}
	 &
	 \left(\vc{
	  \deduce{\seq{\dual B_1\tau}{C\tau}}{\phi\vphantom)}
	 }\right)\makebox[0pt][l]{$\fix{\sigma_{B_1}\tau\subdual{B_1}}$}
	}}
\\ \\ \\
	\psi' &= ~
	\vc{\scalebox{0.75}{$
	\infer[\!\!\scriptstyle{\mathrm{cut}}]{\seq{A\rho'}{C\rho'}}{
	 \left(\vc{\infer{\seq{A\sigma}{B_1\sigma\*B_2\sigma}\vphantom{\dual B}}{
	  \deduce{\seq{A\sigma}{B_1\sigma}\vphantom{\dual B}}{\pi\vphantom)}
	  &
	  \deduce{\seq{A\sigma}{B_2\sigma\vphantom{\dual B}}}{\pi'\vphantom)}
	 }}\right)\fix{\sigma_B\tau\subdual B}
	 &
	 \left(\vc{\infer{\seq{\dual B_1\tau\+\dual B_2\tau}{C\tau}}{
	  \deduce{\seq{\dual B_1\tau}{C\tau}}{\phi\vphantom)}
	 }}\right)\makebox[0pt][l]{$\fix{\sigma_B\tau\subdual B}$}
	}$}\kern5pt}
\end{array}
\]
Since the existential covers of $B$ and $B_1$ are the same, $\sigma_B\tau\subdual B = \sigma_{B_1}\tau\subdual{B_1}$ and $\rho=\rho'$. It then follows that $\psi'$ cut-eliminates in one step to $\psi$.

The next critical pair is the following.
\[
\begin{array}{ccc}
    \vc{
    \begin{tikzpicture}[net]
        \formula[y=3]{A}
        \formula[y=1.8]{\exists x.B}
        \Vlink[red,label={\makebox[0pt][l]{~$\scriptstyle{\pi,\sigma\vphantom)}$}},r]{1,4}
        \formula[y=1.2]{\forall x.{\dual B}}
        \formula[y=0]{C}
        \Vlink[red,label={\makebox[0pt][l]{~$\scriptstyle{\phi,\tau\vphantom)}$}},r]{4,1}
    \end{tikzpicture}}
    & 
    \begin{array}{c}\scoal\\[40pt]\stackrel{x\,\notin\,\tau\vphantom)}\scoal\end{array}
    &
    \vc{
    \begin{tikzpicture}[net]
        \formula[y=3]{A}
        \formula[y=1.8]{\exists x.B}
        \Vlink[red,label={\makebox[0pt][l]{~$\scriptstyle{\pi',\sigma\minus x\vphantom)}$}},r]{1,1}
        \formula[y=1.2]{\forall x.{\dual B}}
        \formula[y=0]{C}
        \Vlink[red,label={\makebox[0pt][l]{~$\scriptstyle{\phi',\tau\vphantom)}$}},r]{1,1}
    \end{tikzpicture}}
\\\\ \Downarrow && \Downarrow \\\\
    \vc{ 
    \begin{tikzpicture}[net]
        \formula[y=1.2]{A}
        \formula[y=0]{C}
        \Vlink[red,label={\makebox[0pt][l]{~$\scriptstyle{\psi,\rho\vphantom)}$}},r]{1,1}
    \end{tikzpicture}}
    &&
    \vc{
    \begin{tikzpicture}[net]
        \formula[y=1.2]{A}
        \formula[y=0]{C}
        \Vlink[red,label={\makebox[0pt][l]{~$\scriptstyle{\psi',\rho'\vphantom)}$}},r]{1,1}
    \end{tikzpicture}}
\end{array}
%
\qquad\quad
%
\begin{array}{l@{\,}l}
	\rho  &=~ \sigma_A\tau_C\dcom\fix{\sigma_B\tau\subdual B}
\\ \\
	\rho' &=~ \sigma_A\tau_C\dcom\fix{(\sigma_B\minus x)\tau\subdual B}
\\ \\
	\psi  &=~
	\vc{
	\infer[\!\!\scriptstyle{\mathrm{cut}}]{\seq{A\rho}{C\rho}}{
	 \left(\vc{
	  \deduce{\seq{A\sigma}{B\sigma}\vphantom{\dual B}}{\pi\vphantom)}
	 }\right)\fix{\sigma_B\tau\subdual B}
	 &
	 \left(\vc{
	  \deduce{\seq{\dual B\tau}{C\tau}}{\phi\vphantom)}
	 }\right)\makebox[0pt][l]{$\fix{\sigma_B\tau\subdual B}$}
	}}
\\ \\ \\
	\psi' &=~ 
	\vc{\scalebox{0.8}{$
	\infer[\!\!\scriptstyle{\mathrm{cut}}]{\seq{A\rho'}{C\rho'}}{
	 \left(\vc{\infer{\seq{A\sigma}{\exists x.B\sigma\minus x}\vphantom{\dual B}}{
	  \deduce{\seq{A\sigma}{B\sigma}\vphantom{\dual B}}{\pi\vphantom)}
	 }}\right)\fix{(\sigma_B\minus x)\tau\subdual B}
	 &
	 \left(\vc{\infer{\seq{\forall x.\dual B\tau}{C\tau}}{
	  \deduce{\seq{\dual B\tau}{C\tau}}{\phi\vphantom)}
	 }}\right)\makebox[0pt][l]{$\fix{(\sigma_B\minus x)\tau\subdual B}$}
	}$}}
	\rule{25pt}{0pt}
\end{array}
\]

Since $x$ is not free in the range of $\tau$, and (by the freshness convention) nor in the range of $\sigma$, we have that $\fix{\sigma_B\tau\subdual B}$ is $\fix[1pt]{(\sigma_B\minus x)\tau\subdual B}$ plus the substitution $[\sigma(x)/x]$. Then $\rho=\rho'$ (as $x$ does not occur in the range of $\sigma_A\tau_C$) and $\psi'$ reduces to $\psi$ in a single cut-elimination step.

\willem{Dominic: plz check grammar above.}


\[
\begin{array}{ccc}
    \vc{
    \begin{tikzpicture}[net]
        \formula[y=3]{A}
        \formula[y=1.8]{B}
        \Vlink[red,label={\makebox[0pt][l]{~$\scriptstyle{\pi,\sigma\vphantom)}$}},r]{1,1}
        \formula[y=1.2]{{\dual B}}
        \formula[y=0]{\exists x.C}
        \Vlink[red,label={\makebox[0pt][r]{~$\scriptstyle{\phi,\tau\vphantom)}$~}},l]{1,4}
    \end{tikzpicture}}
    & 
    \begin{array}{c}\\[45pt]\scoal\end{array}
    &
    \vc{
    \begin{tikzpicture}[net]
        \formula[y=3]{A}
        \formula[y=1.8]{B}
        \Vlink[red,label={\makebox[0pt][l]{~$\scriptstyle{\pi,\sigma\vphantom)}$}},r]{1,1}
        \formula[y=1.2]{{\dual B}}
        \formula[y=0]{\exists x.C}
        \Vlink[red,label={\makebox[0pt][l]{~$\scriptstyle{\phi',\tau\minus x\vphantom)}$}},r]{1,1}
    \end{tikzpicture}}
\\\\ \Downarrow && \Downarrow \\\\
    \vc{ 
    \begin{tikzpicture}[net]
        \formula[y=1.2]{A}
        \formula[y=0]{\exists x.C}
        \Vlink[red,label={\makebox[0pt][r]{~$\scriptstyle{\psi,\rho\vphantom)}$~}},l]{1,4}
    \end{tikzpicture}}
    &&
    \vc{
    \begin{tikzpicture}[net]
        \formula[y=1.2]{A}
        \formula[y=0]{\exists x.C}
        \Vlink[red,label={\makebox[0pt][l]{~$\scriptstyle{\psi',\rho'\vphantom)}$}},r]{1,1}
    \end{tikzpicture}}
\end{array}
%
\qquad\quad
%
\begin{array}{l@{\,}l}
	\rho  &=~ \sigma_A\tau_C\dcom\fix{\sigma_B\tau\subdual B}
\\ \\
	\rho' &=~ \sigma_A(\tau_C\minus x)\dcom\fix{\sigma_B\tau\subdual B}
\\ \\
	\psi &=~
	\vc{
	\infer[\!\!\scriptstyle{\mathrm{cut}}]{\seq{A\rho}{C\rho}}{
	 \left(\vc{
	  \Prf\pi{A\sigma}{B\sigma}
	 }\right)\fix{\sigma_B\tau\subdual B}
	 &
	 \left(\vc{
	  \Prf\phi{\dual B\tau}{C\tau}
	 }\right)\fix{\sigma_B\tau\subdual B}
	}}
\\ \\
	\psi' &=~
	\vc{
	\infer[\!\!\scriptstyle{\mathrm{cut}}]{\seq{A\rho'}{C\rho'}}{
	 \left(\vc{
	  \Prf\pi{A\sigma}{B\sigma}
	 }\right)\fix{\sigma_B\tau\subdual B}
	 &
	 \left(\vc{
	  \infer{\Seq{\dual B\tau}{\exists x.C(\tau\minus x)}}{\Prf\phi{\dual B\tau}{C\tau}}
	 }\right)\fix{\sigma_B\tau\subdual B}
	}}
\end{array}
\]
Observe that since $x$ occurs in $C$ but not $B$, it is not in the domain of $\tau_B$, so that $\tau_B\minus x$ is just $\tau_B$. Then $\rho'=\rho\minus x$, and the diagram is closed by a sequentialization step (from left to right) that extends $\psi$ with an existential introduction rule, to a proof equivalent to $\psi'$:
\[
	\infer[\!\!\scriptstyle{\qrr?{\rho(x)}}]{\Seq{A\rho'}{\exists x.C\rho'}}{
	 \Prf\psi{A\rho}{C\rho}
	}
\]

There are three further critical pairs, for a proof net on $\seq AB$ composed with one on $\seq {\dual B}{C_1{\+}C_2}$, one on $\seq {\dual B}{C_1{\*}C_2}$, and one on $\seq {\dual B}{\forall x.C}$. These converge as the one above.

% ..................................................
\begin{theorem}
\label{thm:composition}
If proof nets $\net{\lambda_\Sigma}AB$ and $\net{\kappa_\Theta}{\dual B}C$ sequentialize to $\pi$ and $\phi$ respectively, then their composition $(\net{\lambda_\Sigma}AB)\comp(\net{\kappa_\Theta}{\dual B}C)$ sequentializes to a normal form $\psi$ of the proof
\[
	\infer[\Qrr.]{\seq AC}{
	 \Prf\pi AB & \Prf\phi{\dual B}C
	}
\]
\end{theorem}

\begin{proof}
By Corollary~\ref{cor:strong coalescence} the proof nets $L=\net{\lambda_\Sigma}AB$ and $R=\net{\kappa_\Theta}{\dual B}C$ strongly coalesce. We may then interleave their coalescence sequences as follows: if a synchronized step in $L$ and $R$ on the interface $B$ and $\dual B$ is available, apply it; otherwise perform steps in $L$ on $A$ and in $R$ on $C$ until it is. This gives the following combined sequence.
\[
\begin{array}{c@{~}c@{~}c@{~}l@{~}c@{~}l@{~}c@{~}l@{~}c}
	L &{}={}& L_1 & ~\scoal^?~ & L_2 & ~\scoal^?~ & \dots & ~\scoal^?~ & L_n 
\\
	R &{}={}& R_1 & ~\scoal^?~ & R_2 & ~\scoal^?~ & \dots & ~\scoal^?~ & R_n 
\\[5pt]
	\Downarrow && \Downarrow && \Downarrow &&&& \Downarrow 
\\[5pt]
	L\comp R & = & L_1\comp R_1 & ~\scoal~ & L_2\comp R_2 & ~\scoal~ & \dots & ~\scoal~ & L_n\comp R_n
\end{array}
\]
(Here, $(\scoal^?)$ is the relation $(\scoal)\cup(=)$, but we assume that at least $L_i\scoal L_{i+1}$ or $R_i\scoal R_{i+1}$.)
%
The path along the top and right of this diagram sequentializes $L$ to $\pi'$ and $R$ to $\phi'$ (equivalent to $\pi$ and $\phi$ respectively), and then composes to $L_n\comp R_n = \net{\{\link[\varnothing]AC^{\psi'}\}}AC$ with
\[
	\psi' = \vc{\infer[\!\!\scriptstyle{\mathrm{cut}}]{\seq AC}{\Prf{\pi'}AB & \Prf{\phi'}{\dual B}C}}~.
\]

Each square of the diagram converges as one of the critical pairs of sequentialization and composition discussed above. Then each path along the diagram from top left ($L$ and $R$) to bottom right $(L_n\comp R_n)$ gives a sequentialization, with cuts, of $L_n\comp R_n$. Let the path taking the vertical step from $L_i$ and $R_i$ to $L_i\comp R_i$ sequentialize to $\psi_i$, so that $\psi_n=\psi'$. By the way each square converges, we have that $\psi_i$ is reached from $\psi_{i+1}$ by a cut-elimination or permutation step. 

Finally, in $L$ and $R$ every link is an axiom link. Any link in $L\comp R$ is composed from two links $\link ab$ in $L$ and $\link[\tau]{\dual b}c$ in $R$, which yields $\link[\rho]ac$ where $\rho = \sigma_a\tau_c\dcom\fix{\sigma_b\tau\subdual b}$. This sequentializes to the axiom $\infer{\seq{a\rho}{c\rho}}{}$, which is in normal form. Then $L\comp R$ is a proof net (it has an axiom linking and it coalesces), and it sequentializes to a normal form of $\psi$.
%
%which sequentialize respectively to. 
%\[
%	\infer{\seq{a\sigma}{b\sigma}}{} 
%	\qquad\text{and}\qquad
%	\infer{\seq{\dual b\tau}{c\tau}}{}~.
%\]
%We have the link 
\end{proof}

% --------------------------------------------------

\section{Unification nets}

%\[
%	\vc{
%	 \infer[\Qrr*]{\seq{A\*B}{\exists x.C}}{
%	  \infer[\Qrr?y]{\seq A{\exists x.C}}{\seq AC}
%	  &
%	  \infer[\Qrr?z]{\seq B{\exists x.C}}{\seq BC}
%	}}
%	\quad\sim\quad
%	\vc{
%	 \infer[\Qrr?y]{\seq{A\*B}C}{
%	  \infer[\Qrr*]{\seq{A\*B}{\exists x.C}}{
%	   \seq AC
%	   &
%	   \seq BC
%	}}}
%\]



A proof $\pi$ is \defn{more general} than $\pi'$, written $\pi\leq\pi'$, if there is a substitution map $\rho$ such that $\pi\rho=\pi'$.

\[
	\vc{
	 \infer[\Qrr*]{\seq{A\*B}{\exists x.C}}{
	  \infer[\Qrr?s]{\seq A{\exists x.C}}{\seq AC}
	  &
	  \infer[\Qrr?t]{\seq B{\exists x.C}}{\seq BC}
	}}
	\quad\sim\quad
	\vc{
	 \infer[\Qrr?u]{\seq{A\*B}C}{
	  \infer[\Qrr*]{\seq{A\*B}{\exists x.C}}{
	   \seq AC
	   &
	   \seq BC
	}}}
\]



We define the following further operations on witness maps.
\[
\begin{tabular}{@{}p{.10\textwidth}@{}p{.90\textwidth}@{}}
	\quad$\sigma\gen\tau$
&
	A witness map $\sigma$ is \defn{more general} than $\tau$,  
	$\sigma\gen\tau$, if there is a map $\rho$ such that 
	$\sigma\rho=\tau$.
\\[4pt]	
	\quad$\sigma\coh\tau$
&
	Two witness maps $\sigma$ and $\tau$ are \defn{coherent}, $\sigma\coh\tau$,
	if there is a map $\rho$ such that $\sigma\rho=\tau\rho$.
\\[4pt]
	\quad$\sigma\join\tau$
&
	The \defn{join} $\sigma\join\tau$ of two coherent witness maps is the least map $\rho$ such that $\sigma\gen\rho$ and $\tau\gen\rho$.
\end{tabular}%
\]
%
A link $\link[]ab$ on two atomic formulas is an \defn{axiom} link if there exists a witness map $\sigma$ such that $a\sigma=\dual b\sigma$. To an axiom link $\link[]ab$ over $\seq AB$ we assign an \defn{initial witness map}, which is the least witness map $\sigma$ over the domain $\ex[\!A]a\cup\ex[\!B]b$ such that $a\sigma=\dual b\sigma$. In other words, $\sigma$ is the most general unifier of $a$ and $\dual b$, over the given domain, written $\init ab$. For an axiom linking $\lambda$ over $\seq AB$ the \defn{initial witness pre-net} $\net{\lambda_\star}AB$ is given by
\[
	\lambda_\star = \{~\link ab~\mid~\link[]ab\in\lambda~,~\sigma=\init ab~\}~.
\]
Observe that the initial witness pre-net satisfies the \emph{exact coverage} condition.

% ..................................................
\begin{definition}
%
\renewcommand{\+}{{+}}
\renewcommand{\*}{{\times}}
%
\defn{Unifying sequentialization} ($\ucoal$) is the rewrite relation on labelled pre-nets generated by the rules
$(\urr+i)$, $(\urr?)$, $(\urr!)$, which are respectively as $(\srr+i)$, $(\srr?)$, and $(\srr!)$, and the rule
\begin{equation}
\tag{$\urr*$}
	\left.\begin{array}{@{}l@{\,}}\link C{D_1}^\pi \\ \link[\tau]C{D_2}^\phi\end{array}\right\}
	\ucoal
	\link[\sigma\join\tau\,=\,\sigma\rho\,=\,\tau\rho]C{D_1\*D_2}^\psi
	\quad~
	{\scriptstyle(\sigma\coh\tau)}
	\quad~
	\psi=~
  \vc{\scalebox{0.9}{$
   \infer  {\seq{A(\sigma{\join}\tau)}{B\sigma\rho\,\*\,C\tau\rho}}  {
    \left( \vc{\Prf \pi {A\sigma} {B\sigma}} \right)\rho
    &
    \left( \vc{\Prf \phi {A\tau} {C\tau}} \right)\rho   
  }$}}
\end{equation} 
%
\defn{Unifying coalescence} is the relation ($\ucoal$) on witness pre-nets, ignoring proof labels. A witness pre-net $\net{\lambda_\Sigma}AB$ \defn{unifying-coalesces} if it reduces to $\net{\{\link[\varnothing]AB\}}AB$ and \defn{strongly} unifying-coalesces if any coalescence path terminates at $\net{\{\link[\varnothing]AB\}}AB$.
\end{definition}
% ..................................................

Observe that unifying coalescence includes strict coalescence, $(\scoal)\subseteq(\ucoal)$.

% ..................................................
\begin{definition}
An \all1 \defn{unification proof net} or \defn{unification net} is a pre-net $\net\lambda AB$ with axiom linking $\lambda$ such that the initial witness pre-net $\net{\lambda_\star}AB$ unifying-coalesces. It \defn{sequentializes} to $\pi$ if $\net{\lambda^\star_\star}AB$ reduces in $(\ucoal)$ to $\net{\{\link[\varnothing]AB^\pi\}}AB$.
\end{definition}
% ..................................................

In the above definition, note that $\lambda_\star^\star=(\lambda_\star)^*$ is the initial proof labelling of $\lambda_\star$, which assigns an axiom rule to each axiom link.

% ..................................................
\begin{lemma}
\label{lem:ucoal generality}
In ($\ucoal$), if $\net{\lambda_\Sigma}AB$ sequentializes to $\pi$ then $\net{\lambda_\star}AB$ sequentializes to $\pi'\leq\pi$.
\end{lemma}

\begin{proof}
The sequentialization path
$
	\net{\lambda_\Sigma^\star}AB = 
	L_1 \ucoal L_2 \ucoal \dots \ucoal L_n = 
	\net{\link[\varnothing]AB^\pi}AB
$
has a corresponding path
$
	\net{\lambda_\star^\star}AB = 
	R_1 \ucoal R_2 \ucoal \dots \ucoal R_n =
	\net{\link[\varnothing]AB^{\pi'}}AB
$
where the same links (but with potentially different witness maps) are coalesced. It follows by induction on this path (where the base case is $L_1$ and $R_1$) that for every corresponding pair of links $\link CD^\phi$ in $L_i$ and $\link[\tau]CD^\psi$ in $R_i$ we have $\tau\leq\sigma$ and $\psi\leq\phi$.
\end{proof}
% ..................................................

% ..................................................
\begin{lemma}
\label{lem:unifying implies strict coalescence}
If $\net{\lambda_\star}AB$ unifying-sequentializes to $\pi$ then there exists a witness assignment $\Sigma$ and substitution $\rho$ such that $\net{\lambda_\Sigma}AB$ strict-sequentializes to $\pi$ and $\lambda_\Sigma=\lambda_\star\rho$.
\end{lemma}

\begin{proof}
By induction on the sequentialization path $\net{\lambda_\star}AB\ucoal^*\net{\link[\varnothing]AB^\pi}AB$. For the end result, the statement holds with $\rho=\varnothing$. For the inductive step, consider a step $L\ucoal R$. We show the case ($\urr*$); the other cases are immediate.
%
\begin{itemize}
	\item
$\link C{D_1},\link[\tau]C{D_2}\ucoal\link[\sigma\join\tau]C{D_1{\*}D_2}$
\\
By the inductive hypothesis, $R\rho'$ strict-sequentializes to $\pi$. Let $\sigma\join\tau=\sigma\rho''=\tau\rho''$ and let $\rho=\rho''\rho'$. Then $L\rho$ strict-sequentializes to $\pi$ by 
\[
	\link[\sigma\rho]C{D_1},\link[\tau\rho]C{D_2}\scoal\link[(\sigma\join\tau)\rho']C{D_1{\*}D_2}~.
\qedhere
\]
\end{itemize}
\end{proof}
% ..................................................



% ..................................................
\begin{theorem}
If $[\prf\pi AB]$ is $\net{\lambda_\Sigma}AB$ then $\net\lambda AB$ unifying-sequentializes to $\pi'\leq \pi$.
\end{theorem}

\begin{proof}
By Theorem~\ref{thm:proof->net->proof}, $\net{\lambda_\Sigma}AB$ sequentializes to $\pi$ in $(\scoal)$, and hence also in $(\ucoal)$. Then by Lemma~\ref{lem:ucoal generality} $\net{\lambda_\star}AB$ sequentializes to $\pi'\leq\pi$.
\end{proof}
% ..................................................


% ..................................................
\begin{theorem}
If $\net\lambda AB$ sequentializes to $\pi$, then $[\pi]=\net{\lambda_\Sigma} AB$ for some $\Sigma$.
\end{theorem}

\begin{proof}
By Lemma~\ref{lem:unifying implies strict coalescence}, since $\net\lambda AB$ sequentializes to $\pi$ there is a net $\net{\lambda_\Sigma} AB$ that sequentializes to $\pi$. By Theorem~\ref{thm:net->proof->net}, $[\pi]=\net{\lambda_\Sigma} AB$.
\end{proof}
% ..................................................


% ..................................................
\begin{theorem}
If $\net\lambda AB$ sequentializes to $\pi$ and $\net\kappa{\dual B}C$ to $\phi$ then their composition $\net{\lambda\comp\kappa}AC$ sequentializes to a proof $\psi''\leq\psi'$ where $\psi'$ is a normal form of the proof 
\[
	\psi~=~
	\vc{\infer[\Qrr.]{\seq AC}{
	 \Prf\pi AB & \Prf\phi{\dual B}C
	}}~.
\]
\end{theorem}

\begin{proof}
By Lemma~\ref{lem:unifying implies strict coalescence} there are witness labellings $\Sigma$ and $\Theta$ such that $\net{\lambda_\Sigma}AB$ strict-sequentializes to $\pi$ and $\net{\kappa_\Theta}{\dual B}C$ to $\phi$. By Theorem~\ref{thm:composition} their composition $(\net{\lambda_\Sigma\comp\kappa_\Theta)}AC$ strict-sequentializes to a normal form $\psi'$ of $\psi$. By Lemma~\ref{lem:ucoal generality} the net $\net{(\lambda\comp\kappa)_\star}AC$ unifying-sequentializes to $\psi''\leq\psi'$.
\end{proof}



\bibliography{ALL1}

% ==================================================

\newpage
\appendix

\section{Postponed proofs}

% ..................................................

\setcounter{theorem}{\thelemcorrect}
\begin{lemma}[Restatement]
Strict coalescence preserves and reflects correctness.
\end{lemma}

\begin{proof}
For a strict coalescence step $L\scoal R$, we will show that the witness pre-net $L$ is correct if and only if $R$ is. Let $L=\net{\lambda_\Sigma}AB$ and $R=\net{\kappa_\Theta}AB$. In each case, exact coverage is immediately preserved and reflected. For slice-correctness, we will demonstrate that the left-hand side and right-hand side of each rule belong to the same slice of $\seq AB$, or in the case of $\srr?$, naturally corresponding slices. For dependency-correctness, we will briefly show how acyclicity of the columns of the involved links is preserved.

\begin{itemize}
	\item
$\link C{D_i}\scoal\link C{D_1{\+}D_2}$
\\
A slice $S_B$ of $B$ and $\varnothing$ containing one of $(D_1,\tau)$, $(D_2,\tau)$, and $(D_1\+D_2,\tau)$ must also contain the other two. 
%
%% \lutz{something is confusing here. It seems you are using different notions of slice. Above it says that correctness means that slices are singletons, and here you imply that slices contain more than one element.}
%% %
%% \willem{Indeed. A slice of a NET is singleton; a slice of FORMULA or SEQUENT need not be.}
%
A slice $S$ of $\seq AB$ then contains all three of $\link C{D_1}$, $\link C{D_2}$, and $\link C{D_1{\+}D_2}$, or none. It follows that $S\cap \lambda_\Sigma$ is a singleton if and only if $S\cap\kappa_\Theta$ is. Since other slices are unaffected, $L$ is slice-correct if and only if $R$ is.

For dependency-correctness, the column of $\link C{D_i}$ is that of $\link C{D_1{\+}D_2}$ plus the pair $(D_i,\sigma\res{\ex[B]{D_i}})$ itself, which is minimal in the order $\dep$.

	\item
$\link C{D_1},\link C{D_2}\scoal\link C{D_1{\*}D_2}$
\\
A slice $S$ of $\seq AB$ contains $\link C{D_1{\*}D_2}$ if and only if it contains either of $\link C{D_1}$ or $\link C{D_2}$, and cannot contain both. Then $S\cap \lambda_\Sigma$ is a singleton if and only if $S\cap\kappa_\Theta$ is.

Dependency-correctness is immediate, as above.

	\item
$\link CD\scoal\link[\sigma\minus x]C{\exists x.D}$
\\
The witness sets $\Sigma(x)$ and $\Theta(x)$ for $L$ and $R$ need not be the same, since $L$ has $\sigma$ where $R$ has $\sigma\minus x$. Let $\Sigma(x)=\{t,t_1,\dots,t_n\}$ and $\Theta(x)=\{t_1,\dots,t_n\}$, where $\sigma(x)=t$. For every slice $S_B$ of $B$ over $\Sigma$ there is a corresponding slice $S'_B$ over $\Theta$, both (or neither) containing $(\exists x.D,\tau)$ and $(D,\tau[t_i/x])$ for $i\leq n$, but the former in addition having $(D,\tau[t/x])$. Then $S\cap \lambda_\Sigma$ is the singleton $\{\link CD\}$ if and only if $S\cap\kappa_\Theta$ is $\{\link[\sigma\minus x]C{\exists x.D}\}$, where it should be observed that if $t$ is also a witness to $x$ in some other slice of $R$, then $t\in\Theta(x)$ and in fact $S=S'$. 
\lutz{?}
\todo{Explain the witness sets better; refer to 1st case above; }

For dependency-correctness, the column of $\link CD$ is that of $\link[\sigma\minus x]C{\exists x.D}$ plus a pair $(D,\tau)$, which is minimal in $(\dep)$.

	\item
$\link CD\scoal\link C{\forall x.D}$
\\
A slice $S$ of $\seq AB$ contains $\link CD$ if and only if it contains also $\link C{\forall x.D}$, and hence $S\cap\lambda_\Sigma$ is a singleton if and only if $S\cap\kappa_\Theta$ is.

For dependency-correctness, the column of $\link CD$ is that of $\link C{\forall x.D}$ plus a pair $(D,\tau)$. The side-condition of the coalescence step is that $x\notin\sigma$; then $x$ does not occur free in any $(X,\rho)$, and $(D,\tau)$ is minimal in $(\dep)$.
\qedhere
\end{itemize}
\end{proof}

% ..................................................

\setcounter{theorem}{\thelemcoalescenceapplies}
\begin{lemma}[Restatement]
To a correct witness pre-net $\net{\lambda_\Sigma}AB$ a coalescence step applies, unless it is fully coalesced already, $\lambda_\Sigma=\{\link[\varnothing]AB\}$.
\end{lemma}

\begin{proof}
Let the \defn{depth} of a link $\link CD$ be a pair of integers $(n,m)$, where $n$ is the distance from $C$ to the root of $A$, and $m$ that from $D$ to $B$. We order link depth in the product order: $(i,j)\leq(n,m)$ if and only if $i\leq n$ and $j\leq m$. We will demonstrate that a link at maximal depth may always be coalesced, unless it is the unique link $\link[\varnothing]AB$ at $(0,0)$. 

To see that a maximally deep link coalesces, first note that a link $\link C{D_i}$ where $D_i$ occurs in $D_0{\+}D_1$ may always coalesce, as may a link $\link CD$ where $D$ occurs in $\exists x.D$. This leaves the following cases:
\begin{itemize}
	\item 
$\link A{D_i}$ with $D_i$ occurring in $D=D_1\*D_2$.
\\ 
Without loss of generality, let $i=1$. A slice $S_1$ of $\seq AB$ containing $\link A{D_1}$ has a counterpart $S_2$ containing $\link A{D_2}$. The depth of $\link A{D_2}$ is the same as that of $\link A{D_1}$. By correctness $S_2\cap \lambda_\Sigma$ is a singleton; by the assumption of maximality it may not contain a deeper link than $\link A{D_2}$; and it may not contain a shallower one since that would be shared with $S_1\cap\lambda_\Sigma$. Then $\net{\lambda_\Sigma}AB$ contains both $\link A{D_1}$ and $\link A{D_2}$, and these contract to $\link AD$.
	
	\item 
$\link AD$ with $D$ in $\forall x.D$. 
\\
The step $\link AD\scoal\link A{\forall x.D}$ applies if $x\notin\sigma$. By way of contradiction, assume $x\in\sigma$. The column of $\link AD$ contains $(D,\sigma_D)$ and $(\forall x.D,\tau)$ where $\tau=\sigma\res{\ex[B]{\forall x.D}}$. By the exact coverage condition, $\sigma=\sigma_A\cup\sigma_D$, and since the existential variables in $D$ and $\forall x.D$ are the same, $\ex[B]D=\ex[B]{\forall x.D}$, so that $\tau=\sigma_D$. (Note that since $\sigma_A=\varnothing$, we get $\sigma=\sigma_D=\tau$, but this is not essential to the argument.) Since $x\in\sigma$ we have $x\in\tau$, and in the column of $\link AD$ we have $(\forall x.D,\tau)\dep(D,\tau)$ since $D$ occurs as $\forall x.D$. But we already have $(D,\tau)\dep(\forall x.D,\tau)$ because $D\sub\forall x.D$, contradicting antisymmetry of $(\dep)$. Then $x\notin\sigma$, and the step $\link AD\scoal\link A{\forall x.D}$ applies.

	\item
$\link{C_i}{D_j}$ in $C=C_1\*C_2$ and $D=D_1\*D_2$.
\\
Without loss of generality, let $i=j=1$. By minimal depth and using similar reasoning to the first case above, the pre-net must contain one of the following three configurations.\\
\begin{tabular}[c]{ll}
	1. & $\link{C_1}{D_1},\link{C_1}{D_2},\link{C_2}{D_1},\link{C_2}{D_2}$
\\	2. & $\link{C_1}{D_1},\link{C_1}{D_2},\link{C_2}{D}$
\\	3. & $\link{C_1}{D_1},\link{C_2}{D_1},\link{C}{D_2}$
\end{tabular}
\hfill
$
\scriptstyle
1:~\vc{
\begin{tikzpicture}[net]
	\formula[y=1]{C*{_1}{{\*}}C*{_2}}
	\formula[y=0]{D*{_1}{{\*}}D*{_2}}
	\Vlink[red]{[-2]1,[-2]1}\Vlink[red]{[2]1,[-2]3}\Vlink[red]{[-2]3,[2]1}\Vlink[red]{[2]3,[2]3}
\end{tikzpicture}}
\qquad
2:~\vc{
\begin{tikzpicture}[net]
	\formula[y=1]{C*{_1}{{\*}}C*{_2}}
	\formula[y=0]{D*{_1}{{\*}}D*{_2}}
	\Vlink[red]{[-2]1,[-2]1}\Vlink[red]{[2]1,[-2]3}\Vlink[red]{3,2}
\end{tikzpicture}}
\qquad
3:~\vc{
\begin{tikzpicture}[net]
	\formula[y=1]{C*{_1}{{\*}}C*{_2}}
	\formula[y=0]{D*{_1}{{\*}}D*{_2}}
	\Vlink[red]{[-2]1,[-2]1}\Vlink[red]{[-2]3,[2]1}\Vlink[red]{2,3}
\end{tikzpicture}}
\quad
$
In the second case, the step $\link{C_1}{D_1},\link{C_1}{D_2}\scoal\link{C_1}D$ applies; in the third case, $\link{C_1}{D_1},\link{C_2}{D_1}\scoal\link C{D_1}$; and in the first case, both.

	\item 
$\link{C_i}D$ in $C=C_1\*C_2$ and $\forall x.D$.
\\
Without loss of generality let $i=1$. If $x\notin\sigma$ the rewrite step $\link{C_1}D\scoal\link{C_1}{\forall x.D}$ applies. Otherwise, let $x\in\sigma$. The slice $S_1$ of $\seq AB$ containing $\link{C_1}D$ has a counterpart $S_2$ containing $\link{C_2}D$, which must include exactly one link of $\lambda_\Sigma$. By the assumption of minimal depth, it cannot have greater depth than $\link{C_2}D$. It cannot be $\link CD$ or any shallower link, since that would be shared with the slice $S_1$ which already contains $\link{C_1}D$. It cannot be $\link{C_2}{\forall x.D}$ or any shallower link $\link[\tau]{C_2}{X}$ (i.e.\ with $\forall x.D\leq X$) because $x\in\sigma$. This would mean either $x\in\tau$ which contradicts the \emph{eigenvariables not free} convention, or $x\in\fv(\sigma(y))$ where $\forall x.D<\exists y.Y\leq X$ which creates a cyclic column, as in the second case above. It follows that $S_2\cap\lambda_\Sigma=\{\link{C_2}{D}\}$, so that the rewrite step $\link{C_1}D,\link{C_2}D\scoal\link CD$ applies.

	\item 
$\link CD$ in $\forall x.C$ and $\forall y.D$.
\\
A rewrite step $\link CD\scoal\link{\forall x.C}D$ or $\link CD\scoal\link C{\forall y.D}$ applies unless $x,y\in\sigma$. But that would generate a cycle in the column of $\link CD$, in one of three ways. If $x\in\sigma_C$ or $y\in\sigma_D$ then, since $\sigma_C=\sigma_{\forall x.C}$ and $\sigma_D=\sigma_{\forall y.D}$, respectively:
\[
	(C,\sigma_C)\dep(\forall x.C,\sigma_C)\dep(C,\sigma_C)
\qquad\quad
	(D,\sigma_D)\dep(\forall y.D,\sigma_D)\dep(D,\sigma_D)~.
\]
Otherwise, if $x\in\sigma_D$ and $y\in\sigma_C$ then
\[
	(C,\sigma_C)\dep(\forall x.C,\sigma_C)\dep(D,\sigma_D)\dep(\forall x.D,\sigma_D)\dep(C,\sigma_C)~.
\qedhere
\]
\end{itemize}
\end{proof}

% --------------------------------------------------

\newpage
\section{Permutations}

% ..................................................

\begin{figure}[h!]
\[
\renewcommand\+{{+}}
\renewcommand\*{{\times}}
\scalebox{0.85}{$
\begin{array}{@{}c@{\qquad}c@{\qquad}c@{\qquad}c@{}}
	\permAB   & \permAE   & \permAP   & \permAX 
\\	\downperm & \downperm & \downperm & \downperm \\
	\permBA   & \permEA   & \permPA   & \permXA
\\ \\[20pt]
 			  & \permEF   & \permEP   & \permEX
\\			  & \downperm & \downperm & \downperm \\
 			  & \permFE   & \permPE   & \permXE
\\ \\[20pt]
 			  &			  & \permPQ   & \permPX
\\			  &			  & \downperm & \downperm \\
 			  &			  & \permQP   & \permXP
\\ \\[20pt]
 			  &			  &			  & \permPX
\\			  &			  &			  & \downperm \\
 			  &			  &			  & \permXP
\end{array}$}
\]
\caption{Cut-free rule permutations}
\label{fig:permutations}
\end{figure}

% ..................................................

\begin{figure}
\[
\renewcommand\+{{+}}
\renewcommand\*{{\times}}
\scalebox{0.85}{$
\begin{array}{c@{\qquad}c}
	\permAC   & \permEC   
\\	\downperm & \downperm \\
	\permCA   & \permCE
\\ \\[20pt]
	\permPC   & \permXC 
\\	\downperm & \downperm \\
	\permCP   & \permCX
\end{array}
\begin{array}{c}
	\permCD \\ \downperm \\ \permDC
\end{array}
$}
\]
\caption{Cut-permutations}
\end{figure}


\end{document}






\begin{lemma}
If a labelled pre-net $\net{\lambda_\Sigma^\Pi}AB$ strict-sequentializes to $\pi$, then $(\net{\lambda_\Sigma^\Pi}AB)\rho$ strict-sequentializes to $\pi\rho$.
\end{lemma}

\begin{proof}
By induction on the sequentialization sequence.
\end{proof}


NORMALIZATION PROBLEM

\begin{lemma}
For $\link ab$ with $\sigma=\mgu(a,\dual b)$ in a proof net $\net{\lambda_\star}AB$ and $\link[\tau]{\dual b}c$ with $\tau=\mgu(b,c)$ in $\net{\kappa_\star}{\dual B}C$ the composition $\sigma_a\tau_c\dcom\fix{\sigma_b\tau\subdual b}$ is $\mgu(a,\dual c)$.
\end{lemma}


%
%\begin{lemma}
%For $\link ab$ in a proof net $\net{\lambda_\star}AB$ and $\link[\tau]{\dual b}c$ in $\net{\kappa_\star}{\dual B}C$ the composition $\sigma_a\tau_c\dcom\fix{\sigma_b\tau\subdual b}=\mgu(a,c)$.
%\end{lemma}
%
%\begin{proof}
%Let $\rho=\mgu(a,c)$ and $\rho'=\sigma_a\tau_c\dcom\fix{\sigma_b\tau\subdual b}$. Define the \defn{basis} $\floor{s,t}$ of the $\mgu$ of $s$ and $t$ to be the substitution map defined by $\floor{x,t}=\floor{t,x} = [t/x]$ and
%\[
%	\floor{P(s_1,\dots,s_n),P(t_1,\dots,t_n)} =
%	\floor{f(s_1,\dots,s_n),f(t_1,\dots,t_n)} =
%	\floor{s_1,t_1}\dots\floor{s_n,t_n}~.
%\]
%Write $\floor\sigma$ for the basis $\floor{a,b}$ of $\sigma$, $\floor\tau$ for that of $\tau$, and $\floor\rho$ for that of $\rho$.
%\end{proof}
%
%\end{document}
%



\begin{figure}
\hrule
\par\bigskip
\[
\begin{array}{ccc}
    \vc{\begin{tikzpicture}[net]
    	\formula[y=2]{P}
    	\formula[y=1]{Q}
    	\Vlink[blue]{1,1}
    \end{tikzpicture}}
&\rightsquigarrow&    
    \vc{\begin{tikzpicture}[net]
    	\formula[y=2]{P}
    	\formula[y=1]{Q}
    	\Vlink[red,label={$~\scriptstyle{\sigma(P,\dual Q)}$}]{1,1}
    \end{tikzpicture}}
\\ \\
    \vc{\begin{tikzpicture}[net]
    	\formula[y=2]{A}
    	\formula[y=1]{B\+C}
    	\Vlink[red,label={$\scriptstyle\sigma~$},l]{1,1}
    \end{tikzpicture}}
&\rightsquigarrow& 
    \vc{\begin{tikzpicture}[net]
    	\formula[y=2]{A}
    	\formula[y=1]{B\+C}
    	\Vlink[red,label={~$\scriptstyle\sigma$}]{1,2}
    \end{tikzpicture}}
\\ \\   
    \vc{\begin{tikzpicture}[net]
    	\formula[y=2]{A}
    	\formula[y=1]{B\*C}
    	\Vlink[red,label={$\scriptstyle\sigma~$},l]{[-1]1,1}
    	\Vlink[red,label={~$\scriptstyle\tau$}]{[1]1,3}
    \end{tikzpicture}}
&\stackrel{\sigma\coh\tau}\rightsquigarrow&   
	\vc{\begin{tikzpicture}[net]
    	\formula[y=2]{A}
    	\formula[y=1]{B\*C}
    	\Vlink[red,label={~$\scriptstyle{\sigma\cup\tau}$}]{1,2}
    \end{tikzpicture}}
    
\\ \\
    \vc{\begin{tikzpicture}[net]
    	\formula[y=2]{A}
    	\formula[y=1]{\exists x.B}
    	\Vlink[red,label={~$\scriptstyle\sigma$}]{1,4}
    \end{tikzpicture}}
&\rightsquigarrow&
    \vc{\begin{tikzpicture}[net]
    	\formula[y=2]{A}
    	\formula[y=1]{\exists x.B}
    	\Vlink[red,label={~$\scriptstyle{\sigma\minus x}$}]{1,1}
    \end{tikzpicture}}
\\ \\
    \vc{\begin{tikzpicture}[net]
    	\formula[y=2]{A}
    	\formula[y=1]{\forall a.B}
    	\Vlink[red,label={~$\scriptstyle\sigma$}]{1,4}
    \end{tikzpicture}}
&\stackrel{a\,\notin\,\fv(A\sigma)}\rightsquigarrow&
    \vc{\begin{tikzpicture}[net]
    	\formula[y=2]{A}
    	\formula[y=1]{\forall a.B}
    	\Vlink[red,label={~$\scriptstyle\sigma$}]{1,1}
    \end{tikzpicture}}
\end{array}
\]
\caption{Coalescence rules}
\label{fig:coalescence}
\end{figure}




\begin{equation}
  	\net{\{\link A{B_i}^\pi\}}A{B_1\+B_2} 
 ~\scoal~
	\net{\{\link A{B_1\+B_2} ^\psi\}}A{B_1\+B_2}
\tag{$\srr+i$}
\end{equation}

\hfill $\text{where}\quad \psi=~
  \vc{\infer  {\seq{A\sigma}{B_1\sigma\,\+\,B_2\sigma}}  {\Prf \pi {A\sigma} {B_i\sigma}}}
$ \hspace*{20pt}

\begin{equation}
	\net{\{\link AB^\pi,\link AC^\phi\}}A{B\*C}
 ~\scoal~ 
	\net{\{\link A{B\*C}^\psi\}}A{B\*C}
\tag{$\srr*$}
\end{equation}

\hfill $\text{where}\quad \psi=~
  \vc{
   \infer  {\seq{A\sigma}{B\sigma\,\*\,C\sigma}}  {
    \Prf \pi {A\sigma} {B\sigma}
    &
    \Prf \phi {A\sigma} {C\sigma}    
  }}$ \hspace*{20pt}

\begin{equation}
	\net{\{\link AB^\pi\}}A{\exists x.B}
 ~\scoal~ 
	\net{\{\link[\sigma\minus x]A{\exists x.B}^\psi\}}A{\exists x.B}
\tag{$\srr?$}
\end{equation}

\hfill $\text{if}\quad\sigma(x)\,\neq\,\bot~,
		\quad
		\text{where}\quad \tau=\sigma\minus x
		\quad
		\text{and}\quad \psi=~
  \vc{
   \infer  {\seq{A\tau}{\exists x.B\tau}}  {
    \Prf \pi {A\sigma} {B\sigma}
  }}
$ \hspace*{20pt}

\begin{equation}
	\net{\{\link AB\}}A{\forall a.B}
 ~\scoal~
	\net{\{\link A{\forall a.B}\}}A{\forall a.B}
\tag{$\srr!$}
\end{equation}

\hfill $\text{if}\quad a\notin\sigma~,
		\quad
		\text{where}\quad \psi=~
  \vc{
   \infer  {\seq{A\sigma}{\forall a.B\sigma}}  {
    \Prf \pi {A\sigma} {B\sigma}
  }}
$ \hspace*{20pt}



\begin{proposition}
If $\net{\lambda_\Sigma}AB$ and $\net{\kappa_\Theta}{\dual B}C$ both coalesce, so does their composition.
\end{proposition}

\begin{proof}
By induction on both coalescence sequences. In the base case, $\lambda_\Sigma=\{\link[\varnothing]AB\}$ and $\kappa_\Theta=\{\link[\varnothing]{\dual B}C\}$, and the composition is $\net{\{\link[\varnothing]AC\}}AC$.

If
\todo{}
\end{proof}
