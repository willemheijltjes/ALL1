\documentclass[UKenglish]{lipics-v2019}

\nolinenumbers

%\usepackage {etex}

\usepackage{amsmath,amssymb,amsthm}
\usepackage{latexsym}
\usepackage{microtype}
\usepackage{proof}
\usepackage{refcount}
\usepackage{stmaryrd}
\usepackage{xargs}

\usepackage{graphicx}

\usepackage{tikz}
\usetikzlibrary{arrows}

\usepackage{willemtools}
\usepackage{proofnet}

\bibliographystyle{plainurl}

% ============================== FOR COMMENTS

\newcommand{\lutz}[1]{{\color{blue}     \noindent[\![\![{\bf Lutz: }#1]\!]\!]}}
\newcommand{\todo}[1]{{\color{red}     \noindent[\![\![{\bf TODO: }#1]\!]\!]}}
\newcommand{\willem}[1]{{\color{green!50!black}     \noindent[\![\![{\bf Willem: }#1]\!]\!]}}

% ============================== MACROS

\makeatletter


% ===== Definitions

\newcommand\defn[1]{\textit{\textbf{#1}}}

% ===== General maths

\newcommand\zeroleft[1]{\makebox[0pt][r]{$#1$}}
\newcommand\zeroright[1]{\makebox[0pt][l]{$#1$}}

\newcommand\floor[1]{\lfloor#1\rfloor}


% ===== Check mark symbols
\usepackage{pifont}
	\newcommand\xmark{{\color{red}\ding{55}}}
	\newcommand\vmark{{\color{green}\ding{51}}}


% ===== Sets

\newcommand\var{\textsc{var}}
\newcommand\varA{\textsc{var}^\forall}
\newcommand\varE{\textsc{var}^\exists}
\newcommand\terms{\textsc{term}}
\newcommand\termsA{\textsc{term}^\forall}
\newcommand\atom{\textsc{atom}}
\newcommand\form{\textsc{form}}
\newcommand\proofs{\textsc{proof}}
\newcommand\all{\textsc{all}}
\newcommand\mall{\textsc{mall}}
\newcommand\mll{\textsc{mll}}

\newcommand\ex[2][{}]{\textsc{ev}_{#1}(#2)}

\newcommand\subs[1]{\textsc{sub}(#1)}
\newcommand\poss[1]{\textsc{pos}(#1)}
\newcommand\dom[1]{\textsc{dom}(#1)}

% ===== Formulas

\newcommand\+{+}
\renewcommand\*{\times}
\newcommand\dual[1]{\overline{#1}}

\newcommand\sub{\leq}
\newcommand\dep{\preccurlyeq}

\newcommand\seq[2]{{\vdash}#1,#2}
\newcommand\fv{\textsc{fv}}

% ===== Proofs

\newcommand\prf[3]{#1\vdash\!#2,#3}

\newcommand\Seq{\vphantom(\seq}
\newcommand\Prf[3]{\deduce{\Seq{#2}{#3}}{\vphantom(#1}}

% ===== Nets

\newcommand\net[3]{#1\triangleright #2,#3}

\newcommand\deseq[4][\sigma]{[#2]_{#1}^{#3,#4}}
\newcommand\Deseq[4][\sigma]{\left[\vcenter{#2}\right]_{#1}^{#3\,,\,#4}}

\newcommand\comp{\mathbin;}

% ===== Witness maps

\newcommand\mgu{\textsc{mgu}}

\newcommand\gen{\leq}
\newcommand\coh{\smallfrown}
\newcommand\join{\vee}
\newcommand\minus{\mathop{\!/\mathchoice{\kern-3pt}{\kern-3pt}{\kern-2.5pt}{\kern-2pt}/\!}}


\newcommand\res[1]{|_{#1}}
\newcommand\fix[2][2pt]{\overrightharpoon[#1]{#2}}
\newcommand\dcom{\mathbin\cdot}

\newcommand\init[2]{\mgu(#1,#2)}

\newcommand\subdual[1]{_{\smash{\,\dual{\!#1}}}}

% ===== Slices


% ===== Coalescence

\newcommand\link[3][\sigma]{(#2,#3)_{#1}}

\newcommand\scoal{\rightarrow} %{\leadsto}
\newcommand\ucoal{\rightsquigarrow}

\newcommand\Qrr{\!\!\scriptstyle\qrr}

\newcommand\qrr[1]{
  \ifx#1+\expandafter\@qrr\else
  \ifx#1*\*\mathrm R\else
  \ifx#1!\forall\mathrm R\else
  \ifx#1?\expandafter\@@qrr\else
  \ifx#11\mathrm{ax}\else
  \ifx#1.\mathrm{cut}\else
  #1\mathrm R
  \fi\fi\fi\fi\fi\fi
}
\newcommand\@qrr[1]{+\mathrm R,#1}
\newcommand\@@qrr[1]{\exists\mathrm R,#1}

\newcommand\srr[1]{
  \ifx#1+\expandafter\@srr\else
  \ifx#1*\*\mathrm S\else
  \ifx#1!\forall\mathrm S\else
  \ifx#1?\exists\mathrm S\else 
  \ifx#11\mathrm{axS}\else
  #1\mathrm S  \fi\fi\fi\fi\fi
}
\newcommand\@srr[1]{+\mathrm S,{#1}}

\newcommand\urr[1]{
  \ifx#1+\expandafter\@urr\else
  \ifx#1*\*\mathrm U\else
  \ifx#1!\forall\mathrm U\else
  \ifx#1?\exists\mathrm U\else 
  \ifx#11\mathrm{axU}\else
  #1\mathrm U
  \fi\fi\fi\fi\fi
}
\newcommand\@urr[1]{+\mathrm U,{#1}}

% ===== Derivations

\newcommand\sdown{\mathrel{\rotatebox[origin=c]{-90}{$\scoal$}\kern1pt}}
\newcommand\udown{\mathrel{\rotatebox[origin=c]{-90}{$\ucoal$}\kern1pt}}

\newcommandx\sdn[4][2=\sigma]{#1\sdown\link[#2]{#3}{#4}}	%{#2\sdown_{#1}{#3}\mathbin,{#4}}
\newcommandx\udn[4][2=\sigma]{#1\udown\link[#2]{#3}{#4}}	%{#2\udown_{#1}{#3}\mathbin,{#4}}

% ===== (De-)Sequentialization

\newcommand\QU{\Leftrightarrow}

% ===== Overset extensible harpoon

\DeclareFontFamily{U}{MnSymbolA}{}
\DeclareFontShape{U}{MnSymbolA}{m}{n}{
    <-6>  MnSymbolA5
   <6-7>  MnSymbolA6
   <7-8>  MnSymbolA7
   <8-9>  MnSymbolA8
   <9-10> MnSymbolA9
  <10-12> MnSymbolA10
  <12->   MnSymbolA12}{}
\DeclareFontShape{U}{MnSymbolA}{b}{n}{
    <-6>  MnSymbolA-Bold5
   <6-7>  MnSymbolA-Bold6
   <7-8>  MnSymbolA-Bold7
   <8-9>  MnSymbolA-Bold8
   <9-10> MnSymbolA-Bold9
  <10-12> MnSymbolA-Bold10
  <12->   MnSymbolA-Bold12}{}
\DeclareSymbolFont{MnSyA}{U}{MnSymbolA}{m}{n}
\SetSymbolFont{MnSyA}{bold}{U}{MnSymbolA}{b}{n}

\DeclareRobustCommand{\overleftharpoon}{\mathpalette{\overarrow@\leftharpoonfill@}}
\DeclareRobustCommand{\overrightharpoon}{\mathpalette{\overarrow@\rightharpoonfill@}}
\def\leftharpoonfill@{\arrowfill@\leftharpoondown\mn@relbar\mn@relbar}
\def\rightharpoonfill@{\arrowfill@\mn@relbar\mn@relbar\rightharpoonup}

\DeclareMathSymbol{\leftharpoondown}{\mathrel}{MnSyA}{'112}
\DeclareMathSymbol{\rightharpoonup}{\mathrel}{MnSyA}{'100}
\DeclareMathSymbol{\mn@relbar}{\mathrel}{MnSyA}{'320}

\renewcommand\overrightharpoon[2][2pt]{
\begin{tikzpicture}[baseline=0]
	\node[inner sep=0pt,outer sep=0pt,anchor=base] (x) at (0,0) {$#2$};
	\draw[-left to] ($(x.north west) + (0pt,#1)$) -- ($(x.north east) + (0pt,#1)$);
\end{tikzpicture}}

% ===== Permutations

\newcommand\downperm{\sim\rule[-8pt]{0pt}{22pt}}

\newcommand\permAB{
 \infer[\Qrr!]{\Seq{\forall x.A}{\forall y.B}}{
  \infer[\Qrr!]{\Seq A{\forall y.B}}{
   \Seq AB
}}}
\newcommand\permBA{
 \infer[\Qrr!]{\Seq{\forall x.A}{\forall y.B}}{
  \infer[\Qrr!]{\Seq{\forall x.A}B}{
   \Seq AB
}}}
\newcommand\permAE{
 \infer[\Qrr!]{\Seq{\forall x.A}{\exists y.B}}{
  \infer[\Qrr?t]{\Seq A{\exists y.B}}{
   \Seq A{B[t/y]}
}}}
\newcommand\permEA{
 \infer[\Qrr?t]{\Seq{\forall x.A}{\exists y.B}}{
  \infer[\Qrr!]{\Seq{\forall x.A}{B[t/y]}}{
   \Seq A{B[t/y]}
}}}
\newcommand\permEF{
 \infer[\Qrr?s]{\Seq{\exists x.A}{\exists y.B}}{
  \infer[\Qrr?t]{\Seq{A[s/x]}{\exists y.B}}{
   \Seq{A[s/x]}{B[t/y]}
}}}
\newcommand\permFE{
 \infer[\Qrr?t]{\Seq{\exists x.A}{\exists y.B}}{
  \infer[\Qrr?s]{\Seq{\exists x.A}B[t/y]}{
   \Seq{A[s/x]}{B[t/y]}
}}}
\newcommand\permAP{
 \infer[\Qrr!]{\Seq{\forall x.A}{B_1\+B_2}}{
  \infer[\Qrr+i]{\Seq A{B_1\+B_2}}{
   \Seq A{B_i}
}}}
\newcommand\permPA{
 \infer[\Qrr+i]{\Seq{\forall x.A}{B_1\+B_2}}{
  \infer[\Qrr!]{\Seq{\forall x.A}{B_i}}{
   \Seq A{B_i}
}}}
\newcommand\permEP{
 \infer[\Qrr?t]{\Seq{\exists x.A}{B_1\+B_2}}{
  \infer[\Qrr+i]{\Seq{A[t/x]}{B_1\+B_2}}{
   \Seq{A[t/x]}{B_i}
}}}
\newcommand\permPE{
 \infer[\Qrr+i]{\Seq{\exists x.A}{B_1\+B_2}}{
  \infer[\Qrr?t]{\Seq{\exists x.A}{B_i}}{
   \Seq{A[t/x]}{B_i}
}}}
\newcommand\permPQ{
 \infer[\Qrr+i]{\Seq{A_1\+A_2}{B_1\+B_2}}{
  \infer[\Qrr+j]{\Seq{A_i}{B_1\+B_2}}{
   \Seq{A_i}{B_j}
}}}
\newcommand\permQP{
 \infer[\Qrr+j]{\Seq{A_1\+A_2}{B_1\+B_2}}{
  \infer[\Qrr+i]{\Seq{A_1\+A_2}{B_j}}{
   \Seq{A_i}{B_j}
}}}
\newcommand\permAX{
 \infer[\Qrr!]{\Seq{\forall x.A}{B\*C}}{
  \infer[\Qrr*]{\Seq A{B\*C}}{
   \Seq AB & \Seq AC
}}}
\newcommand\permXA{
 \infer[\Qrr*]{\Seq{\forall x.A}{B\*C}}{
  \infer[\Qrr!]{\Seq{\forall x.A}B}{
   \Seq AB 
  }& 
  \infer[\Qrr!]{\Seq{\forall x.A}C}{
   \Seq AC
}}}
\newcommand\permEX{
 \infer[\Qrr?t]{\Seq{\exists x.A}{B\*C}}{
  \infer[\Qrr*]{\Seq{A[t/x]}{B\*C}}{
   \Seq{A[t/x]}B & \Seq{A[t/x]}C
}}}
\newcommand\permXE{
 \infer[\Qrr*]{\Seq{\exists x.A}{B\*C}}{
  \infer[\Qrr?t]{\Seq{\exists x.A}B}{
   \Seq{A[t/x]}B 
  }& 
  \infer[\Qrr?t]{\Seq{\exists x.A}C}{
   \Seq{A[t/x]}C
}}}
\newcommand\permPX{
 \infer[\Qrr+i]{\Seq{A_1\+A_2}{B\*C}}{
  \infer[\Qrr*]{\Seq{A_i}{B\*C}}{
   \Seq{A_i}B & \Seq{A_i}C
}}}
\newcommand\permXP{
 \infer[\Qrr*]{\Seq{A_1\+A_2}{B\*C}}{
  \infer[\Qrr+i]{\Seq{A_1\+A_2}B}{
   \Seq{A_i}B 
  }& 
  \infer[\Qrr+i]{\Seq{A_1\+A_2}C}{
   \Seq{A_i}C
}}}
\newcommand\permXY{
 \infer[\Qrr*]{\Seq{A\*B}{C\*D}}{
  \infer[\Qrr*]{\Seq A{C\*D}}{
   \Seq AC & \Seq AD
  }&
  \infer[\Qrr*]{\Seq B{C\*D}}{
   \Seq BC & \Seq BD
}}}
\newcommand\permYX{
 \infer[\Qrr*]{\Seq{A\*B}{C\*D}}{
  \infer[\Qrr*]{\Seq{A\*B}C}{
   \Seq AC & \Seq BC
  }&
  \infer[\Qrr*]{\Seq{A\*B}D}{
   \Seq AD & \Seq BD
}}}

% ===== Cut-permutations

\newcommand\permAC{
 \infer[\Qrr.]{\Seq{\forall x.A}C}{
  \infer[\Qrr!]{\Seq{\forall x.A}B}{
   \Seq AB 
  }& 
  \Seq{\dual B}C
}}
\newcommand\permCA{
 \infer[\Qrr!]{\Seq{\forall x.A}C}{
  \infer[\Qrr.]{\Seq AC}{
   \Seq AB & \Seq{\dual B}C
}}}
\newcommand\permEC{
 \infer[\Qrr.]{\Seq{\exists x.A}C}{
  \infer[\Qrr?t]{\Seq{\exists x.A}B}{
   \Seq{A[t/x]}B 
  }& 
  \Seq{\dual B}C
}}
\newcommand\permCE{
 \infer[\Qrr?t]{\Seq{\exists x.A}C}{
  \infer[\Qrr.]{\Seq{A[t/x]}C}{
   \Seq{A[t/x]}B & \Seq{\dual B}C
}}}
\newcommand\permPC{
 \infer[\Qrr.]{\Seq{{A_1\+A_2}}C}{
  \infer[\Qrr+i]{\Seq{{A_1\+A_2}}B}{
   \Seq {A_i}B 
  }& 
  \Seq{\dual B}C
}}
\newcommand\permCP{
 \infer[\Qrr+i]{\Seq{{A_1\+A_2}}C}{
  \infer[\Qrr.]{\Seq {A_i}C}{
   \Seq {A_i}B & \Seq{\dual B}C
}}}
\newcommand\permXC{
 \infer[\Qrr.]{\Seq{{A_1\*A_2}}C}{
  \infer[\Qrr*]{\Seq{{A_1\*A_2}}B}{
   \Seq {A_1}B & \Seq{A_2}B
  }& 
  \Seq{\dual B}C
}}
\newcommand\permCX{
 \infer[\Qrr*]{\Seq{{A_1\*A_2}}C}{
  \infer[\Qrr.]{\Seq {A_1}C}{
   \Seq {A_1}B & \Seq{\dual B}C
  }&
  \infer[\Qrr.]{\Seq {A_2}C}{
   \Seq {A_2}B & \Seq{\dual B}C
}}}
\newcommand\permCD{
 \infer[\Qrr.]{\Seq AD}{
  \infer[\Qrr.]{\Seq AC}{
   \Seq AB & \Seq{\dual B}C
  }& 
  \Seq{\dual C}D
}}
\newcommand\permDC{
 \infer[\Qrr.]{\Seq{A}D}{
  \Seq A{B}
  &
  \infer[\Qrr.]{\Seq {\dual B}D}{
   \Seq {\dual B}{C} & \Seq {\dual C}D
}}}

\makeatother

% ============================== TITLE & AUTHORS

\title{Proof nets for first-order additive linear logic}
%\titlerunning{Proof nets for ALL1}

\author
 {Willem B.\ Heijltjes}
 {University of Bath, United Kingdom}
 {{http://willem.heijltj.es}} %{w.b.heijltjes@bath.ac.uk}
 {}
 {}
\author
 {Dominic J.D.\ Hughes}
 {Logic Group, UC Berkeley, USA}
 {{http://boole.stanford.edu/\textasciitilde dominic}} %{dominich@theory.stanford.edu}
 {}
 {} 
\author
 {Lutz Stra\ss burger}
 {Inria Saclay \&\ LIX/\'Ecole Polytechnique, Palaiseau, France}
 {{http://www.lix.polytechnique.fr/Labo/Lutz.Strassburger}}
 %{lutz.strassburger@inria.fr}
 {}
 {}

\authorrunning{W.B.\ Heijltjes, D.J.D.\ Hughes, and L.\ Stra\ss burger}

\Copyright{Willem B.\ Heijltjes, Dominic J.D.\ Hughes, and Lutz Stra\ss burger}

%\subjclass{F.4.1: Mathematical logic--Proof theory}
% Theory of computation - Logic - Proof theory
% Theory of computation - Logic - Linear logic
\ccsdesc[500]{Theory of computation~Proof theory}
\ccsdesc[300]{Theory of computation~Linear logic}
\keywords{Linear logic, First-order logic, Proof nets, Herbrand's Theorem}

%\relatedversion{http://hal.inria.fr/hal-01867625/}

\EventEditors{Herman Geuvers}
\EventNoEds{1}
\EventLongTitle{4th International Conference on Formal Structures for Computation and Deduction (FSCD 2019)}
\EventShortTitle{FSCD 2019}
\EventAcronym{FSCD}
\EventYear{2019}
\EventDate{June 24--30, 2019}
\EventLocation{Dortmund, Germany}
\EventLogo{}
\SeriesVolume{131}
\ArticleNo{22}

% ============================== CONTENT


\begin{document}

\maketitle

\begin{abstract}
We present canonical proof nets for first-order additive linear logic, the fragment of linear logic with sum, product, and first-order universal and existential quantification. 
%
We present two versions of our proof nets. One, \emph{witness nets}, retains explicit witnessing information to existential quantification. For the other, \emph{unification nets}, this information is absent but can be reconstructed through unification. Unification nets embody a central contribution of the paper: first-order witness information can be left implicit, and reconstructed as needed. 
%
Witness nets are canonical for first-order additive sequent calculus. Unification nets in addition factor out any inessential choice for existential witnesses. Both notions of proof net are defined through coalescence, an additive counterpart to multiplicative contractibility, and for witness nets an additional geometric correctness criterion is provided. 
% 
Both capture sequent calculus cut-elimination as a one-step global composition operation.
\end{abstract}


% ==================================================

\section{Introduction}

%We investigate the \emph{proof-net problem}, finding a canonical representation of proofs, for additive linear logic (\all) extended with first-order quantification (\all{\textnormal 1}). \all\ is the fragment of linear logic \cite{Girard-1987} that describes sums and products, and their canonical morphisms: projections, injections, and diagonals. It is rich, well-behaved, and compact: an ideal microcosm in which to explore semantic and proof-theoretic ideas. Here, we explore two techniques to account for the witness information that is essential to first-order proof: \emph{explicit substitution} and first-order \emph{unification}. 

Additive linear logic (\all) is the logic of sum, product, and their canonical morphisms: projections, injections, and diagonals. Semantically, the logic represents parallel communication between two parties, with sum and product as respectively the sending and receiving of a binary choice \cite{Joyal-1995, Cockett-Santocanale-2009}. As such it is a core part of \emph{session types} for process calculi \cite{Honda-Vasconcelos-Kubo-1998, Caires-Pfenning-2010, Wadler-2014}.

A microcosm of parallellism, \all\ already demonstrates the \emph{Blass problem} of game semantics \cite{Abramsky-2003}, that sequential strategies do not in general have associative composition. This is resolved by \emph{proof nets} \cite{Girard-1987,Hughes-vanGlabbeek-2005}, which are a canonical, \emph{true-concurrency} presentation of \all.

Here, we extend proof nets to first-order additive linear logic (\all{\textnormal 1}). Beyond the solution to the proof-net problem, a main contribution is the (further) development of the two techniques we consider: \emph{explicit substitutions} for witness assignment, and reconstruction of witness information through \emph{unification}, as pioneered for MLL by the second author \cite{Hughes-2018}. We expect to apply these to first-order logics more generally.

Proofs have been relegated to the appendix---for a full version see the report \cite{Heijltjes-Hughes-Strassburger-2018}.

%Additive linear logic $(\all)$ is the logic of product $(\*)$, sum $(\+)$, and their canonical morphisms: projections, injections, and diagonals. It is naturally captured in \defn{proof nets} \cite{Girard-1987,Hughes-vanGlabbeek-2005}, which describe a morphism $A\to B$ by a sequent $\seq{\dual A}B$ plus a \defn{linking}, a relation between the propositional atoms of $\dual A$ and those of $B$. Four examples are illustrated below left.
%
%Additive proof nets are \defn{canonical}: they factor out the permutations of sequent calculus, and correspond 1--1 to morphisms of the free category. \defn{Composition}, of proof nets over $\seq{\dual A}B$ and $\seq{\dual B}C$ to one over $\seq{\dual A}C$, is by the relational composition of their linkings along the dual formulas $B$ and $\dual B$ (as illustrated below right), and captures sequent-calculus cut-elimination.
%
%\[
%\hspace*{9ex}% spacing hack to achieve central horizontal alignment
% Behold my better spacing hack to achieve central horizontal alignment :)
%\hspace*{-\parindent}%
%\hspace*{\fill}%
%\begin{array}{c@{\qquad\qquad}c}
%	\begin{tikzpicture}[net]
%		\formula[y=1]{{\dual a}}
%		\formula[y=0]{a\*a}
%		\Vlink[red]{[-2]1,1}
%		\Vlink[red]{[2]1,3}
%	\end{tikzpicture}
%&
%	\begin{tikzpicture}[net]
%		\formula[y=1]{{\dual a}}
%		\formula[y=0]{a\+b}
%		\Vlink[red]{1,1}
%	\end{tikzpicture}
%\\
%	\text{\small diagonal}
%&	\text{\small injection}	
%\\ \\ \\[-10pt]
%	\begin{tikzpicture}[net]
%		\formula[y=1]{{\dual a}\+{\dual b}}
%		\formula[y=0]{b\*a}
%		\Vlink[red]{1,3}
%		\Vlink[red]{3,1}
%	\end{tikzpicture}
%&
%	\begin{tikzpicture}[net]
%		\formula[y=1]{*{\phantom(}{\dual a}*{\phantom)}
%		 {{\+}}*({\dual b}*{\phantom)}
%		 {{\+}}*{\phantom(}{\dual c}*)}
%		\formula[y=0]{*(a*{\phantom)}
%		{{\*}}*{\phantom(}b*)
%		{{\*}}*{\phantom(}c*{\phantom)}}
%		\Vlink[red]{1,1}
%		\Vlink[red]{3,3}
%		\Vlink[red]{5,5}
%	\end{tikzpicture}
%\\
%	\text{\small symmetry}
%&	\text{\small associativity}
%\end{array}
%\qquad\qquad\qquad
%\begin{array}{c}
%    \vc{\begin{tikzpicture}[net]
%        \formula[y=2.5]{{\dual b}*\+{\dual a}}
%        \formula[y=1.5]{a*\**(b*\+b*)}
%            \Vlink[red]{1,2}
%            \Vlink[red]{2,1}
%        \formula[y=1]{{\dual a}*\+*({\dual b}*\*{\dual b}*)}
%        \formula[y=0]{b*\*b}
%            \Vlink[blue]{[-1]2,[-1]1}
%            \Vlink[blue]{[1]2,[-1]2}
%            \Vlink[blue]{[-1]3,[1]1}
%            \Vlink[blue]{[1]3,[1]2}
%    \end{tikzpicture}}
%\quad\Rightarrow\quad
%    \vc{\begin{tikzpicture}[net]
%        \formula[y=2.5]{{\dual b}*\+{\dual a}}
%        \formula[y=0]{b*\*b}
%            \Vlink[violet]{[-1]1,1}
%            \Vlink[violet]{[1]1,2}
%    \end{tikzpicture}}
%\\ \\[-5pt]
%	\text{\small composition}
%\end{array}
%\hfill
%\]

\paragraph*{Additive proof nets}
%
\all\ proof nets \cite[Section 4.10]{Hughes-vanGlabbeek-2005} represent a morphism $A\to B$ by a sequent $\seq{\dual A}B$ plus a \defn{linking}, a relation between the propositional atoms of $\dual A$ (the dual of $A$) and those of $B$. They are \defn{canonical}: they factor out the permutations of sequent calculus, and correspond 1--1 to morphisms of the free category with binary sums and products. \defn{Composition}, of proof nets over $\seq{\dual A}B$ and $\seq{\dual B}C$ to one over $\seq{\dual A}C$, is by the relational composition of their linkings along the dual formulas $B$ and $\dual B$ and captures sequent-calculus cut-elimination. Below are examples of proof nets and their composition.
%
\[
\hspace*{-\parindent}%
\hspace*{\fill}%
\begin{array}{@{}rc@{\qquad}rc@{}}
	\text{\small diagonal:}
&	\vc{\begin{tikzpicture}[net]
		\formula[y=1]{{\dual a}}
		\formula[y=0]{a\*a}
		\Vlink[red]{[-2]1,1}
		\Vlink[red]{[2]1,3}
	\end{tikzpicture}}
&	\text{\small injection:}	
&   \vc{\begin{tikzpicture}[net]
		\formula[y=1]{{\dual a}}
		\formula[y=0]{a\+b}
		\Vlink[red]{1,1}
	\end{tikzpicture}}
\\ \\
	\text{\small symmetry:}
&	\vc{\begin{tikzpicture}[net]
		\formula[y=1]{{\dual a}\+{\dual b}}
		\formula[y=0]{b\*a}
		\Vlink[red]{1,3}
		\Vlink[red]{3,1}
	\end{tikzpicture}}
&	\text{\small associativity:}
&	\vc{\begin{tikzpicture}[net]
		\formula[y=1]{*{\phantom(}{\dual a}*{\phantom)}
		 {{\+}}*({\dual b}*{\phantom)}
		 {{\+}}*{\phantom(}{\dual c}*)}
		\formula[y=0]{*(a*{\phantom)}
		{{\*}}*{\phantom(}b*)
		{{\*}}*{\phantom(}c*{\phantom)}}
		\Vlink[red]{1,1}
		\Vlink[red]{3,3}
		\Vlink[red]{5,5}
	\end{tikzpicture}}
\end{array}
\qquad
	\text{\small composition:}
	\quad
    \vc{\begin{tikzpicture}[net]
        \formula[y=2.5]{{\dual b}*\+{\dual a}}
        \formula[y=1.5]{a*\**(b*\+b*)}
            \Vlink[red]{1,2}
            \Vlink[red]{2,1}
        \formula[y=1]{{\dual a}*\+*({\dual b}*\*{\dual b}*)}
        \formula[y=0]{b*\*b}
            \Vlink[blue]{[-1]2,[-1]1}
            \Vlink[blue]{[1]2,[-1]2}
            \Vlink[blue]{[-1]3,[1]1}
            \Vlink[blue]{[1]3,[1]2}
    \end{tikzpicture}}
~~\Rightarrow~~
    \vc{\begin{tikzpicture}[net]
        \formula[y=2.5]{{\dual b}*\+{\dual a}}
        \formula[y=0]{b*\*b}
            \Vlink[violet]{[-1]1,1}
            \Vlink[violet]{[1]1,2}
    \end{tikzpicture}}
\hfill
% Tightening the text and spacing the 
\rule[-55pt]{0pt}{110pt}
\]
%
We extend additive proof nets with first-order quantification. Our central challenge is to incorporate the essential content of first-order proof, the \defn{witness assignment} to existential quantifiers. Commonly, as in the sequent calculus rule below left, a witness to $\exists x.B$ is given by an immediate substitution $B[t/x]$. To assign different witnesses in different branches of a proof, the subformula is duplicated first, giving $B[s/x]$ and $B[t/x]$, as below right.
%
\[
\hspace*{\fill}
\hspace*{-\parindent}
	\vc{\infer[\Qrr?t]{\seq A{\exists x.B}}{\seq A{B[t/x]}}}
\hfill
\vc{
	\infer[\Qrr*]{\Seq{\exists x.\dual P(x)}{P(s)\*P(t)}}{
	 \infer[\Qrr?s]{\Seq{\exists x.\dual P(x)}{P(s)}}{\infer{\Seq{\dual P(s)}{P(s)}}{}}
	 &&
	 \infer[\Qrr?t]{\Seq{\exists x.\dual P(x)}{P(t)}}{\infer{\Seq{\dual P(t)}{P(t)}}{}}
   }}
\hfill
\]
%
This is incompatible with a \defn{sequent\,+\,links} proof net design, where the conclusion sequent remains intact, and a subformula $B$ cannot be the subject of substitution or duplication. Instead, we propose two alternative treatments of witnessing terms, embodied in two notions of proof net: \defn{witness nets} and \defn{unification nets}. Our solutions are based on the second author's recent \defn{unification nets} for first-order multiplicative linear logic \cite{Hughes-2018}. Their main feature is to omit existential witnesses altogether, and reconstruct them by unification.
%

\defn{Witness nets} record witness assignment in substitution maps attached to each link. The example below left shows the proof net for the sequent proof earlier. (We will assume a different variable for each quantifier, and we attach links to predicate letters, as the root connective of an atomic proposition.) Witness nets are canonical for \all{\textnormal 1} sequent calculus permutations. Composition is direct, where the witness assignments of links are composed through a simple process of \emph{interaction\,+\,hiding} similar to that of game semantics \cite{Mimram-2011}.

\defn{Unification nets} omit any witness information, as illustrated below right. In addition to canonicity, they embody a notion of \defn{generality}: where more than one witness could be assigned, unification nets do not require a definite choice, while witness nets do. Composition is direct, by relational composition. We compare further properties in Figure~\ref{fig:results} in the conclusion, where we also discuss related work and Lambek's notion of \defn{generality} \cite{Lambek-1968-1972}.
%\cite{Lambek-1968, Lambek-1969, Lambek-1972}.
%
\[
\hspace*{\fill}
\hspace*{-\parindent}
	\text{\small a witness net:}
	\quad
	\vc{\begin{tikzpicture}[net]
		\formula[y=1.2]{\exists x.{\dual P}(x)}
		\formula[y=0]{P(s)\*P(t)}
		\Vlink[red,l,label={$\scriptstyle[s/x]~~$}]{[-3]4,1}
		\Vlink[red,r,label={$~\scriptstyle[t/x]$}]{[1]4,6}
	\end{tikzpicture}}
\hfill
	\text{\small a unification net:}
	\quad
	\vc{\begin{tikzpicture}[net]
		\formula[y=1.2]{\exists x.{\dual P}(x)}
		\formula[y=0]{P(s)\*P(t)}
		\Vlink[red]{[-3]4,1}
		\Vlink[red]{[1]4,6}
	\end{tikzpicture}}
\hfill
\]
%
\paragraph*{Background}
%
Additive linear logic is combinatorially rich, yet well-behaved and tractable: proof search \cite{Galmiche-Marion-1995} and proof net correctness \cite{Heijltjes-Hughes-2015} for a net over $\seq AB$ are linear in $|A|\times|B|$ (with $|A|$ the size of the syntax tree of $A$). Proof nets remain canonical and equally tractable when extended with the two units \cite{Heijltjes-2011,Heijltjes-Hughes-2015}, and the first-order case is merely NP-complete \cite{Heijltjes-Hughes-2015}.

%At the same time, the ubiquity of its main operations, product and sum, mean the ideas and results it garners are widely applicable. It serves as a microcosmos for important ideas and observations: it fostered the \emph{connections method} of proof search \cite{Galmiche-2000}; it demonstrated the \emph{Blass problem} \cite{Abramsky-2003} of game semantics, that sequential strategies do not in general have associative composition; and it is at the root of the study of fixed points in linear logic \cite{Santocanale-2002a}. The logic describes two-way communication~\cite{Cockett-Santocanale-2009}, and is a core part of \emph{session types}~\cite{Honda-1993}.

{\all} is of course part of {\mall} (multiplicative-additive linear logic), and its lessons are clearly visible in the second author's canonical {\mall} proof nets~\cite{Hughes-vanGlabbeek-2005}, as well as the first and second author's locally canonical \emph{conflict nets}~\cite{Hughes-Heijltjes-2016}. Its proof nets also appear in the third author's study of the \emph{medial rule} for classical logic~\cite{str:RTA07}, and as the \emph{skew fibrations} in the second author's \emph{combinatorial proofs} for classical logic~\cite{Hughes-2006-proofs}. To prepare the ground for cut elimination in first-order \emph{combinatorial proofs} is a further motivation for the present work.

\paragraph*{Proof identity}

At the heart of a theory of proof nets is the question of \emph{proof identity}: when are two proofs equivalent? The answer determines which proofs should map onto the same proof net. The introduction of quantifiers creates an interesting issue: if two proofs differ by an immaterial choice of existential witness, should they be equivalent? For example, to prove the sequent $\seq{\exists x.P(x)}{\exists y.\dual P(y)}$ both quantifiers must receive \emph{the same} witness, as in the following two proofs, but \emph{any} witness will do.
\begin{center}\(
	\vc{\infer={\seq{\exists x.P(x)}{\exists y.\dual P(y)}}{\infer{\seq{P(s)}{\dual P(s)}}{}}}
	\quad
	\stackrel?\equiv
	\quad
	\vc{\infer={\seq{\exists x.P(x)}{\exists y.\dual P(y)}}{\infer{\seq{P(t)}{\dual P(t)}}{}}}
\)\end{center}
The issue is more pronounced where quantifiers are \emph{vacuous}, $\exists x.A$ with $x$ not free in $A$. The proofs below left can only be distinguished even syntactically because the $\exists\mathrm R$ rule makes the instantiating witness explicit. Below right is an interesting intermediate variant: the witness $s$ or $t$ can be observed without explicit annotation in the $\exists\mathrm R$ rule, but the choice is equally immaterial to the content of the proof as when the quantifier were vacuous.
\begin{center}\(
	\vc{\infer[\!\!\scriptstyle{\qrr?s}]{\seq{\exists x.P}{\dual P}}{\infer{\seq P{\dual P}}{}}}
	\quad
	\stackrel?\equiv
	\quad	
	\vc{\infer[\!\!\scriptstyle{\qrr?t}]{\seq{\exists x.P}{\dual P}}{\infer{\seq P{\dual P}}{}}}\qquad
	\vc{
	 \infer[\!\!\scriptstyle{\qrr?s}]{\seq{\exists x.P\+Q(x)}{\dual P}}{
	  \infer[\!\!\scriptstyle{\qrr+1}]{\seq{P\+Q(s)}{\dual P}}{\infer{\seq P{\dual P}}{}}
	}}
	\quad
	\stackrel?\equiv
	\quad	
	\vc{
	 \infer[\!\!\scriptstyle{\qrr?t}]{\seq{\exists x.P\+Q(x)}{\dual P}}{
	  \infer[\!\!\scriptstyle{\qrr+1}]{\seq{P\+Q(t)}{\dual P}}{\infer{\seq P{\dual P}}{}}
	}}
\)\end{center}
In this paper we will not attempt to settle the question of proof identity. Rather, our two notions of proof net each represent a natural and coherent perspective, at either end of the spectrum. \emph{Witness nets} make all existential witnesses explicit, including those to vacuous quantifiers, rejecting all three equivalences above. \emph{Unification nets} leave all witnesses implicit, thus identifying all proofs modulo witness assignment, and validating all three equivalences.

\paragraph*{Correctness: coalescence and slicing}

Additive proof nets have two natural correctness criteria. \defn{Coalescence} \cite{Heijltjes-Hughes-2015,Hughes-Heijltjes-2016}, a counterpart to multiplicative \emph{contractibility} \cite{Danos-1990,Guerrini-Masini-2001}, provides efficient correctness and sequentialization via local rewriting: it asks that the steps below left result in a single link, connecting both formulas. \defn{Slicing} \cite{Hughes-vanGlabbeek-2005} is a global, geometric criterion: it asks that each \defn{slice}, a choice to remove one subformula of each product along with all connected links, retains a single link.
%
\[
\hspace*{-\parindent}
\hspace*{\fill}
\begin{array}{c@{\qquad\qquad\qquad}c}
	\vc{\begin{tikzpicture}[net]
		\formula[y=1]{A}
		\formula[y=0]{B\*C}
		\Vlink[red]{[-2]1,1}
		\Vlink[red]{[2]1,3}
	\end{tikzpicture}}
~\scoal~
	\vc{\begin{tikzpicture}[net]
		\formula[y=1]{A}
		\formula[y=0]{B\*C}
		\Vlink[red]{1,2}
	\end{tikzpicture}}
\qquad\quad
	\vc{\begin{tikzpicture}[net]
		\formula[y=1]{A}
		\formula[y=0]{B\+C}
		\Vlink[red]{1,1}
	\end{tikzpicture}}
~\scoal~
	\vc{\begin{tikzpicture}[net]
		\formula[y=1]{A}
		\formula[y=0]{B\+C}
		\Vlink[red]{1,2}
	\end{tikzpicture}}
&	
	\vc{\begin{tikzpicture}[net]
		\formula[y=1]{A}
		\begin{scope}[black!40]
		\formula[y=0]{B\*C}
		\Vlink[red]{[-1]1,1}
		\Vlink{[1]1,3}
		\end{scope}
		\formula[y=0]{B{\phantom{{}\*{}}}{\phantom C}}
	\end{tikzpicture}}
\qquad
	\vc{\begin{tikzpicture}[net]
		\formula[y=1]{A}
		\begin{scope}[black!40]
		\formula[y=0]{B\*C}
		\Vlink{[-1]1,1}
		\Vlink[red]{[1]1,3}
		\end{scope}
		\formula[y=0]{{\phantom B}{\phantom{{}\*{}}}C}
	\end{tikzpicture}}
\\
	\text{\small coalescence}
&	\text{\small slicing}
\end{array}	
\hfill
\]
We extend coalescence to both witness nets and unification nets, and slicing to witness nets. Here, we illustrate the former, and leave a discussion of slicing to the conclusion of the paper.

We will distinguish \defn{strict coalescence} ($\scoal$) for witness nets and \defn{unifying coalescence} ($\ucoal$) for unification nets. We first give an example of the former (abbreviating $P(x,y)$ to $Pxy$).
%(writing $Pxy$ for $P(x,y)$ to conserve space). 
In the initial witness net, below left, each link corresponds to a sequent calculus axiom between both linked subformulas, with the substitutions applied.
%
\newcommand\xs{xs} %{(\kern-1ptx\kern-1pt,\kern-2pts\kern-1pt)}
\newcommand\xt{xt} %{(\kern-1ptx\kern-1pt,\kern-2ptt\kern-1pt)}
\newcommand\xy{xy} %(\kern-1ptx\kern-1pt,\kern-2pty\kern-1pt)}
\newcommand\zs{zs}
\newcommand\zt{zt}
\[
\hspace*{-\parindent}
\begin{array}{@{}c@{}c@{}c@{}c@{}c@{}}
	\vc{\begin{tikzpicture}[net]
		\formula[y=1]{\forall*{x.}\exists*{y.}{\dual P}*\xy}
		\formula[y=0]{\exists*{z.}P*\zs\*P*\zt}
		\Vlink[red,l,label={$\scriptstyle[x/z,s/y]~~$}]{[-3]3,2}
		\Vlink[blue,r,label={$~~\scriptstyle[x/z,t/y]$}]{[1]3,4}
	\end{tikzpicture}}
& \quad\scoal &
	\vc{\begin{tikzpicture}[net]
		\formula[y=1]{\forall*{x.}\exists*{y.}{\dual P}*\xy}
		\formula[y=0]{\exists*{z.}P*\zs\*P*\zt}
		\Vlink[red,l,label={$\scriptstyle[x/z]~$}]{[-2]2,2}
		\Vlink[blue,r,label={$~~\scriptstyle[x/z,t/y]$}]{[1]3,4}
	\end{tikzpicture}}
& \scoal &
\hfill
	\vc{\begin{tikzpicture}[net]
		\formula[y=1]{\forall*{x.}\exists*{y.}{\dual P}*\xy}
		\formula[y=0]{\exists*{z.}P*\zs\*P*\zt}
		\Vlink[red,l,label={$\scriptstyle[x/z]~$}]{[-2]2,2}
		\Vlink[blue,r,label={$~~\scriptstyle[x/z]$}]{[2]2,4}
	\end{tikzpicture}}
\hfill
\scoal\cdots
\\ \\
\text{\scriptsize
	\color{white}
	 \infer{\vphantom{\dual P}}{
	  \color{red}\infer{\seq{\dual P\xs}{P\xs}}{}
       &&
	  \color{blue}\infer{\seq{\dual P\xt}{P\xt}}{}
	 }}
& \hspace*{26pt} &
\text{\scriptsize
	\color{red}\infer[\!\Qrr?s]{\seq{\exists y.\dual P\xy}{P\xs}}{\color{black}\infer{\seq{\dual P\xs}{P\xs}}{}}
~~
	\color{white}\infer{\vphantom{\dual P}}{\color{blue}\infer{\seq{\dual P\xt}{P\xt}}{}}}
& \hspace*{26pt} &
\text{\scriptsize
	\color{red}\infer[\!\Qrr?s]{\seq{\exists y.\dual P\xy}{P\xs}}{\color{black}\infer{\seq{\dual P\xs}{P\xs}}{}}
~~
	\color{blue}\infer[\!\Qrr?t]{\seq{\exists y.\dual P\xy}{P\xt}}{\color{black}\infer{\seq{\dual P\xt}{P\xt}}{}}}
\end{array}
\]
The first two steps (above middle and right) move both links from the subformula $\dual Pxy$ to $\exists y.\dual Pxy$, removing the substitutions $[s/y]$ and $[t/y]$ on $y$, and corresponding to sequent rules $\qrr?s$ and $\qrr?t$. Observe that we maintain the domain of the substitutions on a link as the variables of those existential quantifiers that either linked subformula is (strictly) in scope of. 

The next step, from above right to below left, combines both links, and corresponds to an additive conjunction rule. We require that both substitutions agree (their domains are the same by the above observation); hence this step could not have been performed before the previous two, corresponding to the non-permutability of the generated inference rules.
\[
\begin{array}{@{}c@{}c@{}c@{}c@{}c@{}}
\cdots\scoal\quad
	\vc{\begin{tikzpicture}[net]
		\formula[y=1]{\forall*{x.}\exists*{y.}{\dual P}*\xy}
		\formula[y=0]{\exists*{z.}P*\zs\*P*\zt}
		\Vlink[violet,r,label={$~~\scriptstyle[x/z]$}]{2,3}
	\end{tikzpicture}}
	\hfill\hfill
& \scoal &
	\vc{\begin{tikzpicture}[net]
		\formula[y=1]{\forall*{x.}\exists*{y.}{\dual P}*\xy}
		\formula[y=0]{\exists*{z.}P*\zs\*P*\zt}
		\Vlink[violet]{2,1}
	\end{tikzpicture}}
& \scoal &
	\vc{\begin{tikzpicture}[net]
		\formula[y=1]{\forall*{x.}\exists*{y.}{\dual P}*\xy}
		\formula[y=0]{\exists*{z.}P*\zs\*P*\zt}
		\Vlink[violet]{1,1}
	\end{tikzpicture}}
\\ \\
\text{\scriptsize
	\color{white}\infer{\dual P}{\infer{\dual P}{
	\color{violet}
	 \infer[\Qrr*]{\seq{\exists y.\dual P\xy}{P\xs\*P\xt}}{
	  \color{black}\infer{\seq{\exists y.\dual P\xy}{P\xs}}{\infer{\seq{\dual P\xs}{P\xs}}{}}
	  &
	  \color{black}\infer{\seq{\exists y.\dual P\xy}{P\xt}}{\infer{\seq{\dual P\xt}{P\xt}}{}}
	 }
	}}}
& \hspace*{28pt} &
\text{\scriptsize
	\color{white}\infer{\dual P}{
	\color{violet}
 	\infer[\Qrr?x]{\seq{\exists y.\dual P\xy}{\exists z.P\zs\*P\zt}}{
	 \color{black}
	 \infer{\seq{\exists y.\dual P\xy}{P\xs\*P\xt}}{
	  \infer{\seq{\exists y.\dual P\xy}{P\xs}}{\infer{\seq{\dual P\xs}{P\xs}}{}}
	  &
	  \infer{\seq{\exists y.\dual P\xy}{P\xt}}{\infer{\seq{\dual P\xt}{P\xt}}{}}
	}}
	}}
& \hspace*{28pt} &
\text{\scriptsize
	\color{violet}
	\infer[\Qrr!]{\seq{\forall x.\exists y.\dual P\xy}{\exists z.P\zs\*P\zt}}{
	 \color{black}
 	 \infer{\seq{\exists y.\dual P\xy}{\exists z.P\zs\*P\zt}}{
	  \infer{\seq{\exists y.\dual P\xy}{P\xs\*P\xt}}{
	   \infer{\seq{\exists y.\dual P\xy}{P\xs}}{\infer{\seq{\dual P\xs}{P\xs}}{}}
	   &
	   \infer{\seq{\exists y.\dual P\xy}{P\xt}}{\infer{\seq{\dual P\xt}{P\xt}}{}}
	}}}}
\end{array}
\]
The final steps introduce an inference $\exists R,x$ and one $\forall R$. For the latter, we require that the \emph{eigenvariable} $x$ of the universal quantification does not occur in the range of the substitution of the link, as in $[x/z]$ in the net above left---hence the two steps could not be interchanged. It corresponds to the \emph{eigenvariable condition} on the $\forall R$ rule that $x$ is not free in the context.

Unifying coalescence, for unification nets, is similar to strict coalescence; two differences allow it to reconstruct witnesses by unification, which we illustrate. To initialize coalescence, the links in the net below left are given, as a substitution map, the \defn{most general unifier} of the two propositions connected by the link. Both links now correspond to sequent axioms.
\[
\hspace*{-\parindent}
\hspace*{\fill}
\begin{array}{@{}ccccc@{}}
    \vc{\begin{tikzpicture}[net]
    	\formula[y=1]{{\dual P}*{xx}}
    	\formula[y=0]{P*{ys}\*P*{tz}}
    	\Vlink[red]{[-2]1,1}
    	\Vlink[blue]{[2]1,3}
    \end{tikzpicture}}
&\ucoal& 
    \vc{\begin{tikzpicture}[net]
    	\formula[y=1]{{\dual P}*{xx}}
    	\formula[y=0]{P*{ys}\*P*{tz}}
    	\Vlink[red,l,label={$\scriptstyle[s/y,s/x]$~~}]{[-2]1,1}
    	\Vlink[blue,r,label={~~$\scriptstyle[t/z,t/x]$}]{[2]1,3}
    \end{tikzpicture}}
&\ucoal& 
    \vc{\begin{tikzpicture}[net]
    	\formula[y=1]{{\dual P}*{xx}}
    	\formula[y=0]{P*{ys}\*P*{tz}}
    	\Vlink[violet,r,label={~~$\scriptstyle[u/z,u/y,u/x]$}]{1,2}
    \end{tikzpicture}}
\\ \\
&\qquad\qquad&
\text{\scriptsize
	\color{white}
	 \infer{\vphantom{\dual P}}{
	  \color{red}\infer{\seq{\dual Pss}{Pss}}{}
       &&
	  \color{blue}\infer{\seq{\dual Ptt}{Ptt}}{}
	 }}
&\qquad\qquad&
\text{\scriptsize
	\color{violet}
	 \infer[\!\Qrr*]{\seq{\dual Puu}{Puu\*Puu}}{
	  \color{black}\infer{\seq{\dual Puu}{Puu}}{}
       &&
	  \color{black}\infer{\seq{\dual Puu}{Puu}}{}
	 }}
\end{array}
\hfill
\]
The second difference is the coalescence step for additive conjunction, above right. Where strict coalescence requires both links to carry identical substitution maps, here we require both maps to be \emph{unifyable}, in the sense that both must have a common, more special (less general) substitution map. This is then applied to the new link. In the example, the terms $s$ and $t$ are unified to $u$, i.e.\ $u$ is a most general term that specializes both $s$ and $t$. Note that in the sequentialization, both subproofs also need to be specialized, from $s$ and $t$ to $u$.

% ==================================================

\section{Proof nets for first-order additive linear logic}

% --------------------------------------------------

First-order terms and the formulas of first-order $\all$ are generated by the following grammars.
%
\setMidspace{5pt}
\[
\begin{array}{@{}l@{}l}
	t &\Coloneqq x \Mid f(t_1,\dots,t_n)
\\[10pt]
	a &\Coloneqq P(t_1,\dots,t_n) \Mid \dual P(t_1,\dots,t_n)
\\[10pt]
	A &\Coloneqq a \Mid A\+A \Mid A\*A \Mid \exists x.A \Mid \forall x.A
\end{array}
\]
%
Negation $(\dual{\,\cdot\,})$ is applied to predicate symbols, $\dual P$ as a matter of convenience. The \defn{dual} $\dual A$ of an arbitrary formula $A$ is given by De Morgan. We use the following notational conventions.
%
\[
\begin{tabular}{@{}lll@{}} 
	$x,y,z$ & $\in \var$		& first-order variables\\
	$f,g,h$ & $\in \Sigma_f$	& $n$-ary $(n\geq 0)$ function symbols from a fixed alphabet $\Sigma_f$\\
	$P,Q,R$ & $\in \Sigma_p$	& $n$-ary $(n\geq 0)$ predicate symbols from a fixed alphabet $\Sigma_p$ \\
	$s,t,u$ & $\in \terms$ 		& first-order terms over $\var$ and $\Sigma_f$ \\
	$a,b,c$ & $\in \atom$		& atomic propositions \\
	$A,B,C$ & $\in \form$		& \all1 formulas \\
\end{tabular}
\]
%
A \defn{sequent} $\seq AB$ is a pair of formulas $A$ and $B$. A sequent calculus for \all1 is given in Figure~\ref{fig:sequent calculus}, where each rule has a symmetric counterpart for the first formula in the sequent. We write $\prf\pi AB$ for a proof $\pi$ with conclusion sequent $\seq AB$. Two proofs are \defn{equivalent} $\pi\sim\pi'$ if one is obtained from the other by rule permutations, given in Figure~\ref{fig:permutations}.

By a \defn{subformula} we will mean a subformula \defn{occurrence}. For instance, a formula $A\*A$ has two subformulas $A$, one on the left and one on the right. The \defn{subformulas} $\subs A$ of a formula are defined as follows; we write $B\sub A$ if $B$ is a subformula of $A$, i.e.\ if $B\in\subs A$.
\[
	\subs A = \{A\} \cup
	\left\{\begin{array}{ll}
		\subs B\uplus\subs C	& \text{if $A=B\+C$ or $A=B\*C$} \\[5pt]
		\subs B					& \text{if $A=\exists x.B$ or $A=\forall x.B$}
	\end{array}\right.
\]

Since we will be working with a graphical representation, we will adopt \defn{Barendregt's convention}, that bound variable names are globally unique identifiers, in the following form. In a sequent $\seq AB$ we assume all quantifiers have a unique binding variable, distinct from any free variable. In a proof $\pi$ over $\seq AB$, a variable $x$ that is universally quantified as $\forall x.C$ in $\seq AB$ is an \defn{eigenvariable}. A $\qrr!$ rule on $\forall x.C$ is considered to bind all free occurrences of the eigenvariable $x$ in its direct subproof. Accordingly, we assume that $x$ does not occur free outside these subproofs (which can be guaranteed by globally renaming $x$). We take variable names to be persistent throughout a proof, in the sense that we don't admit alpha-conversion (renaming of bound variables) between proof rules. We thus have unique bound variable names in $\seq AB$, but in $\pi$ all $\qrr!$ rules on the subformula $\forall x.C$ share the same eigenvariable $x$.


% ..................................................

\begin{figure}[!t]
$
	\infer[\Qrr1]{\vphantom B\seq a{\dual a}}{}
\hspace*{\fill}
	\infer[\Qrr+i]{\seq A{B_1\+B_2}}{\seq A{B_i}}
\hspace*{\fill}
	\infer[\Qrr*]{\seq A{B\*C}}{\seq AB & \seq AC}
\hspace*{\fill}
	\infer[\Qrr?t]{\seq A{\exists x.B}}{\seq A{B[t/x]}}
\hspace*{\fill}
	\infer[\Qrr!~(x\,\notin\,\textsc{fv}(A))]{\seq A{\forall x.B}}{\seq AB}
$
\medskip
\caption{A sequent calculus for $\all1$}
\label{fig:sequent calculus}
\end{figure}

% ..................................................

\begin{figure}[!ht]
\[
\renewcommand\+{{+}}
\renewcommand\*{{\times}}
\scalebox{0.85}{$
\begin{array}{@{}c@{\qquad}c@{\qquad}c@{\qquad}c@{}}
	\permAB   & \permAE   & \permAP   & \permAX 
\\	\downperm & \downperm & \downperm & \downperm \\
	\permBA   & \permEA   & \permPA   & \permXA
\\ \\[20pt]
 			  & \permEF   & \permEP   & \permEX
\\			  & \downperm & \downperm & \downperm \\
 			  & \permFE   & \permPE   & \permXE
\\ \\[20pt]
 			  &			  & \permPQ   & \permPX
\\			  &			  & \downperm & \downperm \\
 			  &			  & \permQP   & \permXP
\\ \\[20pt]
 			  &			  &			  & \permXY
\\			  &			  &			  & \downperm \\
 			  &			  &			  & \permYX
\end{array}$}
\]
\caption{Cut-free rule permutations}
\label{fig:permutations}
\end{figure}

% ..................................................

A \defn{link} $(C,D)$ on a sequent $\seq AB$ is a pair of subformulas $C\leq A$ and $D\leq B$. 
A \defn{linking} $\lambda$ on the sequent $\seq AB$ is a set of links on $\seq AB$.

% ..................................................

\begin{definition}
A \defn{pre-net} $\net\lambda AB$ is a sequent $\seq AB$ with a linking $\lambda$ on it.
\end{definition}

% --------------------------------------------------

\paragraph*{Witness maps}

We will record the witnessing terms to existential quantifiers as (explicit) substitutions at each link. A \defn{witness map} $\sigma\colon\var\rightharpoonup\terms$ is a substitution map which assigns terms to variables, given as a (finite) partial function $\sigma=[t_1/x_1,\dots,t_n/x_n]$. Its \defn{domain} $\dom\sigma$ is $\{x_1,\dots,x_n\}$. We abbreviate by $y\in\sigma$ that a variable $y$ occurs free in the range of~$\sigma$  ($y\in\fv(t_i)$ for some $i\leq n$). The map $\sigma\minus x$ is undefined on $x$ and as $\sigma$ otherwise; $\sigma\res V$ is the restriction of $\sigma$ to a set of variables $V$, and $\varnothing$ is the empty witness map. We write $A\sigma$ for the application of the substitutions in $\sigma$ to the formula $A$, and $\sigma\tau$ is the \defn{composition} of two maps, where $A(\sigma\tau)=(A\sigma)\tau$. We apply $\sigma$ to a proof $\pi$, written $\pi\sigma$, by applying it to each formula in the proof and to each existential witness $t$ recorded with a rule $\qrr?t$.

A \defn{witness linking} $\lambda_\Sigma$ is a linking $\lambda$ with a \defn{witness label\hspace{-.1pt}ling} $\Sigma\colon\lambda\to\var\rightharpoonup\terms$ that assigns each link $(C,D)$ a witness map. We may use and define $\lambda_\Sigma$ as a set of \defn{witness links} $\link CD$ where $(C,D)\in\lambda$ and $\Sigma(C,D)=\sigma$. A witness link $\link ab$ on atomic formulas is an \defn{axiom link} if $\dual a\sigma=b\sigma$. An \defn{axiom} witness linking is one comprising axiom links.

% ..................................................

\begin{definition}
A \defn{witness pre-net} $\net{\lambda_\Sigma}AB$ is a sequent $\seq AB$ with a witness linking $\lambda_\Sigma$.
\end{definition}

% ..................................................

%We will assume that all quantifiers in a sequent $\seq AB$ have a distinct binding variable, and no bound variable shares a name with a free one (\defn{Barendregt's convention}). In a proof $\pi$ or linking $\lambda_\Sigma$ over $\seq AB$, a variable $x$ is an \defn{eigenvariable} if it is universally quantified ($\forall x.X$) in $\seq AB$, an \defn{existential variable} if existentially quantified ($\exists x.X$), and a \defn{global variable} if free in $\seq AB$. A variable $x$ introduced by a witnessing term $t$ in $\pi$ (in a rule $\qrr?t$) or in $\lambda_\Sigma$ (in the range of $\Sigma$) that is not an eigenvariable or global variable is a \defn{term variable}. We will assume the following \defn{freshness} convention: term variables are distinct from existential variables. Observe that both conventions are readily applied to proofs and linkings by renaming (\emph{$\alpha$-converting}) quantified variables in the conclusion.

% ..................................................

\begin{definition}
The \defn{de-sequentialization} $[\pi]$ of a sequent proof $\prf\pi AB$ is the witness pre-net $\net{\deseq[\varnothing]\pi AB}AB$ where the function $\deseq-AB$ is defined inductively as follows (symmetric cases are omitted).
%
\newcommand\XDeseq[4][\sigma]{
 \left[\vc{#2}\right]%
 _{\makebox[0pt][l]{$\scriptstyle{#1}$}}%
 ^{\makebox[0pt][l]{$\scriptstyle{#3\,,\,#4}$}}%
 \rule{35pt}{0pt}
}
\begin{align*}
	\XDeseq{\,\infer[\Qrr1]{\seq a{\dual a}}{\rule{0pt}{3pt}}}bc &\quad=\quad \{\link bc\}
\\ \\[-5pt]
	\XDeseq{\infer[\Qrr+i]{\seq A {B_1\+B_2}}{\Prf \pi A{B_i}}} {A'} {B_1'\+B'_2} 
	& \quad=\quad 
	\Deseq{\Prf\pi A{B_i}} {A'} {B_i'}
\\ \\[-5pt]
	\XDeseq{\infer[\Qrr*]{\seq A{B\*C}}{
	 \Prf\pi AB && \Prf{\pi'}AC 
	}}{A'}{B'\*C'}
	& \quad=\quad 
	  \Deseq{\Prf\pi AB}{A'}{B'}
	  \cup
	  \Deseq{\Prf{\pi'}AC}{A'}{C'}
\\ \\[-5pt]
	\XDeseq{\infer[\Qrr?t]{\seq A{\exists x.B}}{\Prf\pi A{B[t/x]}}}{A'}{\exists x.B'}
	& \quad=\quad 
	 \Deseq[{\sigma[t/x]}]{\Prf\pi A{B[t/x]}} {A'} {B'}
\\ \\[-5pt]
	\XDeseq{\infer[\Qrr!]
	  {\seq A{\forall x.B}}{\Prf\pi AB}} {A'} {\forall x.B'}
	& \quad=\quad 
	  \Deseq{\Prf\pi AB}{A'}{B'}
\end{align*}
%
%\begin{align*}
%	\XDeseq{\,\infer[\Qrr1]{\seq a{\dual a}}{}}bc &\quad=\quad \{\link bc\}
%\\ \\[-5pt]
%	\XDeseq{\infer[\Qrr+i]{\seq A {B_1\+B_2}}{\prf \pi A{B_i}}} {A'} {B_1'\+B'_2} 
%	& \quad=\quad 
%	\deseq{\prf\pi A{B_i}} {A'} {B_i'}
%\\ \\[-5pt]
%	\XDeseq{\infer[\Qrr*]{\seq A{B\*C}}{
%	 \prf\pi AB && \prf{\pi'}AC 
%	}}{A'}{B'\*C'}
%	& \quad=\quad 
%	  \deseq{\prf\pi AB}{A'}{B'}
%	  \cup
%	  \deseq{\prf{\pi'}AC}{A'}{C'}
%\\ \\[-5pt]
%	\XDeseq{\infer[\Qrr?t]{\seq A{\exists x.B}}{\prf\pi A{B[t/x]}}}{A'}{\exists x.B'}
%	& \quad=\quad 
%	 \deseq[{\sigma[t/x]}]{\prf\pi A{B[t/x]}} {A'} {B'}
%\\ \\[-5pt]
%	\XDeseq{\infer[\Qrr!]
%	  {\seq A{\forall x.B}}{\prf\pi AB}} {A'} {\forall x.B'}
%	& \quad=\quad 
%	  \deseq{\prf\pi AB}{A'}{B'}
%\end{align*}
\end{definition}

% ..................................................

A function call $\deseq{\prf\pi AB}{A'}{B'}$ expects that $A=A'\sigma$ and $B=B'\sigma$: the translation separates a sequent $\seq AB$ into subformulas $A'$, $B'$ of the ultimate conclusion of the proof, and the accumulated existential witnesses $\sigma$. For an example, we refer to the introduction.
%
%To conclude this section we will identify three aspects of sequent proofs, arising from the local nature of the rules, that need to be enforced explicitly in proof nets.
%
%\begin{description}
%	\item[Axiom links]
%A sequent proof axiom connects dual atoms, $\seq a{\dual a}$. Correspondingly, a witness link $\link ab$ on atomic formulas $a$ and $b$ is an \defn{axiom link} if $a\sigma=\dual b\sigma$. An \defn{axiom} witness linking is one consisting solely of axiom links.
%	\item[Local eigenvariables]
%The side-condition on the $\forall R$-rule, that the eigenvariable is not free in the context, means that eigenvariables are \emph{local} to the subproof of the $\forall R$-rule. Correspondingly, a link $\link CD$ on $\seq AB$ has \defn{local eigenvariables} if for any variable $x\in\sigma$, if $x$ is an eigenvariable quantified as $\forall x.X$ in $\seq AB$, then $C\leq X$ or $D\leq X$.
%A witness linking or pre-net has \defn{local eigenvariables} if all its links do.
%	\item[Exact coverage]
%The local witness substitution $[t/x]$ in a rule instance $\qrr?t$ will have been applied exactly to the axioms $\seq a{\dual a}$ in the subproof of that rule. Correspondingly, for a link $\link CD$ on $\seq AB$ we expect the domain of $\sigma$ to be exactly the existential variables in $A$ and $B$ in whose scope $C$ and $D$ occur. For a subformula $C$ of $A$, let the \defn{existential variables of $C$ in $A$} be the set $\ex[A]C = \{\,x \mid C < \exists x.X \sub A\,\}$. A link $\link CD$ on $\seq AB$ then has \defn{exact coverage} if $\dom\sigma = \ex[A]C\cup\ex[B]D$. If it does, $\sigma$ consists of two components, $\sigma\res{\ex[A]C}$ and $\sigma\res{\ex[B]D}$, which we abbreviate as $\sigma_C$ and $\sigma_D$ respectively.
%A witness linking or pre-net has \defn{exact coverage} if all its links do.
%\end{description}
%
%\noindent
%Observe that a de-sequentialization $[\pi]$ has all three properties.

%\begin{definition}[Local correctness]
%A witness linking or pre-net has \emph{local eigenvariables/exact coverage} if all its links do.
%It is \defn{locally correct} if it satisfies both.
%\end{definition}


%First, a witness link $\link ab$ on two atomic formulas $a$ and $b$ is an \defn{axiom} link if $a\sigma=\dual b\sigma$. A witness \defn{axiom} linking is one where every link is an axiom link. Observe that the de-sequentialization $[\pi]$ is a witness pre-net with axiom linking $\deseq[\varnothing]\pi AB$.

%Second, in a sequent proof, the side-condition on the $\forall R$-rule, that the eigenvariable is not free in the context, means that eigenvariables are \emph{local} to the subproof of the $\forall R$-rule. We capture this in pre-nets as the \defn{local eigenvariables} condition: for a link $\link CD$ on $\seq AB$, if $x\in\sigma$ is an eigenvariable quantified as $\forall x.X$ in $\seq AB$, then $C\leq X$ or $D\leq X$.
%
%Third, for a link $\link CD$ on $\seq AB$ we expect the domain of $\sigma$ to be exactly the existential variables in $A$ and $B$ in whose scope $C$ and $D$ occur. For a subformula $C$ of $A$, let the \defn{existential variables of $C$ in $A$} be the set $\ex[A]C$:
%\[
%	\ex[A]C = \{\,x \mid C < \exists x.X \sub A\,\}~.
%\]
%
%% ..................................................
%
%\begin{definition}
%A witness pre-net $\net{\lambda_\Sigma}AB$ has \defn{exact coverage} if for every link $\link CD$ in $\lambda_\Sigma$ the domain of $\sigma$ is exactly the existential variables of $C$ and $D$:
%\[
%	\dom\sigma = \ex[A]C\cup\ex[B]D~.
%\]
%\end{definition}
%
% ..................................................
%
%The witness map $\sigma$ of a link $\link CD$ then has two natural, disjoint components, $\sigma\res{\ex[A]C}$ and $\sigma\res{\ex[B]D}$, which we will abbreviate by $\sigma_C$ and $\sigma_D$ respectively.




% --------------------------------------------------

\paragraph*{Correctness and sequentialization by coalescence}

For sequentialization, the links in a pre-net will be labelled with a sequent proof. An axiom link will carry an axiom, and each coalescence step will introduce one proof rule. Formalizing this, a \defn{proof linking} $\lambda_\Sigma^\Pi$ is a witness linking $\lambda_\Sigma$ with a \defn{proof labelling} $\Pi\colon \lambda\to\proofs$ assigning a sequent proof to each link. We will use and define $\lambda_\Sigma^\Pi$ as a set of \defn{proof links} $\link CD^\pi$, where we require that $\prf\pi{C\sigma}{D\sigma}$, i.e.\ that $\pi$ proves the conclusion $\seq{C\sigma}{D\sigma}$. A \defn{labelled pre-net} $\net{\lambda_\Sigma^\Pi}AB$ is a witness pre-net $\net{\lambda_\Sigma}AB$ with a proof labelling $\Pi$ on $\lambda_\Sigma$. If $\lambda_\Sigma$ is an axiom linking, we assign an \defn{initial proof labelling} $\lambda_\Sigma^\star$ as follows.
\[
	\lambda_\Sigma^\star = \{~\link ab^\pi~\mid~\link ab\in\lambda_\Sigma~,~\pi=~\infer{\seq{a\sigma}{b\sigma}}{}~\}
\]
For correctness we may coalesce a pre-net directly, without constructing a proof. 
%
So far we have accumulated the following notational conventions:
%
\[
\begin{tabular}{@{}lcll@{}}
	$\pi,\phi,\psi$		& $\in$ & $\proofs$ & \all1 sequent proofs\\
	$\kappa,\lambda$ 	& $\subset$ & $\form\times\form$ 	& linkings (sets of pairs of formulas)\\
	$\rho,\sigma,\tau$	& $\colon$  & $\var\rightharpoonup\terms$ & witness maps\\
	$\Sigma,\Theta$		& $\colon$  & $\lambda\to\var\rightharpoonup\terms$		& witness labellings on a linking $\lambda$ \\
	$\Pi,\Phi,\Psi$		& $\colon$  & $\lambda\to\proofs$		& proof labellings on a linking $\lambda$
\end{tabular}
\]

% ..................................................

\begin{definition}
%
\renewcommand{\+}{{+}}
\renewcommand{\*}{{\times}}
%
\defn{Strict sequentialization} ($\scoal$) is the rewrite relation on labelled pre-nets generated by the following rules, which replace one or two links by another in a pre-net $\net{\lambda_\Sigma^\Pi}AB$ where $B$ has a subformula $D_1\+D_2$, $D_1\*D_2$, $\exists x.D$, and $\forall x.D$ respectively. Symmetric cases are omitted.
%
\begin{align*}
\tag{$\srr+i$}
	\link C{D_i}^\pi
	& \scoal
	\link C{D_1\+D_2}^\psi
	&& 
 	\psi=~\vc{\infer[\Qrr+i]{\seq{C\sigma}{D_1\sigma\,\+\,D_2\sigma}}  {\Prf \pi {C\sigma} {D_i\sigma}}}
\\ \\[-8pt]
\tag{$\srr*$}
	\left.\begin{array}{@{}l@{\,}}\link C{D_1}^\pi \\ \link C{D_2}^\phi\end{array}\right\}
	& \scoal
	\link C{D_1\*D_2}^\psi
	&&
	\psi=~\vc{\infer[\Qrr*]{\seq{C\sigma}{D_1\sigma\,\*\,D_2\sigma}}  {
      \Prf \pi {C\sigma} {D_1\sigma} & \Prf \phi {C\sigma} {D_2\sigma}    
	}}
\\ \\[-8pt]
\tag{$\srr?$}
	\link CD^\pi
	& \scoal
	\link[\sigma\minus x]C{\exists x.D}^\psi
	\quad{\scriptstyle(x\,\in\,\dom\sigma)}
	&&
	\psi=~\vc{\infer[\Qrr?{\sigma(x)}]{\seq{C(\sigma\minus x)}{\exists x.D(\sigma\minus x)}} {\Prf \pi {C\sigma} {D\sigma} }}	
\\ \\[-8pt]
\tag{$\srr!$}
	\link CD^\pi
	& \scoal
	\link C{\forall x.D}^\psi
	\quad{\scriptstyle\phantom{\minus x}(x\,\notin\,\sigma)}
	&&
	\psi=~\vc{\infer[\Qrr!]{\seq{C\sigma}{\forall x.D\sigma}} {\Prf \pi {C\sigma} {D\sigma}}}
\end{align*}
%
\defn{Strict coalescence} is the same relation on witness pre-nets, ignoring proof labels, illustrated in Figure~\ref{fig:coalescence}. A witness pre-net $\net{\lambda_\Sigma}AB$ \defn{strict-coalesces} if it reduces to $\net{\{\link[\varnothing]AB\}}AB$. It \defn{strongly} strict-coalesces if any coalescence path terminates at $\net{\{\link[\varnothing]AB\}}AB$.
\end{definition}

% ..................................................

For an example of coalescence, see the introduction.

% ..................................................

\begin{definition}
An \all{\textnormal 1} \defn{witness proof net} or \defn{witness net} is a witness pre-net $\net{\lambda_\Sigma}AB$ with $\lambda_\Sigma$ an axiom linking, that strict-coalesces. It \defn{sequentializes} to a proof $\pi$ if its initial labelling $\net{\lambda_\Sigma^\star}AB$ reduces in $(\scoal)$ to $\net{\{\link[\varnothing]AB^\pi\}}AB$.
\end{definition}

% ..................................................

We conclude this section by establishing that sequentialization and de-sequentialization for witness nets are inverses, and that witness nets are canonical.

% ..................................................

\begin{theorem}
\label{thm:proof->net->proof}
For any \all{\textnormal 1} proof $\pi$, the witness net $[\pi]$ sequentializes to $\pi$. 
\end{theorem}

% ..................................................

\begin{theorem}
\label{thm:net->proof->net}
If $\net{\lambda_\Sigma}AB$ sequentializes to $\pi$, then $[\pi]$ is $\net{\lambda_\Sigma}AB$. 
\end{theorem}

% ..................................................

\begin{theorem}
\label{thm:canonical}
Witness nets are canonical: $[\pi]=[\phi]$ if and only if $\pi\sim\phi$.
\end{theorem}

% ..................................................
\begin{figure}[!t]
\[
\begin{array}{ccc@{\hspace{50pt}}ccc}
    \vc{\begin{tikzpicture}[net]
    	\formula[y=2]{C}
    	\formula[y=1]{D*{_1}{{\+}}D*{_2}}
    	\Vlink[red,label={$\scriptstyle\sigma~$},l]{1,1}
    \end{tikzpicture}}
&\scoal& 
    \vc{\begin{tikzpicture}[net]
    	\formula[y=2]{C}
    	\formula[y=1]{D*{_1}{{\+}}D*{_2}}
    	\Vlink[red,label={~$\scriptstyle\sigma$}]{1,2}
    \end{tikzpicture}}
&
    \vc{\begin{tikzpicture}[net]
    	\formula[y=2]{C}
    	\formula[y=1]{\exists x.D}
    	\Vlink[red,label={~$\scriptstyle\sigma$}]{1,4}
    \end{tikzpicture}}
&\stackrel{x\,\in\,\dom\sigma}\scoal&
    \vc{\begin{tikzpicture}[net]
    	\formula[y=2]{C}
    	\formula[y=1]{\exists x.D}
    	\Vlink[red,label={~$\scriptstyle{\sigma\minus x}$}]{1,1}
    \end{tikzpicture}}   
\\ \\   
    \vc{\begin{tikzpicture}[net]
    	\formula[y=2]{C}
    	\formula[y=1]{D*{_1}{{\*}}D*{_2}}
    	\Vlink[red,label={$\scriptstyle\sigma~$},l]{[-1]1,1}
    	\Vlink[red,label={~$\scriptstyle\sigma$}]{[1]1,3}
    \end{tikzpicture}}
&\scoal&
	\vc{\begin{tikzpicture}[net]
    	\formula[y=2]{C}
    	\formula[y=1]{D*{_1}{{\*}}D*{_2}}
    	\Vlink[red,label={~$\scriptstyle\sigma$}]{1,2}
    \end{tikzpicture}}   
&
    \vc{\begin{tikzpicture}[net]
    	\formula[y=2]{C}
    	\formula[y=1]{\forall x.D}
    	\Vlink[red,label={~$\scriptstyle\sigma$}]{1,4}
    \end{tikzpicture}}
&\stackrel{x\,\notin\,\sigma}\scoal&
    \vc{\begin{tikzpicture}[net]
    	\formula[y=2]{C}
    	\formula[y=1]{\forall x.D}
    	\Vlink[red,label={~$\scriptstyle\sigma$}]{1,1}
    \end{tikzpicture}}
\end{array}
\]
\caption{Coalescence rules}
\label{fig:coalescence}
\end{figure}
% ..................................................



% --------------------------------------------------

\section{Geometric correctness}
\label{sec:correctness}

We will first identify two aspects of sequent proofs, arising from the local nature of the rules, which need to be enforced explicitly in a geometric correctness condition.

\begin{description}
	\item[Local eigenvariables.]
The side-condition on the $\forall R$-rule, that the eigenvariable is not free in the context, means that eigenvariables are \emph{local} to the subproof of the $\forall R$-rule. Correspondingly, a link $\link CD$ on $\seq AB$ has \defn{local eigenvariables} if for any variable $x\in\sigma$, if $x$ is an eigenvariable quantified as $\forall x.X$ in $\seq AB$, then $C\leq X$ or $D\leq X$.
A witness linking or pre-net has \defn{local eigenvariables} if all its links do.

	\item[Exact coverage.]
The local witness substitution $[t/x]$ in a rule instance $\qrr?t$ will have been applied exactly to the axioms $\seq a{\dual a}$ in the subproof of that rule. Correspondingly, for a link $\link CD$ on $\seq AB$ we expect the domain of $\sigma$ to be exactly the existential variables in $A$ and $B$ that (could) occur free in $C$ and $D$. For a subformula $C$ of $A$, let the \defn{free existential variables} of $C$ in $A$ be the set $\ex[A]C = \{\,x \mid C < \exists x.X \sub A\,\}$. A link $\link CD$ on $\seq AB$ then has \defn{exact coverage} if $\dom\sigma = \ex[A]C\cup\ex[B]D$. If it does, $\sigma$ consists of two components, $\sigma\res{\ex[A]C}$ and $\sigma\res{\ex[B]D}$, which we abbreviate as $\sigma_C$ and $\sigma_D$ respectively. A witness linking or pre-net has \defn{exact coverage} if all its links do.
\end{description}

\noindent
Both conditions are captured naturally by coalescence, as can be observed from the rules.

% ..................................................

\paragraph*{Slices}

A \defn{slice} is the fraction of a proof that depends on a given choice of one branch (or projection) on each product formula $A\*B$. Important to additive proof theory is that many operations can be performed on a per-slice basis, such as normalization, or proof net correctness. We will here use slices for the latter purpose. As in the propositional case \cite{Hughes-vanGlabbeek-2005}, we define a \defn{slice} of a sequent $\seq AB$ as a set of potential links, of which exactly one must be realized in a proof net $\net{\lambda_\Sigma}AB$. We extend the propositional criterion in two ways:

\begin{description}
	\item[Expansion.]
When defining slices, we interpret an existential quantification $\exists x.A$ as a sum over all witnesses $t_i$ to $x$ that occur in the pre-net, $A[t_1/x]\+\dots\+A[t_n/x]$. This captures the non-permutability of a product rule over distinct instantiations, as below left. (Technically, a slice of $\exists x.A$ will correspond to an infinite sum over $A[t/x]$ for every term $t$, but only the actually occurring terms $t_i$ will ever be relevant.)

	\item[Dependency.]
We define a \defn{dependency} relation between a universal quantification $\forall x.A$ and an instantiation $B[t/y]$ of $\exists y.B$ where the eigenvariable $x$ occurs free in $t$ (a standard approach to first-order quantification \cite{Miller-1987,Girard-1996,Heijltjes-2010,Mimram-2011}). For each link, we will require this dependency relation to be \emph{acyclic}, which amounts to \emph{slice-wise} first-order correctness. It captures the non-permutability of universal and existential sequent rules due to the \emph{eigenvariable condition} of the former, as below right.
\end{description}

\[
\vc{
	\infer[\Qrr*]{\Seq{\exists x.A}{B\*C}}{
	 \infer[\Qrr?s]{\Seq{\exists x.A}B}{\Seq{A[s/x]}B}
	 &
	 \infer[\Qrr?t]{\Seq{\exists x.A}C}{\Seq{A[t/x]}C}
   }}
\qquad\qquad
\vc{
	\infer[\Qrr!]{\Seq{\forall x.A}{\exists y.B}}{
	 \infer[\Qrr?t]{\Seq A{\exists y.B}}{\Seq AB[t/y]}
   }}
   \quad\text{where }x\in\fv(t)
\]

\noindent
\emph{Expansion} covers the interaction between existential quantifiers and products, and \emph{dependency} that between existential and universal quantifiers. Note that in proof nets that include the multiplicatives (e.g.\ \cite{Girard-1996,Hughes-2018}), instead of a dependency as a \emph{partial order} it is common to consider the underlying graph, created by adding a \emph{jump} or \emph{leap} edge when an existential instantiation $B[t/y]$ of $\exists y.B$ contains the eigenvariable $x$ of $\forall x.A$. These edges participate in the \emph{switching} condition \cite{Danos-Regnier-1989}, to capture the interaction between quantifiers and tensors. Without the tensor, here, the dependency as a partial order suffices.

% ..................................................

\begin{definition}[Slice]
A \defn{slice} $S$ of a formula $A$ and a witness map $\sigma$ is a set of pairs $(A',\sigma')$, where $A'\leq A$ and $\sigma'\supseteq\sigma$, given by $S=\{(A,\sigma)\}\cup S'$ where:
%
\begin{itemize}
	\item
\makebox[65pt][l]{If $A = a$}			then $S'=\varnothing$.
	\item
\makebox[65pt][l]{If $A = B\+C$} 		then $S'=S_B\uplus S_C$ with $S_B$ a slice of $B$ and $\sigma$, and $S_C$ one of $C$ and $\sigma$.
	\item
\makebox[65pt][l]{If $A = B\*C$}		then $S'$ is a slice of $B$ and $\sigma$ or a slice of $C$ and $\sigma$.
	\item
\makebox[65pt][l]{If $A = \exists x.B$}	then $S'=\uplus_{t\,\in\,\terms}S_t$ where each $S_t$ is a slice of $B$ and $\sigma[t/x]$.
	\item
\makebox[65pt][l]{If $A = \forall x.B$}	then $S'$ is a slice of $B$ and $\sigma$.
\end{itemize}
%
\noindent
A \defn{slice} of a sequent $\seq AB$ is a set of links
\[
	\{~\link[\sigma\cup\tau]CD~\mid~(C,\sigma)\in S_A~,~(D,\tau)\in S_B~\}
\]
where $S_A$ is a slice of $A$ and $\varnothing$, and $S_B$ a slice of $B$ and $\varnothing$.  A \defn{slice} of a witness pre-net $\net{\lambda_\Sigma} AB$ is the intersection $\lambda_\Sigma\cap S$ of $\lambda_\Sigma$ with a slice $S$ of $\seq AB$.
\end{definition}

% ..................................................

As in the propositional case, for correctness we will require that each slice is a singleton. We will further define a \defn{dependency} condition to ensure that the order in which quantifiers are instantiated is sound, corresponding to the \emph{eigenvariable condition} on the $\qrr!$-rule of sequent calculus. For simplicity, we define the condition on individual links rather than slices.

% ..................................................

\begin{definition}
In a pre-net $\net{\lambda_\Sigma}AB$, let the \defn{column} of a link $\link CD$ be the set of pairs 
\[
	\{~(X,\sigma\res{\ex[A]X})~\mid~C\sub X\sub A~\}\cup\{~(Y,\sigma\res{\ex[B]Y})~\mid~D\sub Y\sub B~\}~,
\]
with a \defn{dependency} relation $(\dep)$: $(X,\rho)\dep(Y,\tau)$ if $X\leq Y$ or $Y$ occurs as $\forall x.Y$ and $x\in\rho$.
\end{definition}

% ..................................................

\begin{definition}
A witness pre-net is \defn{correct} if:
\begin{itemize}
\item it has local eigenvariables and exact coverage,
\item it is \defn{slice-correct}: every slice is a singleton, and
\item it is \defn{dependency-correct}: every column is a partial order (i.e.\ is acyclic/antisymmetric).
\end{itemize}
\end{definition}

% ..................................................

To conclude this section we will establish that both correctness conditions, by coalescence and by slicing, are equivalent. Moreover, both are equivalent to \emph{strong} coalescence.

% ..................................................

\begin{theorem}
\label{thm:correctness}
\label{cor:strong coalescence}
A witness pre-net that strict-coalesces is correct, and a correct witness pre-net strongly strict-coalesces. 
\end{theorem}

% ..................................................

\begin{corollary}
A correct witness pre-net with axiom linking is a witness proof net.
\end{corollary}

% ..................................................

% ..................................................
\begin{figure}[!t]
\[
\begin{array}{ccc}
	\vc{
	\infer[\!\!\scriptstyle{\mathrm{cut}}]{\Seq AC}{
	 \infer[\!\!\scriptstyle{\qrr*}]{\Seq A{B_1\*B_2}\vphantom{\dual B}}{\Prf{\pi_1}A{B_1} & \Prf{\pi_2}A{B_2}}
	 &&
	 \infer[\!\!\scriptstyle{\qrr+i}]{\Seq {\dual B_1\+\dual B_2}C}{\Prf\phi{\dual B_i}C}
	}}
	&\Rightarrow&
	\vc{\infer[\!\!\scriptstyle{\mathrm{cut}}]{\Seq AC}{\Prf{\pi_i}A{B_i} && \Prf\phi{\dual B_i}C}}
\\ \\
	\vc{
	\infer[\!\!\scriptstyle{\mathrm{cut}}]{\Seq AC}{
	 \infer[\!\!\scriptstyle{\qrr?t}]{\Seq A{\exists x.B}}{\Prf\pi A{B[t/x]}}
	 &&
	 \infer[\!\!\scriptstyle{\qrr!}]{\Seq {\forall x.\dual B}C}{\Prf\phi{\dual B}C}
	}}
	&\Rightarrow&
	\vc{\infer[\!\!\scriptstyle{\mathrm{cut}}]{\Seq AC}{\Prf\pi A{B[t/x]} && \Prf{\phi[t/x]}{\dual B[t/x]}C}}
\end{array}
\]
\caption{\all1 cut-elimination steps}
\label{fig:cut-elim}
\end{figure}
% ..................................................


% ..................................................
\begin{figure}[!ht]
\[
\renewcommand\+{{+}}
\renewcommand\*{{\times}}
\scalebox{0.85}{$
\begin{array}{c@{\qquad}c}
	\permAC   & \permEC   
\\	\downperm & \downperm \\
	\permCA   & \permCE
\\ \\[20pt]
	\permPC   & \permXC 
\\	\downperm & \downperm \\
	\permCP   & \permCX
\end{array}
\begin{array}{c}
	\permCD \\ \downperm \\ \permDC
\end{array}
$}
\]
\caption{Cut-permutations}
\label{fig:cut-permutations}
\end{figure}
% ..................................................


% --------------------------------------------------

\section{Composition}

\newlength\seriously
\setlength\seriously\parindent
\parbox[b]{.6\columnwidth}{
We will describe the composition of two witness nets by a global operation. It consists of the relational composition of both linkings, as in the propositional case, where for each pair of links that are being connected, their witness maps are composed. As links correspond to slices, the operation is effectively first-order composition~\cite{Mimram-2011} applied slice-wise.

\setlength\parindent\seriously
\indent
Cut-elimination rules for \all1 are given in Figure~\ref{fig:cut-elim}; the requisite permutations are in Figure~\ref{fig:cut-permutations}.
}
\quad
\begin{tikzpicture}[net]
	\formula[right,y=1.2]{*{\exists v.}{\dual P}}
	\formula[right,y=0]{*{\forall x.\exists y.\forall z.\,}P}
	\Vlink[red,l,label={$\scriptstyle[f(x)/y,z/v]$~~}]{1,1}
	\formula[right,y=-.5]{*{\exists x.\forall y.\exists z.\,}{\dual P}}
	\formula[right,y=-1.7]{P}
	\Vlink[blue,l,label={$\scriptstyle[t/x,g(y)/z]$~~}]{1,1}
	\path(0,-2)--(1,-2);
\end{tikzpicture}
\begin{tikzpicture}[net]
	\formula[right,y=1.2]{*{\exists v.}{\dual P}}
	\formula[right,y=-1.7]{P}
	\Vlink[violet,l,label={$\Rightarrow\quad\scriptstyle[g(f(t))/v]$~~}]{1,1}
	\path(0,-2)--(1,-2);
\end{tikzpicture}

We use the example on the right to illustrate the composition of links. To eliminate the central cut, on $\forall x.\exists y.\forall z.P$ and $\exists x.\forall y.\exists z.\dual P$, the explicit substitutions for both formulas must be effectuated. An inductive procedure, as in sequent calculus, could apply them from outside in: first $[t/x]$, then $[f(t)/y]$ (previously $[f(x)/y]$), then $[g(f(t))/z]$ (previously $[g(y)/z]$). 

For a direct definition, to compose two links $\link ab$ and $\link[\tau]{\dual b}c$, the substitutions into the cut-formula $\sigma_b$ and $\tau\subdual b$ must be applied as often as needed, up to the depth of quantifiers above $b$, to the terms in the range of the remaining substitutions, $\sigma_a$ and $\tau_c$. To formalize this, we will use the following notions:
%
\begin{itemize}
	\item
The \defn{domain-preserving composition} of two witness maps $\sigma\dcom\tau$ is the map $(\sigma\tau)\res{\dom\sigma}$.
	\item
The \defn{least fixed point} $\fix\sigma$ of a witness map $\sigma$ is the least map $\rho$ satisfying $\rho = \rho\sigma$. 
\end{itemize}
%
The latter is the shortest sequence $\fix\sigma=\sigma\sigma\dots\sigma$ such that no variable is both in the domain and range of $\fix\sigma$. This is not necessarily finite; in our composition operations, finiteness is ensured by the correctness conditions on proof nets (see Theorem~\ref{thm:composition}).

% ..................................................
\begin{definition}
The \defn{composition} $\link AB^\pi\comp\link[\tau]{\dual B}C^\phi$ of two proof links is $\link[\rho]AC^\psi$ where
\[
	\rho = \sigma_A\tau_C\dcom\fix{\sigma_B\tau\subdual B}
\qquad\text{and}\qquad
	\psi = ~\vcenter{
	\infer[\!\!\scriptstyle{\mathrm{cut}}]{\seq {A\rho}{C\rho}}{
	 \left(\vcenter{\deduce{\seq{A\sigma}{B\sigma}\vphantom{\dual B}}{\vphantom\phi\pi}}\right)\fix{\sigma_B\tau\subdual B}
	&\left(\vcenter{\deduce{\seq{\dual B\tau}{C\tau}}{\phi}}\right)\fix{\sigma_B\tau\subdual B}
	}}~.
\]
The \defn{composition} $\lambda_\Sigma^\Pi\comp\kappa_\Theta^\Phi$ of two linkings is the linking
\[
	\{~\link XY^\pi\comp\link[\tau]{\dual Y}Z^\phi
		~\mid~
		\link XY^\pi\in{\lambda_\Sigma^\Pi}
		~,~
		\link[\tau]{\dual Y}Z^\phi\in\kappa_\Theta^\Phi~\}
\]
The \defn{composition} $(\net{\lambda_\Sigma^\Pi}AB)\comp(\net{\kappa_\Theta^\Phi}{\dual B}C)$ of two pre-nets is the pre-net $\net{(\lambda_\Sigma^\Pi\comp\kappa_\Theta^\Phi)}AC$.
These compositions may omit proof annotations and witness annotations.
\end{definition}
% ..................................................


The composition of two links is strongly related to composition of strategies in game semantics. There, two strategies on $\seq AB$ and $\seq{\dual B}C$ are composed by \emph{interaction} on the interface of $B$ and $\dual B$, and subsequently \emph{hiding} that interaction. 

In the following we will demonstrate that composition gives the desired result: if a net $L$ sequentializes to $\pi$ and $R$ to $\phi$, then $L\comp R$ sequentializes to a normal form of the composition of $\pi$ and $\phi$ with a cut. To this end we will explore how composition and sequentialization interact. We will consider the critical pairs of sequentialization $(\scoal)$ with composition $(\Rightarrow)$ given in Figures~\ref{fig:crit1}--\ref{fig:crit3}, and demonstrate how they are resolved.

\begin{itemize}
	\item 
$\seq A{B_1{\*}B_2}$ ; $\seq{\dual B_1{\+}\dual B_2}C$\quad (Figure~\ref{fig:crit1})
\\
Since the free existential variables of $B$ and $B_1$ are the same, $\sigma_B\tau\subdual B = \sigma_{B_1}\tau\subdual{B_1}$ and $\rho=\rho'$. It then follows that $\psi'$ cut-eliminates in one step to $\psi$.

	\item
$\seq A{\exists x.B}$ ; $\seq{\forall x.\dual B}C$\quad (Figure~\ref{fig:crit2})
\\	
Since $x$ is not free in the range of $\tau$, nor in the range of $\sigma$ (by Barendregt's convention), we have that $\fix{\sigma_B\tau\subdual B}$ is $\fix[1pt]{(\sigma_B\minus x)\tau\subdual B}$ plus the substitution $[\sigma(x)/x]$. Then $\rho=\rho'$ (as $x$ does not occur in the range of $\sigma_A\tau_C$) and $\psi'$ reduces to $\psi$ in a single cut-elimination step.

	\item
\parbox[t]{0.72\columnwidth}{
$\seq AB$ ; $\seq{\dual B}{\exists x.C}$\quad (Figure~\ref{fig:crit3})
\\
Observe that since $x$ occurs in $C$ but not $B$, it is not in the domain of $\tau_B$, so that $\tau_B\minus x$ is just $\tau_B$. Then $\rho'=\rho\minus x$, and the diagram is closed by a sequentialization step (from left to right) which extends $\psi$ with an existential introduction rule, to a proof equivalent to $\psi'$:
}\hfill
\raisebox{-40pt}{$
	\infer[\!\!\scriptstyle{\qrr?{\rho(x)}}]{\Seq{A\rho'}{\exists x.C\rho'}}{
	 \Prf\psi{A\rho}{C\rho}
	}
$}
\end{itemize}

\noindent
There are three further critical pairs, for a proof net on $\seq AB$ composed with one on $\seq {\dual B}{C_1{\+}C_2}$, one on $\seq {\dual B}{C_1{\*}C_2}$, and one on $\seq {\dual B}{\forall x.C}$. These converge like the one above.
%
Resolving these critical pairs gives the soundness of the composition operation, per the following theorem. We abbreviate a cut on proofs $\prf\pi AB$ and $\prf\phi{\dual B}C$ by $\pi\comp\phi$.

% ..................................................
\begin{theorem}
\label{thm:composition}
If proof nets $\net{\lambda_\Sigma}AB$ and $\net{\kappa_\Theta}{\dual B}C$ sequentialize to $\pi$ and $\phi$ respectively, then their composition $(\net{\lambda_\Sigma}AB)\comp(\net{\kappa_\Theta}{\dual B}C)$ is well-defined (i.e.\ all fixed points are finite) and sequentializes to a normal form $\psi$ of $\pi\comp\phi$.
\end{theorem}
% ..................................................

\newcommand\yA{2.7}
\newcommand\yB{1.65}
\newcommand\yC{1.05}

% ..................................................
\begin{figure}[!tp]
\[
\begin{array}{ccc}
    \vc{
    \begin{tikzpicture}[net]
        \formula[y=\yA]{A}
        \formula[y=\yB]{B*{_1}\*B*{_2}}
        \Vlink[red,label={$\scriptstyle{\pi,\sigma\vphantom)~}$},l]{[-2]1,1}
        \Vlink[red,label={$\scriptstyle{~\pi'\!,\sigma\vphantom)}$},r]{[2]1,3}
        \formula[y=\yC]{{\dual B}*{_1}\+{\dual B}*{_2}}
        \formula[y=0]{C}
        \Vlink[red,label={$\scriptstyle{\phi,\tau\vphantom)~}$},l]{1,1}
    \end{tikzpicture}}
    & 
    \begin{array}{c}\scoal\\[36pt]\scoal\end{array}
    &
    \vc{
    \begin{tikzpicture}[net]
        \formula[y=\yA]{A}
        \formula[y=\yB]{B*{_1}\*B*{_2}}
        \Vlink[red,label={$\scriptstyle{\pi''\!\!,\sigma\vphantom)~}$},l]{1,2}
        \formula[y=\yC]{{\dual B}*{_1}\+{\dual B}*{_2}}
        \formula[y=0]{C}
        \Vlink[red,label={$\scriptstyle{\phi'\!,\tau\vphantom)~}$},l]{2,1}
    \end{tikzpicture}}
\\\\[-7pt] \Downarrow && \Downarrow \\\\[-7pt]
    \vc{
    \begin{tikzpicture}[net]
        \formula[y=\yC]{A}
        \formula[y=0]{C}
        \Vlink[red,label={\makebox[0pt][r]{$\scriptstyle{\psi,\rho\vphantom)~}$}},l]{1,1}
    \end{tikzpicture}}
    &&
    \vc{
    \begin{tikzpicture}[net]
        \formula[y=\yC]{A}
        \formula[y=0]{C}
        \Vlink[red,label={\makebox[0pt][r]{$\scriptstyle{\psi',\rho'\vphantom)~}$}},l]{1,1}
    \end{tikzpicture}}
\end{array}
\qquad
\begin{array}{l@{\,}l}
	\rho  &=~ \sigma_A\tau_C\dcom\fix{\sigma_B\tau\subdual B} 
\\ \\
	\rho' &=~ \sigma_A\tau_C\dcom\fix{\sigma_{B_1}\tau\subdual{B_1}}
\\ \\
	\psi &=~\vc{
	\infer[\!\!\scriptstyle{\mathrm{cut}}]{\seq{A\rho}{C\rho}}{
	 \left(\vc{
	  \deduce{\seq{A\sigma}{B_1\sigma}\vphantom{\dual B_1}}{\pi\vphantom)}
	 }\right)\fix{\sigma_{B_1}\tau\subdual{B_1}}
	 &
	 \left(\vc{
	  \deduce{\seq{\dual B_1\tau}{C\tau}}{\phi\vphantom)}
	 }\right)\makebox[0pt][l]{$\fix{\sigma_{B_1}\tau\subdual{B_1}}$}
	}}
\\ \\ \\
	\psi' &= ~
	\vc{\scalebox{0.75}{$
	\infer[\!\!\scriptstyle{\mathrm{cut}}]{\seq{A\rho'}{C\rho'}}{
	 \left(\vc{\infer{\seq{A\sigma}{B_1\sigma\*B_2\sigma}\vphantom{\dual B}}{
	  \deduce{\seq{A\sigma}{B_1\sigma}\vphantom{\dual B}}{\pi\vphantom)}
	  &
	  \deduce{\seq{A\sigma}{B_2\sigma\vphantom{\dual B}}}{\pi'\vphantom)}
	 }}\right)\fix{\sigma_B\tau\subdual B}
	 &
	 \left(\vc{\infer{\seq{\dual B_1\tau\+\dual B_2\tau}{C\tau}}{
	  \deduce{\seq{\dual B_1\tau}{C\tau}}{\phi\vphantom)}
	 }}\right)\makebox[0pt][l]{$\fix{\sigma_B\tau\subdual B}$}
	}$}\kern5pt}
\end{array}
\]
\caption{The critical pair $\seq A{B_1{\*}B_2}$ ; $\seq{\dual B_1{\+}\dual B_2}C$}
\label{fig:crit1}
\end{figure}
% ..................................................
\begin{figure}[!tp]
\[
\begin{array}{ccc}
    \vc{
    \begin{tikzpicture}[net]
        \formula[y=\yA]{A}
        \formula[y=\yB]{\exists x.B}
        \Vlink[red,label={\makebox[0pt][l]{~$\scriptstyle{\pi,\sigma\vphantom)}$}},r]{1,4}
        \formula[y=\yC]{\forall x.{\dual B}}
        \formula[y=0]{C}
        \Vlink[red,label={\makebox[0pt][l]{~$\scriptstyle{\phi,\tau\vphantom)}$}},r]{4,1}
    \end{tikzpicture}}
    & 
    \begin{array}{c}\scoal\\[36pt]\stackrel{x\,\notin\,\tau\vphantom)}\scoal\end{array}
    &
    \vc{
    \begin{tikzpicture}[net]
        \formula[y=\yA]{A}
        \formula[y=\yB]{\exists x.B}
        \Vlink[red,label={\makebox[0pt][l]{~$\scriptstyle{\pi',\sigma\minus x\vphantom)}$}},r]{1,1}
        \formula[y=\yC]{\forall x.{\dual B}}
        \formula[y=0]{C}
        \Vlink[red,label={\makebox[0pt][l]{~$\scriptstyle{\phi',\tau\vphantom)}$}},r]{1,1}
    \end{tikzpicture}}
\\\\[-7pt] \Downarrow && \Downarrow \\\\[-7pt]
    \vc{ 
    \begin{tikzpicture}[net]
        \formula[y=\yC]{A}
        \formula[y=0]{C}
        \Vlink[red,label={\makebox[0pt][l]{~$\scriptstyle{\psi,\rho\vphantom)}$}},r]{1,1}
    \end{tikzpicture}}
    &&
    \vc{
    \begin{tikzpicture}[net]
        \formula[y=\yC]{A}
        \formula[y=0]{C}
        \Vlink[red,label={\makebox[0pt][l]{~$\scriptstyle{\psi',\rho'\vphantom)}$}},r]{1,1}
    \end{tikzpicture}}
\end{array}
%
\qquad\quad
%
\begin{array}{l@{\,}l}
	\rho  &=~ \sigma_A\tau_C\dcom\fix{\sigma_B\tau\subdual B}
\\ \\
	\rho' &=~ \sigma_A\tau_C\dcom\fix{(\sigma_B\minus x)\tau\subdual B}
\\ \\
	\psi  &=~
	\vc{
	\infer[\!\!\scriptstyle{\mathrm{cut}}]{\seq{A\rho}{C\rho}}{
	 \left(\vc{
	  \deduce{\seq{A\sigma}{B\sigma}\vphantom{\dual B}}{\pi\vphantom)}
	 }\right)\fix{\sigma_B\tau\subdual B}
	 &
	 \left(\vc{
	  \deduce{\seq{\dual B\tau}{C\tau}}{\phi\vphantom)}
	 }\right)\makebox[0pt][l]{$\fix{\sigma_B\tau\subdual B}$}
	}}
\\ \\ \\
	\psi' &=~ 
	\vc{\scalebox{0.8}{$
	\infer[\!\!\scriptstyle{\mathrm{cut}}]{\seq{A\rho'}{C\rho'}}{
	 \left(\vc{\infer{\seq{A\sigma}{\exists x.B\sigma\minus x}\vphantom{\dual B}}{
	  \deduce{\seq{A\sigma}{B\sigma}\vphantom{\dual B}}{\pi\vphantom)}
	 }}\right)\fix{(\sigma_B\minus x)\tau\subdual B}
	 &
	 \left(\vc{\infer{\seq{\forall x.\dual B\tau}{C\tau}}{
	  \deduce{\seq{\dual B\tau}{C\tau}}{\phi\vphantom)}
	 }}\right)\makebox[0pt][l]{$\fix{(\sigma_B\minus x)\tau\subdual B}$}
	}$}}
	\rule{25pt}{0pt}
\end{array}
\]
\caption{The critical pair $\seq A{\exists x.B}$ ; $\seq{\forall x.\dual B}C$}
\label{fig:crit2}
\end{figure}
% ..................................................
\begin{figure}[!tp]
\[
\begin{array}{ccc}
    \vc{
    \begin{tikzpicture}[net]
        \formula[y=\yA]{A}
        \formula[y=\yB]{B}
        \Vlink[red,label={\makebox[0pt][l]{~$\scriptstyle{\pi,\sigma\vphantom)}$}},r]{1,1}
        \formula[y=\yC]{{\dual B}}
        \formula[y=0]{\exists x.C}
        \Vlink[red,label={\makebox[0pt][r]{~$\scriptstyle{\phi,\tau\vphantom)}$~}},l]{1,4}
    \end{tikzpicture}}
    & 
    \begin{array}{c}\\[36pt]\scoal\end{array}
    &
    \vc{
    \begin{tikzpicture}[net]
        \formula[y=\yA]{A}
        \formula[y=\yB]{B}
        \Vlink[red,label={\makebox[0pt][l]{~$\scriptstyle{\pi,\sigma\vphantom)}$}},r]{1,1}
        \formula[y=\yC]{{\dual B}}
        \formula[y=0]{\exists x.C}
        \Vlink[red,label={\makebox[0pt][l]{~$\scriptstyle{\phi',\tau\minus x\vphantom)}$}},r]{1,1}
    \end{tikzpicture}}
\\\\[-7pt] \Downarrow && \Downarrow \\\\[-7pt]
    \vc{ 
    \begin{tikzpicture}[net]
        \formula[y=\yC]{A}
        \formula[y=0]{\exists x.C}
        \Vlink[red,label={\makebox[0pt][r]{~$\scriptstyle{\psi,\rho\vphantom)}$~}},l]{1,4}
    \end{tikzpicture}}
    &&
    \vc{
    \begin{tikzpicture}[net]
        \formula[y=\yC]{A}
        \formula[y=0]{\exists x.C}
        \Vlink[red,label={\makebox[0pt][l]{~$\scriptstyle{\psi',\rho'\vphantom)}$}},r]{1,1}
    \end{tikzpicture}}
\end{array}
%
\qquad\quad
%
\begin{array}{l@{\,}l}
	\rho  &=~ \sigma_A\tau_C\dcom\fix{\sigma_B\tau\subdual B}
\\ \\
	\rho' &=~ \sigma_A(\tau_C\minus x)\dcom\fix{\sigma_B\tau\subdual B}
\\ \\
	\psi &=~
	\vc{
	\infer[\!\!\scriptstyle{\mathrm{cut}}]{\seq{A\rho}{C\rho}}{
	 \left(\vc{
	  \Prf\pi{A\sigma}{B\sigma}
	 }\right)\fix{\sigma_B\tau\subdual B}
	 &
	 \left(\vc{
	  \Prf\phi{\dual B\tau}{C\tau}
	 }\right)\fix{\sigma_B\tau\subdual B}
	}}
\\ \\
	\psi' &=~
	\vc{
	\infer[\!\!\scriptstyle{\mathrm{cut}}]{\seq{A\rho'}{\exists x.C\rho'}}{
	 \left(\vc{
	  \Prf\pi{A\sigma}{B\sigma}
	 }\right)\fix{\sigma_B\tau\subdual B}
	 &
	 \left(\vc{
	  \infer{\Seq{\dual B\tau}{\exists x.C(\tau\minus x)}}{\Prf\phi{\dual B\tau}{C\tau}}
	 }\right)\fix{\sigma_B\tau\subdual B}
	}}
\end{array}
\]
\caption{The critical pair $\seq AB$ ; $\seq{\dual B}{\exists x.C}$}
\label{fig:crit3}
\end{figure}
% ..................................................


% --------------------------------------------------

\section{Unification nets}

In this final section we explore a second notion of \all1 proof net: \defn{unification nets} omit any witness information, which is then reconstructed by coalescence. This yields a natural notion of \emph{most general} proof net, where every other proof net is obtained by introducing more witness information. Conversely, every witness net has an underlying unification net, that sequentializes to a \emph{most general} proof.

We consider a proof $\prf\pi AB$ \defn{more general} than $\prf{\pi'}AB$, written $\pi\leq\pi'$, if there is a substitution map $\rho$ such that $\pi\rho=\pi'$. Unlike for proof nets, this notion is not so natural for sequent proofs: in the permutation of existential and product rules below, from left to right $u$ must be generated as the least term more general than $s$ and $t$; from right to left, $s$ and $t$ cannot be reconstructed from $u$, and must be retrieved from their respective subproofs.
\begin{center}\(
	\vc{
	 \infer[\Qrr*]{\seq{A\*B}{\exists x.C}}{
	  \infer[\Qrr?s]{\seq A{\exists x.C}}{\seq AC}
	  &
	  \infer[\Qrr?t]{\seq B{\exists x.C}}{\seq BC}
	}}
	\quad\sim\quad
	\vc{
	 \infer[\Qrr?u]{\seq{A\*B}{\exists x.C}}{
	  \infer[\Qrr*]{\seq{A\*B}C}{
	   \seq AC
	   &
	   \seq BC
	}}}
\)\end{center}

\noindent
To reconstruct witnesses by unification, we define the following operations.
\\
\makebox[28pt][l]{$\sigma\gen\tau$}:\quad
	A witness map $\sigma$ is \defn{more general} than $\tau$ if there is a map $\rho$ such that $\sigma\rho=\tau$.
\\
\makebox[28pt][l]{$\sigma\coh\tau$}:\quad
	Two witness maps $\sigma$ and $\tau$ are \defn{coherent} if there is a map $\rho$ such that $\sigma\rho=\tau\rho$.
\\
\makebox[28pt][l]{$\sigma\join\tau$}:\quad
	The \defn{join} of coherent witness maps is the least map $\rho$ such that $\sigma\gen\rho$ and $\tau\gen\rho$.

A link $\link[]ab$ on two atomic formulas is an \defn{axiom} link if there exists a witness map $\sigma$ such that $\dual a\sigma=b\sigma$. To an axiom link $\link[]ab$ over $\seq AB$ we assign an \defn{initial witness map}, which is the least witness map $\sigma$ over the domain $\ex[\!A]a\cup\ex[\!B]b$ such that $\dual a\sigma=b\sigma$. In other words, $\sigma$ is the most general unifier of $\dual a$ and $b$, over the given domain, written $\init{\dual a}b$. For an axiom linking $\lambda$ over $\seq AB$ the \defn{initial witness pre-net} $\net{\lambda_\star}AB$ is given by
\begin{center}\(
	\lambda_\star = \{~\link ab~\mid~\link[]ab\in\lambda~,~\sigma=\init{\dual a}b~\}~.
\)\end{center}
An initial witness pre-net has \emph{exact coverage}, while coalescence will give \emph{local eigenvariables}. Note that eigenvariables are constants for the purpose of unification (they are not substituted into). For Barendregt's convention, that free variables have distinct names from bound ones, we should assume that variables in the domain of a witness map are fresh; for example, the most general unifier of existential variables $x$ and $y$ should be $[z/x,z/y]$ for a fresh variable~$z$, and not $[y/x]$ or $[x/y]$.



% ..................................................
\begin{definition}
%
\renewcommand{\+}{{+}}
\renewcommand{\*}{{\times}}
%
\defn{Unifying sequentialization} ($\ucoal$) is the rewrite relation on labelled pre-nets generated by the rules
$(\urr+i)$, $(\urr?)$, $(\urr!)$, which are respectively as $(\srr+i)$, $(\srr?)$, and $(\srr!)$, and the rule
\begin{equation}
\tag{$\urr*$}
	\left.\begin{array}{@{}l@{\,}}\link C{D_1}^\pi \\ \link[\tau]C{D_2}^\phi\end{array}\right\}
	\ucoal
	\link[\sigma\join\tau\,=\,\sigma\rho\,=\,\tau\rho]C{D_1\*D_2}^\psi
	\quad~
	{\scriptstyle(\sigma\coh\tau)}
	\quad~
	\psi=~
  \vc{\scalebox{0.9}{$
   \infer  {\seq{A(\sigma{\join}\tau)}{B\sigma\rho\,\*\,C\tau\rho}}  {
    \left( \vc{\Prf \pi {A\sigma} {B\sigma}} \right)\rho
    &
    \left( \vc{\Prf \phi {A\tau} {C\tau}} \right)\rho   
  }$}}
\end{equation} 
%
\defn{Unifying coalescence} is the relation ($\ucoal$) on witness pre-nets, ignoring proof labels. A witness pre-net $\net{\lambda_\Sigma}AB$ \defn{unifying-coalesces} if it reduces to $\net{\{\link[\varnothing]AB\}}AB$ and \defn{strongly} unifying-coalesces if any coalescence path terminates at $\net{\{\link[\varnothing]AB\}}AB$.
\end{definition}
% ..................................................

% ..................................................
\begin{definition}
An \all{\textnormal 1} \defn{unification proof net} or \defn{unification net} is a pre-net $\net\lambda AB$ with axiom linking $\lambda$ such that the initial witness pre-net $\net{\lambda_\star}AB$ unifying-coalesces. It \defn{sequentializes} to $\pi$ if $\net{\lambda^\star_\star}AB$ reduces in $(\ucoal)$ to $\net{\{\link[\varnothing]AB^\pi\}}AB$.
\end{definition}
% ..................................................

In the above definition, note that $\lambda_\star^\star=(\lambda_\star)^\star$ is the initial proof labelling of $\lambda_\star$, which assigns an axiom rule to each axiom link. For a minimal example, see the Introduction. Observe also that unifying coalescence includes strict coalescence, $(\scoal)\subseteq(\ucoal)$. The following two lemmata relate sequentialization for witness nets and unification nets.

% ..................................................
\begin{lemma}
\label{lem:ucoal generality}
In ($\ucoal$), if $\net{\lambda_\Sigma}AB$ sequentializes to $\pi$ then $\net{\lambda_\star}AB$ sequentializes to $\pi'\leq\pi$.
\end{lemma}
% ..................................................

% ..................................................
\begin{lemma}
\label{lem:unifying implies strict coalescence}
If $\net{\lambda_\star}AB$ unifying-sequentializes to $\pi$ then there exists a witness assignment $\Sigma$ and substitution $\rho$ such that $\net{\lambda_\Sigma}AB$ strict-sequentializes to $\pi$ and $\lambda_\Sigma=\lambda_\star\rho$.
\end{lemma}
% ..................................................

We can then show that sequentialization and de-sequentialization for unification nets are inverses up to generality, and that composition is sound.

% ..................................................
\begin{theorem}
\label{thm:unet deseq-seq}
If $[\prf\pi AB]$ is $\net{\lambda_\Sigma}AB$ then $\net\lambda AB$ unifying-sequentializes to $\pi'\leq \pi$.
\end{theorem}
% ..................................................


% ..................................................
\begin{theorem}
\label{thm:unet seq-deseq}
If $\net\lambda AB$ sequentializes to $\pi$, then $[\pi]=\net{\lambda_\Sigma} AB$ for some $\Sigma$.
\end{theorem}
% ..................................................


% ..................................................
\begin{theorem}
\label{thm:unet composition}
If $\net\lambda AB$ sequentializes to $\pi$ and $\net\kappa{\dual B}C$ to $\phi$ then their composition $\net{\lambda\comp\kappa}AC$ sequentializes to a proof $\psi'\leq\psi$ where $\psi$ is a normal form of $\pi\comp\phi$.
\end{theorem}
% ..................................................

% ..................................................
\begin{figure}[!t]
\begin{center}
\begin{tabular}{lccc}
 &	Monomial nets & Witness nets & Unification nets
\\\hline
   Canonicity          &    ?   & \vmark & \vmark
\\ Generality          & \xmark & \xmark & \vmark
\\ Direct composition  & \xmark & \vmark & \vmark
\\ Coalescence         &    ?   & \vmark & \vmark
\\ Slicing             & \vmark & \vmark &   ?
\end{tabular}  
  \caption{Comparison of different notions of proof nets for quantifiers and additive connectives}
  \label{fig:results}
\end{center}
\vskip-8pt
\end{figure}
% ..................................................

% --------------------------------------------------

\section{Conclusion and related work}

We have presented two notions of first-order additive proof net, \emph{witness nets} and \emph{unification nets}, to capture canonically two natural notions of proof identity for first-order additive linear logic. Figure~\ref{fig:results} summarizes our results, along with some observations we make below. 

Proof nets with additives and quantifiers existed before as \emph{monomial nets} \cite{Girard-1996}. These are not generally canonical: they admit the permutation (and duplication) of proof rules past implicit \emph{contractions} (that is, the shared context of the additive conjunction rule). However, it might be possible to restrict additive monomial nets to some notion of canonical form. Likewise, coalescence (or contractibility) has not been studied for first-order monomial nets, though it has been extended to a related form of MALL proof nets \cite{Maieli-2007}.

Our slicing condition is loosely related to a number of approaches to first-order \emph{classical} logic. A formula $\exists x.A$ is interpreted as the sum (or classically, the \emph{disjunction}) over a fixed number of instantiations $A[t_1/x]\+\dots\+A[t_n/x]$. This can be traced to Herbrand's Theorem \cite{Herbrand-1930}: $\exists x.A$ is equivalent to the infinite sum over $A[t/x]$ for all terms $t$ in the language, but for any given proof a finite set of terms suffices. \emph{Expansion tree proofs} \cite{Miller-1987,Heijltjes-2010} are a graphical proof formalism based on this idea. In our slicing condition, the interpretation of $\exists x.A$ is an infinite sum of which only a finite part $A[t_1/x]\+\dots\+A[t_n/x]$ is relevant, over the witnesses $t_1,\dots,t_n$ actually assigned to $x$ in the proof net. An interesting alternative approach to additive proof nets, which we may explore in future work, is to take the expansion of $\exists x.A$ to $A[t_1/x]\+\dots\+A[t_n/x]$ as primary, and record it explicitly in the syntax, as expansion tree proofs do for classical logic. It is expected, however, that this would sacrifice \emph{generality} and \emph{direct composition}.

Hetzl \cite{Hetzl-2010} explores \emph{explicit substitution} for first-order classical sequent calculus.

Lambek observed that the two canonical proofs of $\seq{A{\+}A}{\dual A}$ can be distinguished by casting each as a specialization (by substituting into propositional variables) of the more general proofs of $\seq{\,a{\+}b}{\dual a}$ and $\seq{\,a{\+}b}{\dual b}$ (corresponding to the two injections of a sum). He proposed to use this idea of \emph{generality} as the basis for a notion of \emph{proof identity}: two proofs are equivalent if their most general forms are isomorphic \cite{Lambek-1968-1972}. How this extends to first order is not obvious. The natural first-order analogue of $\seq{A{\+}A}{\dual A}$ would be $\seq{\exists x.A}{\dual A}$ where the quantifier is vacuous, as $\exists x.A$ represents the infinite sum over $A$ (for all terms $t$). Where Lambek's generality \emph{distinguishes} the two proofs of $\seq{A{\+}A}{\dual A}$, ours \emph{identifies} the proofs of $\seq{\exists x.A}{\dual A}$: the sequent has one unification net, but infinitely many witness nets (one for each term $t$). If existential quantification is indeed analogous to a sum, Lambek's notion of generality is more faithfully captured by witness nets than unification nets.

For future work, there are a few natural questions. First is that of a geometric criterion for unification nets. For this, it seems essential to reconstruct dependencies between products and existential quantifiers globally, as the \emph{expansion} condition provides for witness nets. These interact in highly intricate ways, which the unifying coalescence algorithm resolves incrementally and locally. To do so globally, as would be necessary for a geometric criterion, is a major combinatorial challenge.

A second is whether coalescence (or \emph{contractibility} \cite{Danos-1990}) applies to MLL1 unification nets \cite{Hughes-2018}. We believe it would, straightforwardly (without requiring a dependency or leap edges).

A final question is whether the current approach can be extended to obtain proof nets for MALL1. We see two ways forward that could succeed: (i) combine witness nets with MALL slice nets \cite{Hughes-vanGlabbeek-2005} using a slicing criterion; (ii) combine witness nets or unification nets with MALL conflict nets \cite{Hughes-Heijltjes-2016} using a coalescence criterion. For both, there are still significant combinatorial challenges, for example because coalescence for MALL is not a straightforward extension of that for ALL. Other approaches are much less certain: MALL conflict nets do not yet have a slicing criterion (though this looks feasible), and MALL slice nets do not support coalescence (which seems fundamentally problematic).

% --------------------------------------------------

\section*{Acknowledgements}

We would like to thank the anonymous referees for their constructive feedback. Dominic Hughes would like to thank his host, Wes Holliday, at the UC Berkeley Logic Group. Willem Heijltjes was supported by EPSRC Project EP/R029121/1 \emph{Typed Lambda-Calculi with Sharing and Unsharing}, and Lutz Stra{\ss}burger was supported by the ANR-FWF international
grant ANR-5-CE25-0014 \emph{The Fine Structure of Formal Proof
Systems and their Computational Interpretations (FISP)}.

\bibliography{ALL1}

% ==================================================

\newpage
\appendix

\theoremstyle{plain}
\newtheorem{retheorem}{Theorem}
\newtheorem{relemma}[retheorem]{Lemma}

\section{Proofs}

In this appendix we restate and prove all theorems, and add two supporting lemmata.

% .................................................
\setcounterref{retheorem}{thm:proof->net->proof}
\addtocounter{retheorem}{-1}
\begin{retheorem}
For any \all{\textnormal 1} proof $\pi$, the witness net $[\pi]$ sequentializes to $\pi$. 
\end{retheorem}

\begin{proof}
It follows by induction on $\pi$ that if $\lambda_\Sigma=\deseq{\prf\pi AB}{A'}{B'}$ where $A'\sigma=A$ and $B'\sigma=B$, then $\net{\lambda^\star_\Sigma}AB$ reduces in $(\scoal)$ to $\net{\{\link{A'}{B'}^\pi\}}AB$. The statement is the case $\sigma=\varnothing$.
\end{proof}
% ..................................................

% ..................................................
\setcounterref{retheorem}{thm:net->proof->net}
\addtocounter{retheorem}{-1}
\begin{retheorem}
If $\net{\lambda_\Sigma}AB$ sequentializes to $\pi$, then $[\pi]$ is $\net{\lambda_\Sigma}AB$. 
\end{retheorem}

\begin{proof}
By induction on the sequentialization path 
$\net{\lambda_\Sigma^\star}AB\scoal^*\net{\{\link[\varnothing]AB^\pi\}}AB$
it follows that in every pre-net $\net{\kappa_\Theta^\Phi}AB$ on this path, $\lambda_\Sigma$ is equal to the union over the de-sequentialization of all proof labels $\phi$ in $\Phi$:
\begin{center}\(
	\lambda_\Sigma=\bigcup~\{\,\deseq\phi CD \mid \link CD^\phi \in \kappa_\Theta^\Phi\,\}~.
\)\end{center}
The statement is then the case $\kappa_\Theta^\Phi=\{\link[\varnothing]AB^\pi\}$.
\end{proof}
% ..................................................

% ..................................................
\setcounterref{retheorem}{thm:canonical}
\addtocounter{retheorem}{-1}
\begin{retheorem}
Witness nets are canonical: $[\pi]=[\phi]$ if and only if $\pi\sim\phi$.
\end{retheorem}

\begin{proof}
From left to right is by inspection of the critical pairs of sequentialization ($\scoal$). From right to left is by inspection of the rule permutations in Figure~\ref{fig:permutations}.
\end{proof}
% ..................................................

% ..................................................
\begin{lemma}
\label{lem:correct}
Strict coalescence preserves and reflects correctness.
\end{lemma}

\begin{proof}
For a strict coalescence step $L\scoal R$, we will show that the witness pre-net $L$ is correct if and only if $R$ is. Let $L=\net{\lambda_\Sigma}AB$ and $R=\net{\kappa_\Theta}AB$. In each case, exact coverage and local eigenvariables are immediately preserved and reflected. For slice-correctness, we will demonstrate that the left-hand side and right-hand side of each rule belong to the same slice of $\seq AB$, or in the case of $\srr?$, naturally corresponding slices. For dependency-correctness, we will briefly show how acyclicity of the columns of the involved links is preserved.

\begin{itemize}
	\item
$\link C{D_i}\scoal\link C{D_1{\+}D_2}$
\\
A slice $S_B$ of $B$ and $\varnothing$ containing one of $(D_1,\tau)$, $(D_2,\tau)$, and $(D_1\+D_2,\tau)$ must also contain the other two. A slice $S$ of $\seq AB$ then contains all three of $\link C{D_1}$, $\link C{D_2}$, and $\link C{D_1{\+}D_2}$, or none. It follows that $S\cap \lambda_\Sigma$ is a singleton if and only if $S\cap\kappa_\Theta$ is. Since other slices are unaffected, $L$ is slice-correct if and only if $R$ is.

For dependency-correctness, the column of $\link C{D_i}$ is that of $\link C{D_1{\+}D_2}$ plus the pair $(D_i,\sigma\res{\ex[B]{D_i}})$ itself, which is minimal in the order $\dep$.

	\item
$\link C{D_1},\link C{D_2}\scoal\link C{D_1{\*}D_2}$
\\
A slice $S$ of $\seq AB$ contains $\link C{D_1{\*}D_2}$ if and only if it contains either of $\link C{D_1}$ or $\link C{D_2}$, and cannot contain both. Then $S\cap \lambda_\Sigma$ is a singleton if and only if $S\cap\kappa_\Theta$ is.

Dependency-correctness is immediate, as above.

	\item
$\link CD\scoal\link[\sigma\minus x]C{\exists x.D}$
\\
A slice $S$ of $\seq AB$ contains $\link[\tau] C{\exists x.D}$ if and only if it contains all links $\link[\tau{[t/x]}]CD$ for any term $t$. Letting $\tau[t/x]=\sigma$, then $S\cap \lambda_\Sigma$ is the singleton $\{\link CD\}$ if and only if $S\cap\kappa_\Theta$ is $\{\link[\sigma\minus x]C{\exists x.D}\}$.

For dependency-correctness, the column of $\link CD$ is that of $\link[\sigma\minus x]C{\exists x.D}$ plus a pair $(D,\tau)$, which is minimal in $(\dep)$.

	\item
$\link CD\scoal\link C{\forall x.D}$
\\
A slice $S$ of $\seq AB$ contains $\link CD$ if and only if it contains also $\link C{\forall x.D}$, and hence $S\cap\lambda_\Sigma$ is a singleton if and only if $S\cap\kappa_\Theta$ is.

For dependency-correctness, the column of $\link CD$ is that of $\link C{\forall x.D}$ plus a pair $(D,\tau)$. The side-condition of the coalescence step is that $x\notin\sigma$; then $x$ does not occur free in any $(X,\rho)$, and $(D,\tau)$ is minimal in $(\dep)$.
\qedhere
\end{itemize}
\end{proof}
% ..................................................

% ..................................................
\begin{lemma}
\label{lem:coalescence applies}
To a correct witness pre-net $\net{\lambda_\Sigma}AB$ a coalescence step applies, unless it is fully coalesced already, $\lambda_\Sigma=\{\link[\varnothing]AB\}$.
\end{lemma}

\begin{proof}
Let the \defn{depth} of a link $\link CD$ be a pair of integers $(n,m)$, where $n$ is the distance from $C$ to the root of $A$, and $m$ that from $D$ to $B$. We order link depth in the product order: $(i,j)\leq(n,m)$ if and only if $i\leq n$ and $j\leq m$. We will demonstrate that a link at maximal depth may always be coalesced, unless it is the unique link $\link[\varnothing]AB$ at $(0,0)$. 

To see that a maximally deep link coalesces, first note that a link $\link C{D_i}$ where $D_i$ occurs in $D_0{\+}D_1$ may always coalesce, as may a link $\link CD$ where $D$ occurs in $\exists x.D$. This leaves the following cases:
\begin{itemize}
	\item 
$\link A{D_i}$ with $D_i$ occurring in $D=D_1\*D_2$.
\\ 
Without loss of generality, let $i=1$. A slice $S_1$ of $\seq AB$ containing $\link A{D_1}$ has a counterpart $S_2$ containing $\link A{D_2}$. The depth of $\link A{D_2}$ is the same as that of $\link A{D_1}$. By correctness $S_2\cap \lambda_\Sigma$ is a singleton; by the assumption of maximality it may not contain a deeper link than $\link A{D_2}$; and it may not contain a shallower one since that would be shared with $S_1\cap\lambda_\Sigma$. Then $\net{\lambda_\Sigma}AB$ contains both $\link A{D_1}$ and $\link A{D_2}$, and these contract to $\link AD$.
	
	\item 
$\link AD$ with $D$ in $\forall x.D$. 
\\
The step $\link AD\scoal\link A{\forall x.D}$ applies if $x\notin\sigma$. By way of contradiction, assume $x\in\sigma$. The column of $\link AD$ contains $(D,\sigma_D)$ and $(\forall x.D,\tau)$ where $\tau=\sigma\res{\ex[B]{\forall x.D}}$. By the exact coverage condition, $\sigma=\sigma_A\cup\sigma_D$, and since the free existential variables in $D$ and $\forall x.D$ are the same, $\ex[B]D=\ex[B]{\forall x.D}$, so that $\tau=\sigma_D$. (Note that since $\sigma_A=\varnothing$, we get $\sigma=\sigma_D=\tau$, but this is not essential to the argument.) Since $x\in\sigma$ we have $x\in\tau$, and in the column of $\link AD$ we have $(\forall x.D,\tau)\dep(D,\tau)$ since $D$ occurs as $\forall x.D$. But we already have $(D,\tau)\dep(\forall x.D,\tau)$ because $D\sub\forall x.D$, contradicting antisymmetry of $(\dep)$. Then $x\notin\sigma$, and the step $\link AD\scoal\link A{\forall x.D}$ applies.

	\item
$\link{C_i}{D_j}$ in $C=C_1\*C_2$ and $D=D_1\*D_2$.
\\
Without loss of generality, let $i=j=1$. By minimal depth and using similar reasoning to the first case above, the pre-net must contain one of the following three configurations.\\
\begin{tabular}[c]{ll}
	1. & $\link{C_1}{D_1},\link{C_1}{D_2},\link{C_2}{D_1},\link{C_2}{D_2}$
\\	2. & $\link{C_1}{D_1},\link{C_1}{D_2},\link{C_2}{D}$
\\	3. & $\link{C_1}{D_1},\link{C_2}{D_1},\link{C}{D_2}$
\end{tabular}
\hfill
$
\scriptstyle
1:~\vc{
\begin{tikzpicture}[net]
	\formula[y=1]{C*{_1}{{\*}}C*{_2}}
	\formula[y=0]{D*{_1}{{\*}}D*{_2}}
	\Vlink[red]{[-2]1,[-2]1}\Vlink[red]{[2]1,[-2]3}\Vlink[red]{[-2]3,[2]1}\Vlink[red]{[2]3,[2]3}
\end{tikzpicture}}
\qquad
2:~\vc{
\begin{tikzpicture}[net]
	\formula[y=1]{C*{_1}{{\*}}C*{_2}}
	\formula[y=0]{D*{_1}{{\*}}D*{_2}}
	\Vlink[red]{[-2]1,[-2]1}\Vlink[red]{[2]1,[-2]3}\Vlink[red]{3,2}
\end{tikzpicture}}
\qquad
3:~\vc{
\begin{tikzpicture}[net]
	\formula[y=1]{C*{_1}{{\*}}C*{_2}}
	\formula[y=0]{D*{_1}{{\*}}D*{_2}}
	\Vlink[red]{[-2]1,[-2]1}\Vlink[red]{[-2]3,[2]1}\Vlink[red]{2,3}
\end{tikzpicture}}
\quad
$
In the second case, the step $\link{C_1}{D_1},\link{C_1}{D_2}\scoal\link{C_1}D$ applies; in the third case, $\link{C_1}{D_1},\link{C_2}{D_1}\scoal\link C{D_1}$; and in the first case, both.

	\item 
$\link{C_i}D$ in $C=C_1\*C_2$ and $\forall x.D$.
\\
Without loss of generality let $i=1$. If $x\notin\sigma$ the rewrite step $\link{C_1}D\scoal\link{C_1}{\forall x.D}$ applies. Otherwise, let $x\in\sigma$. The slice $S_1$ of $\seq AB$ containing $\link{C_1}D$ has a counterpart $S_2$ containing $\link{C_2}D$, which must include exactly one link of $\lambda_\Sigma$. By the assumption of minimal depth, it cannot have greater depth than $\link{C_2}D$. It cannot be $\link CD$ or any shallower link, since that would be shared with the slice $S_1$ which already contains $\link{C_1}D$. It cannot be $\link{C_2}{\forall x.D}$ or any shallower link $\link[\tau]{C_2}{X}$ (i.e.\ with $\forall x.D\leq X$) because $x\in\sigma$. This would mean either $x\in\tau$ which contradicts the \emph{eigenvariables not free} convention, or $x\in\fv(\sigma(y))$ where $\forall x.D<\exists y.Y\leq X$ which creates a cyclic column, as in the second case above. It follows that $S_2\cap\lambda_\Sigma=\{\link{C_2}{D}\}$, so that the rewrite step $\link{C_1}D,\link{C_2}D\scoal\link CD$ applies.

	\item 
$\link CD$ in $\forall x.C$ and $\forall y.D$.
\\
A rewrite step $\link CD\scoal\link{\forall x.C}D$ or $\link CD\scoal\link C{\forall y.D}$ applies unless $x,y\in\sigma$. But that would generate a cycle in the column of $\link CD$, in one of three ways. If $x\in\sigma_C$ or $y\in\sigma_D$ then, since $\sigma_C=\sigma_{\forall x.C}$ and $\sigma_D=\sigma_{\forall y.D}$, respectively:
\[
	(C,\sigma_C)\dep(\forall x.C,\sigma_C)\dep(C,\sigma_C)
\qquad\quad
	(D,\sigma_D)\dep(\forall y.D,\sigma_D)\dep(D,\sigma_D)~.
\]
Otherwise, if $x\in\sigma_D$ and $y\in\sigma_C$ then
\[
	(C,\sigma_C)\dep(\forall x.C,\sigma_C)\dep(D,\sigma_D)\dep(\forall x.D,\sigma_D)\dep(C,\sigma_C)~.
\qedhere
\]
\end{itemize}
\end{proof}
% ..................................................

% ..................................................
\setcounterref{retheorem}{thm:correctness}
\addtocounter{retheorem}{-1}
\begin{retheorem}
A witness pre-net that strict-coalesces is correct, and a correct witness pre-net strongly strict-coalesces. 
\end{retheorem}

\begin{proof}
For the first statement, we proceed by induction on the coalescence path from $\net{\lambda_\Sigma}AB$ to $\net{\{\link[\varnothing]AB\}}AB$, with the end result as the base case. It is slice-correct: every slice of $\seq AB$ contains $\link[\varnothing]AB$, so every slice of $\net{\{\link[\varnothing]AB\}}AB$ is the singleton $\{\link[\varnothing]AB\}$. It is also dependency-correct: the column of $\link[\varnothing]AB$ is the set $\{(A,\varnothing),(B,\varnothing)\}$, where $A$ and $B$ are unrelated in $(\dep)$. For the inductive step, by Lemma~\ref{lem:correct} coalescence reflects correctness, so that any pre-net along the coalescence path is correct, in particular $\net{\lambda_\Sigma}AB$.

For the second statement, let $\net{\lambda_\Sigma}AB$ be correct. By Lemma~\ref{lem:coalescence applies} either the net has coalesced, or a coalescence step applies. By Lemma~\ref{lem:correct} the result of any coalescence step is again correct. Since links strictly move towards the roots of both formula trees, it follows that this process terminates, and the pre-net $\net{\lambda_\Sigma}AB$ strongly strict-coalesces.
\end{proof}
% ..................................................

% ..................................................
\setcounterref{retheorem}{thm:composition}
\addtocounter{retheorem}{-1}
\begin{retheorem}
If proof nets $\net{\lambda_\Sigma}AB$ and $\net{\kappa_\Theta}{\dual B}C$ sequentialize to $\pi$ and $\phi$ respectively, then their composition $(\net{\lambda_\Sigma}AB)\comp(\net{\kappa_\Theta}{\dual B}C)$ is well-defined (i.e.\ all fixed points are finite) and sequentializes to a normal form $\psi$ of $\pi\comp\phi$.
\end{retheorem}

\begin{proof}
By Theorem~\ref{cor:strong coalescence} the proof nets $L=\net{\lambda_\Sigma}AB$ and $R=\net{\kappa_\Theta}{\dual B}C$ strongly coalesce. We may then interleave their coalescence sequences as follows: if a synchronized step in $L$ and $R$ on the interface $B$ and $\dual B$ is available, apply it; otherwise perform steps in $L$ on $A$ and in $R$ on $C$ until it is. This gives the following combined sequence.
\[
\begin{array}{c@{~}c@{~}c@{~}l@{~}c@{~}l@{~}c@{~}l@{~}c}
	L &{}={}& L_1 & ~\scoal^?~ & L_2 & ~\scoal^?~ & \dots & ~\scoal^?~ & L_n 
\\
	R &{}={}& R_1 & ~\scoal^?~ & R_2 & ~\scoal^?~ & \dots & ~\scoal^?~ & R_n 
\\[5pt]
	\Downarrow && \Downarrow && \Downarrow &&&& \Downarrow 
\\[5pt]
	L\comp R & = & L_1\comp R_1 & ~\scoal~ & L_2\comp R_2 & ~\scoal~ & \dots & ~\scoal~ & L_n\comp R_n
\end{array}
\]
(Here, $(\scoal^?)$ is the relation $(\scoal)\cup(=)$, but we assume that at least $L_i\scoal L_{i+1}$ or $R_i\scoal R_{i+1}$.)
%
The path along the top and right of this diagram sequentializes $L$ to $\pi'$ and $R$ to $\phi'$ (equivalent to $\pi$ and $\phi$ respectively), and then composes to $L_n\comp R_n = \net{\{\link[\varnothing]AC^{\pi'\comp\phi'}\}}AC$.

Each square of the diagram converges as one of the critical pairs of sequentialization and composition discussed above. Then each path along the diagram from top left ($L$ and $R$) to bottom right $(L_n\comp R_n)$ gives a sequentialization, with cuts, of $L_n\comp R_n$. Let the path taking the vertical step from $L_i$ and $R_i$ to $L_i\comp R_i$ sequentialize to $\psi_i$, so that $\psi_n=\psi'$. By the way each square converges, we have that $\psi_i$ is reached from $\psi_{i+1}$ by a cut-elimination or permutation step. 

Finally, in $L$ and $R$ every link is an axiom link. Any link in $L\comp R$ is composed from two links $\link ab$ in $L$ and $\link[\tau]{\dual b}c$ in $R$, which yields $\link[\rho]ac$ where $\rho = \sigma_a\tau_c\dcom\fix{\sigma_b\tau\subdual b}$. This sequentializes to the axiom $\infer{\seq{a\rho}{c\rho}}{}$, which is in normal form. Then $L\comp R$ is a proof net (it has an axiom linking and it coalesces), and it sequentializes to a normal form of $\psi$.
\end{proof}
% ..................................................

% ..................................................
\setcounterref{retheorem}{lem:ucoal generality}
\addtocounter{retheorem}{-1}
\begin{relemma}
In ($\ucoal$), if $\net{\lambda_\Sigma}AB$ sequentializes to $\pi$ then $\net{\lambda_\star}AB$ sequentializes to $\pi'\leq\pi$.
\end{relemma}

\begin{proof}
The sequentialization path
$
	\net{\lambda_\Sigma^\star}AB = 
	L_1 \ucoal L_2 \ucoal \dots \ucoal L_n = 
	\net{\link[\varnothing]AB^\pi}AB
$
has a corresponding path
$
	\net{\lambda_\star^\star}AB = 
	R_1 \ucoal R_2 \ucoal \dots \ucoal R_n =
	\net{\link[\varnothing]AB^{\pi'}}AB
$
where the same links (but with potentially different witness maps) are coalesced. It follows by induction on this path (where the base case is $L_1$ and $R_1$) that for every corresponding pair of links $\link CD^\phi$ in $L_i$ and $\link[\tau]CD^\psi$ in $R_i$ we have $\tau\leq\sigma$ and $\psi\leq\phi$.
\end{proof}
% ..................................................

% ..................................................
\setcounterref{retheorem}{lem:unifying implies strict coalescence}
\addtocounter{retheorem}{-1}
\begin{relemma}
If $\net{\lambda_\star}AB$ unifying-sequentializes to $\pi$ then there exists a witness assignment $\Sigma$ and substitution $\rho$ such that $\net{\lambda_\Sigma}AB$ strict-sequentializes to $\pi$ and $\lambda_\Sigma=\lambda_\star\rho$.
\end{relemma}

\begin{proof}
By induction on the sequentialization path $\net{\lambda_\star}AB\ucoal^*\net{\link[\varnothing]AB^\pi}AB$. For the end result, the statement holds with $\rho=\varnothing$. For the inductive step, consider a step $L\ucoal R$. We show the case ($\urr*$); the other cases are immediate.
%
\begin{itemize}
	\item
$\link C{D_1},\link[\tau]C{D_2}\ucoal\link[\sigma\join\tau]C{D_1{\*}D_2}$
\\
By the inductive hypothesis, $R\rho'$ strict-sequentializes to $\pi$. Let $\sigma\join\tau=\sigma\rho''=\tau\rho''$ and let $\rho=\rho''\rho'$. Then $L\rho$ strict-sequentializes to $\pi$ by 
\[
	\link[\sigma\rho]C{D_1},\link[\tau\rho]C{D_2}\scoal\link[(\sigma\join\tau)\rho']C{D_1{\*}D_2}~.
\qedhere
\]
\end{itemize}
\end{proof}
% ..................................................

% ..................................................
\setcounterref{retheorem}{thm:unet deseq-seq}
\addtocounter{retheorem}{-1}
\begin{retheorem}
If $[\prf\pi AB]$ is $\net{\lambda_\Sigma}AB$ then $\net\lambda AB$ unifying-sequentializes to $\pi'\leq \pi$.
\end{retheorem}

\begin{proof}
By Theorem~\ref{thm:proof->net->proof}, $\net{\lambda_\Sigma}AB$ sequentializes to $\pi$ in $(\scoal)$, and hence also in $(\ucoal)$. Then by Lemma~\ref{lem:ucoal generality} $\net{\lambda_\star}AB$ sequentializes to $\pi'\leq\pi$.
\end{proof}
% ..................................................

% ..................................................
\setcounterref{retheorem}{thm:unet seq-deseq}
\addtocounter{retheorem}{-1}
\begin{retheorem}
If $\net\lambda AB$ sequentializes to $\pi$, then $[\pi]=\net{\lambda_\Sigma} AB$ for some $\Sigma$.
\end{retheorem}

\begin{proof}
By Lemma~\ref{lem:unifying implies strict coalescence}, since $\net\lambda AB$ sequentializes to $\pi$ there is a net $\net{\lambda_\Sigma} AB$ that sequentializes to $\pi$. By Theorem~\ref{thm:net->proof->net}, $[\pi]=\net{\lambda_\Sigma} AB$.
\end{proof}
% ..................................................

% ..................................................
\setcounterref{retheorem}{thm:unet composition}
\addtocounter{retheorem}{-1}
\begin{retheorem}
If $\net\lambda AB$ sequentializes to $\pi$ and $\net\kappa{\dual B}C$ to $\phi$ then their composition $\net{\lambda\comp\kappa}AC$ sequentializes to a proof $\psi'\leq\psi$ where $\psi$ is a normal form of $\pi\comp\phi$.
\end{retheorem}

\begin{proof}
By Lemma~\ref{lem:unifying implies strict coalescence} there are witness labellings $\Sigma$ and $\Theta$ such that $\net{\lambda_\Sigma}AB$ strict-sequentializes to $\pi$ and $\net{\kappa_\Theta}{\dual B}C$ to $\phi$. By Theorem~\ref{thm:composition} their composition $(\net{\lambda_\Sigma\comp\kappa_\Theta)}AC$ strict-sequentializes to a normal form $\psi$ of $\pi\comp\phi$. By Lemma~\ref{lem:ucoal generality} the net $\net{(\lambda\comp\kappa)_\star}AC$ unifying-sequentializes to $\psi'\leq\psi$.
\end{proof}
% ..................................................

\end{document}
